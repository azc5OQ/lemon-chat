<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Le chat</title>
	<link rel="icon" type="image/x-icon" href=""/>
    <style>
        *
        {
          margin: 0px;
          padding: 0px;
          position: relative;
        }

        html
        {
          background-color: #36393f;
          height: 100%;
          width: 100%;
          margin: 0px;
        }
        body
        {
          min-height: 100%;
          margin: 0px;
        }

        #verification-system
        {
          min-height: 100vh;
          text-align: center;
        }

        div
        {
          position:relative;
        }

        #body-container
        {
          height: 100vh;
        }

        #space-devider-42
        {
          display: inline-block;
          width: 8%;
          height: 50px;
        }

        #chat-context-container, #spacer-between-chat-and-users, #channel-list-container
        {
          display: inline-block;
          vertical-align: top;
          width: 100%;
          overflow-y: scroll;
          height: 100%;
        }


        #space-devider1, #space-devider2, #space-devider4
        {
          display: inline-block;
          vertical-align: top;
          height: 100%;
        }

        .connect-form-input-container
        {
          padding-top: 10px;
          padding-bottom: 10px
        }

        #communication-system-container
        {
          height: 75%;
          display: none;
          min-width: 329px;
        }


        #space-devider42
        {
          display: inline-block;
          background-color: #a05a5a;
          width: 8%;
          height: 50px;
          cursor: pointer;
        }

        .connected-user-p
        {
          display: inline-block;
          color: #63eb2c;
        }

        .connected-user-p-received-messages-number
        {
          display: none;
          float: right;
          font-size: 0.8em;
          color: gold;
          padding-top: 0.2em;
          background-color: #6b7c99;
          padding-left: 0.5em;
          padding-right: 0.5em;
          padding-bottom: 0.2em;
          border-radius: 14px;
          bottom: 0.1em;
        }


        #communication-system-head-menu
        {
          min-height: 30px;
          background-color: black;
          color: white;
          text-align: right;
        }

        #space-devider1
        {
          height: 100%;
          width: 14%;
        }

        .single-server-message
        {
          padding-left: 20px;
          padding-top: 5px;
          background-color: inherit;
          border-radius: 9px;
          color: #898e8c;
          font-family: sans-serif;
          font-size: 10px;
          margin: 0px;
          font-weight: bold;
          font-style: italic;
          word-wrap: break-word;
          width: 32%;
        }

        #space-devider2
        {
          width: 75%;
          height: 100%;
          left: -4px;
        }

        #channel-properties-input-container
        {
            height: 153px;
            text-align: center;
        }

        #connect-form-sub-container-1, #connect-form-sub-container-2
        {
          display: inline-block;
        }

        #image-upload-preview
        {
          width: 80px;
          height: 53px;
          display: inline-block;
          background-repeat: no-repeat;
          background-position: center;
          background-size: cover;
        }

        #chat-input-file-input-container
        {
          width: 73%;
          display: inline-block;
          vertical-align: top;
        }

        #send-button-image-preview-container
        {
          width: 26%;
          display: inline-block;
          vertical-align: top;
          text-align: right;
        }


        #chat-input-container-text-input
        {
          width: 100%;
          min-height: 49px;
          background-color: #202020;
          color: white;
          border-radius: 5px;
          display: inline-block;
          vertical-align: top;
          outline: none;
          border: none;
          padding: 0.5em;
          font-family: sans-serif;
        }

        #space-devider4
        {
          background-color: inherit;
          width: 7%;
          height: 100%;
        }

        #space-devider5
        {
          width: 9%;
          display: inline-block;
          vertical-align: top;
          display: inline-block;
          height: 25%;
        }

        .pretty-p
        {
          color: white;
          display: inline-block;
          font-family: sans-serif;
        }

        #channel-list-container
        {
          background-color: #202020;
          color: white;
          height: 100%;
          font-family: sans-serif;
        }

        .single-channel1
        {
          min-height: 14px;
          background: linear-gradient(to right, #6b7c99, #36393f);
          color: white;
          font-family: sans-serif;
          right: 4px;
        }

        .single-channel
        {

        }

        .single-channel2
        {
            height: 58px;
            width: 58px;
            background: linear-gradient(to right, #4a97b8, #36393f);
            color: white;
            font-family: sans-serif;
            right: -7px;
            border-radius: 15px;
        }

        #contextmenus-container
        {
            position: absolute;
            z-index: 1;
            top: 0px;
            width: 0px;
            height: 0px;
        }

        .channel-list-context-menu-background
        {
            background-color: #60656f;
            width: 130px;
            height: 150px;
            border-radius: 10px;
            opacity: 0.8;
        }
        .channel-list-context-menu-items
        {
            position: absolute;
            top: 0px;
            width: 130px;
            overflow: hidden;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .channel-list-context-menu-items p
        {
            color: white;
            top: 0px;
            width: 130px;
            font-size: 1em;
            font-family: sans-serif;
            padding: 5px;
            cursor: pointer;
        }
        .channel-list-context-menu-items p:hover
        {
            color: white;
            top: 0px;
            width: 130px;
            font-size: 1em;
            font-family: sans-serif;
            padding: 5px;
            cursor: pointer;
            background-color: #b9d436;
        }

        .single-channel
        {
            cursor: pointer;
            padding-left: 15px;
            padding-top: 5px;
            padding-bottom: 5px;
            font-family: sans-serif;
            color: white;
        }

        .single-channel:hover
        {
            background-color: #333030;
        }

        .single-channel p
        {
            padding-left: 3px;
            font: 16px sans-serif;
        }



        #chat-input-container
        {
          display: inline-block;
          vertical-align: top;
          height: 25%;
          width: 75%;
        }

        .single-chat-message
        {
          background-color: inherit;
          border-radius: 9px;
          color: white;
          font-family: sans-serif;
          width: 94%;
          min-height: 44px;
          margin: 0px;
        }


        #channel-list-container::-webkit-scrollbar,
        #chat-context-container::-webkit-scrollbar,
        #chat-input-container-text-input::-webkit-scrollbar,
        body::-webkit-scrollbar
        {
          width: 6px;
        }

        #channel-list-container::-webkit-scrollbar-track,
        #chat-context-container::-webkit-scrollbar-track,
        #chat-input-container-text-input::-webkit-scrollbar-track,
        body::-webkit-scrollbar-track
        {
            background: black;
        }


        #channel-list-container::-webkit-scrollbar-thumb,
        #chat-context-container::-webkit-scrollbar-thumb,
        #chat-input-container-text-input::-webkit-scrollbar-thumb,
        body::-webkit-scrollbar-track
        {
          background-color: #6b7c9a;
          border-radius: 20px;
          border: 3px solid #6b7c9a;
        }


        #chat-input-container-send-chat-input
        {
          width: 58px;
          height: 29px;
          border: 0px;
          transition: 0.3s ease;
          border-radius: 3px;
          color: white;
          cursor: pointer;
          background: #7d8799;
          vertical-align: top;
        }

        #connected-local-user-input
        {
            background-color: inherit;
            height: 100%;
            font-family: sans-serif;
            font-weight: bold;
            outline: none;
            border: 0px;
            width: 84%;
            color: #CDDC39;
        }

        .single-chat-message-avatar
        {
          display: inline-block;
          background-color: beige;
          width: 59px;
          height: 59px;
          vertical-align: top;
        }

        .single-message-content
        {
          display: inline-block;
          vertical-align: top;
          padding-left: 20px;
          font-size: 15px;
          width: 96%;
          padding-top: 5px;
          padding-bottom: 5px;
          font-family: sans-serif;
        }

        .chat-spacer
        {
          min-height: 120px;
        }


        #space-devider3
        {
          height: 1px;
          width: 14%;
          display: inline-block;
        }

        .single-chat-message-seniner
        {
          display: inline-block;
          padding-right: 11px;
          color: #a7bce0;
        }

        .single-chat-message-sender-time
        {
          display: inline-block;
          font-size: 10px;
          vertical-align: middle;
          font-style: italic;
          font-family: sans-serif;
          font-size: 10px;
          color: #898e8c;
          font-weight: bold;
        }


        .single-chat-message-sender-username-container
        {
          display: inline-block;
          padding-right: 0.3em;
          color: #a3c0f0;
        }

        .single-chat-message-sender-local-username-container
        {
          display: inline-block;
          padding-right: 0.3em;
          color: #d1e2ff;
        }


        .single-chat-message-content
        {
          padding-top: 3px;
          font-size: 12px;
          max-width: 943px;
          word-break: break-all;
        }

        .connected-user
        {
          cursor: pointer;
        }


        .connected-user
        {
          cursor: pointer;
        }

        .connected-user:hover
        {
          background-color: #333030;
        }

        #textarea-log
        {
            position: absolute;
            z-index: 1;
            opacity: 0.5;
            display: none;
            width: 50%;
            height: 50%;
        }

        .connected-user, .connected-user-you
        {
            padding-top: 2px;
            padding-bottom: 2px;
        }

        .connected-local-user
        {
            padding-top: 2px;
            padding-bottom: 2px;
        }

        .connected-user-you
        {
          cursor: pointer;
        }

        .connected-user-you:hover
        {
          background-color: #747f9c;
        }


        #chat-input-container
        {
          display: inline-block;
          vertical-align: top;
          height: 25%;
          width: 75%;
        }
        .custom-file-upload-button
        {
          display: inline-block;
          background-color: #05a3ff;
          font-family: sans-serif;
          color: #ffffff;
          padding: 15px 1px 15px 15px;
          text-align: center;
          background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACnklEQVR4nO2aPWgUQRTHfzF32fOrCARtYquCglhY2mllGlGJYGspxgQEC7HRwsJCsBELSWdrHQutbI5rLh+ChRCwEQTFxCPBu2gxe6B7czuzezu7c+P7wx+umPf2vR8zN/sxIBKJRCKRSPSvrgPrQA/4PebeAz7EPVlp3oOiXXneBsCaB4W68poNgK4HhbpyzwZAMughMGUT6Jki4DGD/RiVDBjH5vuapgAA46xDCIBwADSAJaAF7MRuAYuo9a7TQQIBcIz07XkVmNXEBQGggd29ySqDM+GAZpxRvgFYwn6fv5OIDQJAC3sAzURsEAB2sAfQScTu14wxSgBkDXCsUZZAEAAWsQewkIhtaMYY5QLAJDCRMzZCbXGm5tsMboOVA2gAL4FdYAt4RD4Qs6RDaKO/EaocwCtNvic5c0Wofb6J+rPrxL8XGH4rHGmub1RRAO5rcvV9b4S8WVQZgMuol5Fpa/ZmztxZNKW5rlGjAjgDbGvyJN0FruTIn0WlAzgKbGpyDPMucMEibz12VpUKIALea+JN3gLOpeS9FY/ZJvuyqWuuZ1ReAMuaWFt/BU4m8tWA54lxe8CNDDWVBuCuJi6rPwOn43xHgJUh434Bc5Z1lQLgEsV9Quuibnh+GsZ1gPMWtdVy9JMp4BTwI0ejRfg7cNZQn1MAM8Cniprv+wtwPKXGSVcA6sC7ipvvexP9c4BTAC88aPxvb6BmZCkAbnvQsM5N4HCi1n1FA7iI31+P36IegZ0AOAF886BJk1+jpn6hAKaBjx40Z+tl1IuXiSIA1IA3HjSV1U+LAvDMg2by+kERAEKzABAAAkAACIA0hXA+eJitDkque1CoK7dtAIR8WPqqDQBQR8s3CGM59FCz+ppt8yKRSCQSif4P/QHQnpOS6ECJPwAAAABJRU5ErkJggg==);
          width: 15px;
          cursor: pointer;
          border-radius: 7px;
          transition: 0.3s ease;
          vertical-align: top;
          background-repeat: no-repeat;
          background-size: contain;
        }

        .button-1
        {
          width: 58px;
          height: 29px;
          border: 0px;
          transition: 0.3s ease;
          border-radius: 3px;
          color: white;
          cursor: pointer;
          background: #7d8799;
          vertical-align: top;
        }

        #current-channel-description
        {
            word-break: break-all;
            font: 12px sans-serif;
            font-style: italic;
            color: #ffffff;
        }


        .custom-file-upload-button:hover
        {
            background-color: #7d8799;
        }
        .custom-file-upload-button:active
        {
            box-shadow: 0px 1px 0px #016DB0;
        }

        #upload-image-container
        {
          display: inline-block;
          vertical-align: top;
        }

        .text-input-pretty
        {
          padding: 5px;
          font-family: sans-serif;
          width: 200px;
          border-bottom: 3px solid gold;
          border-left-color: #202020;
          border-right-color: #202020;
          border-top-color: #202020;
          background-color: #202020;
          border-top-style: solid;
          border-left-style: solid;
          border-right-style: solid;
          color: white;
        }


        .text-input-pretty[disabled]
        {
          padding: 5px;
          font-family: sans-serif;
          background-color: #202020;
          border-style: solid;
          color: wheat;
          width: 50px;
          border-bottom-color: #202020;
        }

        .text-input-pretty:focus
        {
          outline: none;
        }

        .text-input-2
        {
          padding: 5px;
          font-family: sans-serif;
          width: 185px;
          border-bottom: 1px solid white;
          border-left-color: #36393f;
          border-right-color: #36393f;
          border-top-color: #36393f;
          background-color: #36393f;
          border-top-style: solid;
          border-left-style: solid;
          border-right-style: solid;
          color: white;
        }

        .text-input-2[disabled]
        {
          padding: 5px;
          font-family: sans-serif;
          background-color: #36393f;
          border-style: solid;
          color: white;
          width: 67px;
          border-bottom-color: #36393f;
        }

        .text-input-2:focus
        {
          outline: none;
        }

        #show-hide-log-button
        {
            position: absolute;
            z-index: 1;
            bottom: 0;
            right: 0;
            width: 38px;
            height: 22px;
            border: 0px;
            transition: 0.3s ease;
            border-radius: 3px;
            color: white;
            cursor: pointer;
            background: #7d8799;
        }

        .chat-context-selector
        {
            background-color: #7d8799;
            display: inline-block;
            min-height: 6px;
            height: 15px;
            padding: 4px;
            border-radius: 3px;
            margin-left: 1px;
            margin-right: 1px;
            cursor: pointer;
        }

        .chat-context-selector:hover
        {
            //background-color: #202020;
        }

        .chat-context-selector:hover .remove-chat-context-selector
        {
            visibility: visible;
        }

        .remove-chat-context-selector:hover
        {
            background-color: blue;
        }

        .chat-context-selector .p-container
        {
            display: inline-block;
            vertical-align: top;
            font-size: 12px;
            font-family: sans-serif;
            min-width: 35px;
            color: white;
        }

        .remove-chat-context-selector
        {
            height: 14px;
            width: 14px;
            background-color: black;
            display: inline-block;
            cursor: pointer;
            visibility: hidden;
        }

        #chat-context-selectors-container
        {
            padding-left: 25px;
            background-color: #000000;
        }

        #background-container
        {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #000010;
            z-index: 1;
            opacity: 0.5;
            top: 0px;
            display: none;
            text-align: center;
        }

        #channel-properties-container
        {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1;
            top: 0px;
            display: none;
            z-index: 5;
        }

        #channel-properties-edit
        {
            top: 25%;
            width: 322px;
            height: 219px;
            background-color: #36393f;
            margin: 0 auto;
            border-radius: 13px;
            overflow: hidden;
        }

        #menu-bar-container
        {
            height: 29px;
            text-align: right;
        }

        #close-button
        {
            width: 29px;
            height: 25px;
            border: 2px solid #9e8232;
            float: right;
            border-bottom-left-radius: 16px;
            border-top-right-radius: 16px;
            cursor: pointer;
        }
        #close-button:hover
        {
            border-color: #d8d22b;
        }

    </style>

    <script type="text/javascript">
    "use strict";

    (function(root) {

        function checkInt(value) {
            return (parseInt(value) === value);
        }``

        function checkInts(arrayish) {
            if (!checkInt(arrayish.length)) { return false; }

            for (var i = 0; i < arrayish.length; i++) {
                if (!checkInt(arrayish[i]) || arrayish[i] < 0 || arrayish[i] > 255) {
                    return false;
                }
            }

            return true;
        }

        function coerceArray(arg, copy) {

            // ArrayBuffer view
            if (arg.buffer && ArrayBuffer.isView(arg) && arg.name === 'Uint8Array') {

                if (copy) {
                    if (arg.slice) {
                        arg = arg.slice();
                    } else {
                        arg = Array.prototype.slice.call(arg);
                    }
                }

                return arg;
            }

            // It's an array; check it is a valid representation of a byte
            if (Array.isArray(arg)) {
                if (!checkInts(arg)) {
                    throw new Error('Array contains invalid value: ' + arg);
                }

                return new Uint8Array(arg);
            }

            // Something else, but behaves like an array (maybe a Buffer? Arguments?)
            if (checkInt(arg.length) && checkInts(arg)) {
                return new Uint8Array(arg);
            }

            throw new Error('unsupported array-like object');
        }

        function createArray(length) {
            return new Uint8Array(length);
        }

        function copyArray(sourceArray, targetArray, targetStart, sourceStart, sourceEnd) {
            if (sourceStart != null || sourceEnd != null) {
                if (sourceArray.slice) {
                    sourceArray = sourceArray.slice(sourceStart, sourceEnd);
                } else {
                    sourceArray = Array.prototype.slice.call(sourceArray, sourceStart, sourceEnd);
                }
            }
            targetArray.set(sourceArray, targetStart);
        }


        var convertUtf8 = (function() {
            function toBytes(text) {
                var result = [], i = 0;
                text = encodeURI(text);
                while (i < text.length) {
                    var c = text.charCodeAt(i++);

                    // if it is a % sign, encode the following 2 bytes as a hex value
                    if (c === 37) {
                        result.push(parseInt(text.substr(i, 2), 16))
                        i += 2;

                    // otherwise, just the actual byte
                    } else {
                        result.push(c)
                    }
                }

                return coerceArray(result);
            }

            function fromBytes(bytes) {
                var result = [], i = 0;

                while (i < bytes.length) {
                    var c = bytes[i];

                    if (c < 128) {
                        result.push(String.fromCharCode(c));
                        i++;
                    } else if (c > 191 && c < 224) {
                        result.push(String.fromCharCode(((c & 0x1f) << 6) | (bytes[i + 1] & 0x3f)));
                        i += 2;
                    } else {
                        result.push(String.fromCharCode(((c & 0x0f) << 12) | ((bytes[i + 1] & 0x3f) << 6) | (bytes[i + 2] & 0x3f)));
                        i += 3;
                    }
                }

                return result.join('');
            }

            return {
                toBytes: toBytes,
                fromBytes: fromBytes,
            }
        })();

        var convertHex = (function() {
            function toBytes(text) {
                var result = [];
                for (var i = 0; i < text.length; i += 2) {
                    result.push(parseInt(text.substr(i, 2), 16));
                }

                return result;
            }

            // http://ixti.net/development/javascript/2011/11/11/base64-encodedecode-of-utf8-in-browser-with-js.html
            var Hex = '0123456789abcdef';

            function fromBytes(bytes) {
                    var result = [];
                    for (var i = 0; i < bytes.length; i++) {
                        var v = bytes[i];
                        result.push(Hex[(v & 0xf0) >> 4] + Hex[v & 0x0f]);
                    }
                    return result.join('');
            }

            return {
                toBytes: toBytes,
                fromBytes: fromBytes,
            }
        })();


        // Number of rounds by keysize
        var numberOfRounds = {16: 10, 24: 12, 32: 14}

        // Round constant words
        var rcon = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a, 0x2f, 0x5e, 0xbc, 0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d, 0xfa, 0xef, 0xc5, 0x91];

        // S-box and Inverse S-box (S is for Substitution)
        var S = [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16];
        var Si =[0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, 0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d];

        // Transformations for encryption
        var T1 = [0xc66363a5, 0xf87c7c84, 0xee777799, 0xf67b7b8d, 0xfff2f20d, 0xd66b6bbd, 0xde6f6fb1, 0x91c5c554, 0x60303050, 0x02010103, 0xce6767a9, 0x562b2b7d, 0xe7fefe19, 0xb5d7d762, 0x4dababe6, 0xec76769a, 0x8fcaca45, 0x1f82829d, 0x89c9c940, 0xfa7d7d87, 0xeffafa15, 0xb25959eb, 0x8e4747c9, 0xfbf0f00b, 0x41adadec, 0xb3d4d467, 0x5fa2a2fd, 0x45afafea, 0x239c9cbf, 0x53a4a4f7, 0xe4727296, 0x9bc0c05b, 0x75b7b7c2, 0xe1fdfd1c, 0x3d9393ae, 0x4c26266a, 0x6c36365a, 0x7e3f3f41, 0xf5f7f702, 0x83cccc4f, 0x6834345c, 0x51a5a5f4, 0xd1e5e534, 0xf9f1f108, 0xe2717193, 0xabd8d873, 0x62313153, 0x2a15153f, 0x0804040c, 0x95c7c752, 0x46232365, 0x9dc3c35e, 0x30181828, 0x379696a1, 0x0a05050f, 0x2f9a9ab5, 0x0e070709, 0x24121236, 0x1b80809b, 0xdfe2e23d, 0xcdebeb26, 0x4e272769, 0x7fb2b2cd, 0xea75759f, 0x1209091b, 0x1d83839e, 0x582c2c74, 0x341a1a2e, 0x361b1b2d, 0xdc6e6eb2, 0xb45a5aee, 0x5ba0a0fb, 0xa45252f6, 0x763b3b4d, 0xb7d6d661, 0x7db3b3ce, 0x5229297b, 0xdde3e33e, 0x5e2f2f71, 0x13848497, 0xa65353f5, 0xb9d1d168, 0x00000000, 0xc1eded2c, 0x40202060, 0xe3fcfc1f, 0x79b1b1c8, 0xb65b5bed, 0xd46a6abe, 0x8dcbcb46, 0x67bebed9, 0x7239394b, 0x944a4ade, 0x984c4cd4, 0xb05858e8, 0x85cfcf4a, 0xbbd0d06b, 0xc5efef2a, 0x4faaaae5, 0xedfbfb16, 0x864343c5, 0x9a4d4dd7, 0x66333355, 0x11858594, 0x8a4545cf, 0xe9f9f910, 0x04020206, 0xfe7f7f81, 0xa05050f0, 0x783c3c44, 0x259f9fba, 0x4ba8a8e3, 0xa25151f3, 0x5da3a3fe, 0x804040c0, 0x058f8f8a, 0x3f9292ad, 0x219d9dbc, 0x70383848, 0xf1f5f504, 0x63bcbcdf, 0x77b6b6c1, 0xafdada75, 0x42212163, 0x20101030, 0xe5ffff1a, 0xfdf3f30e, 0xbfd2d26d, 0x81cdcd4c, 0x180c0c14, 0x26131335, 0xc3ecec2f, 0xbe5f5fe1, 0x359797a2, 0x884444cc, 0x2e171739, 0x93c4c457, 0x55a7a7f2, 0xfc7e7e82, 0x7a3d3d47, 0xc86464ac, 0xba5d5de7, 0x3219192b, 0xe6737395, 0xc06060a0, 0x19818198, 0x9e4f4fd1, 0xa3dcdc7f, 0x44222266, 0x542a2a7e, 0x3b9090ab, 0x0b888883, 0x8c4646ca, 0xc7eeee29, 0x6bb8b8d3, 0x2814143c, 0xa7dede79, 0xbc5e5ee2, 0x160b0b1d, 0xaddbdb76, 0xdbe0e03b, 0x64323256, 0x743a3a4e, 0x140a0a1e, 0x924949db, 0x0c06060a, 0x4824246c, 0xb85c5ce4, 0x9fc2c25d, 0xbdd3d36e, 0x43acacef, 0xc46262a6, 0x399191a8, 0x319595a4, 0xd3e4e437, 0xf279798b, 0xd5e7e732, 0x8bc8c843, 0x6e373759, 0xda6d6db7, 0x018d8d8c, 0xb1d5d564, 0x9c4e4ed2, 0x49a9a9e0, 0xd86c6cb4, 0xac5656fa, 0xf3f4f407, 0xcfeaea25, 0xca6565af, 0xf47a7a8e, 0x47aeaee9, 0x10080818, 0x6fbabad5, 0xf0787888, 0x4a25256f, 0x5c2e2e72, 0x381c1c24, 0x57a6a6f1, 0x73b4b4c7, 0x97c6c651, 0xcbe8e823, 0xa1dddd7c, 0xe874749c, 0x3e1f1f21, 0x964b4bdd, 0x61bdbddc, 0x0d8b8b86, 0x0f8a8a85, 0xe0707090, 0x7c3e3e42, 0x71b5b5c4, 0xcc6666aa, 0x904848d8, 0x06030305, 0xf7f6f601, 0x1c0e0e12, 0xc26161a3, 0x6a35355f, 0xae5757f9, 0x69b9b9d0, 0x17868691, 0x99c1c158, 0x3a1d1d27, 0x279e9eb9, 0xd9e1e138, 0xebf8f813, 0x2b9898b3, 0x22111133, 0xd26969bb, 0xa9d9d970, 0x078e8e89, 0x339494a7, 0x2d9b9bb6, 0x3c1e1e22, 0x15878792, 0xc9e9e920, 0x87cece49, 0xaa5555ff, 0x50282878, 0xa5dfdf7a, 0x038c8c8f, 0x59a1a1f8, 0x09898980, 0x1a0d0d17, 0x65bfbfda, 0xd7e6e631, 0x844242c6, 0xd06868b8, 0x824141c3, 0x299999b0, 0x5a2d2d77, 0x1e0f0f11, 0x7bb0b0cb, 0xa85454fc, 0x6dbbbbd6, 0x2c16163a];
        var T2 = [0xa5c66363, 0x84f87c7c, 0x99ee7777, 0x8df67b7b, 0x0dfff2f2, 0xbdd66b6b, 0xb1de6f6f, 0x5491c5c5, 0x50603030, 0x03020101, 0xa9ce6767, 0x7d562b2b, 0x19e7fefe, 0x62b5d7d7, 0xe64dabab, 0x9aec7676, 0x458fcaca, 0x9d1f8282, 0x4089c9c9, 0x87fa7d7d, 0x15effafa, 0xebb25959, 0xc98e4747, 0x0bfbf0f0, 0xec41adad, 0x67b3d4d4, 0xfd5fa2a2, 0xea45afaf, 0xbf239c9c, 0xf753a4a4, 0x96e47272, 0x5b9bc0c0, 0xc275b7b7, 0x1ce1fdfd, 0xae3d9393, 0x6a4c2626, 0x5a6c3636, 0x417e3f3f, 0x02f5f7f7, 0x4f83cccc, 0x5c683434, 0xf451a5a5, 0x34d1e5e5, 0x08f9f1f1, 0x93e27171, 0x73abd8d8, 0x53623131, 0x3f2a1515, 0x0c080404, 0x5295c7c7, 0x65462323, 0x5e9dc3c3, 0x28301818, 0xa1379696, 0x0f0a0505, 0xb52f9a9a, 0x090e0707, 0x36241212, 0x9b1b8080, 0x3ddfe2e2, 0x26cdebeb, 0x694e2727, 0xcd7fb2b2, 0x9fea7575, 0x1b120909, 0x9e1d8383, 0x74582c2c, 0x2e341a1a, 0x2d361b1b, 0xb2dc6e6e, 0xeeb45a5a, 0xfb5ba0a0, 0xf6a45252, 0x4d763b3b, 0x61b7d6d6, 0xce7db3b3, 0x7b522929, 0x3edde3e3, 0x715e2f2f, 0x97138484, 0xf5a65353, 0x68b9d1d1, 0x00000000, 0x2cc1eded, 0x60402020, 0x1fe3fcfc, 0xc879b1b1, 0xedb65b5b, 0xbed46a6a, 0x468dcbcb, 0xd967bebe, 0x4b723939, 0xde944a4a, 0xd4984c4c, 0xe8b05858, 0x4a85cfcf, 0x6bbbd0d0, 0x2ac5efef, 0xe54faaaa, 0x16edfbfb, 0xc5864343, 0xd79a4d4d, 0x55663333, 0x94118585, 0xcf8a4545, 0x10e9f9f9, 0x06040202, 0x81fe7f7f, 0xf0a05050, 0x44783c3c, 0xba259f9f, 0xe34ba8a8, 0xf3a25151, 0xfe5da3a3, 0xc0804040, 0x8a058f8f, 0xad3f9292, 0xbc219d9d, 0x48703838, 0x04f1f5f5, 0xdf63bcbc, 0xc177b6b6, 0x75afdada, 0x63422121, 0x30201010, 0x1ae5ffff, 0x0efdf3f3, 0x6dbfd2d2, 0x4c81cdcd, 0x14180c0c, 0x35261313, 0x2fc3ecec, 0xe1be5f5f, 0xa2359797, 0xcc884444, 0x392e1717, 0x5793c4c4, 0xf255a7a7, 0x82fc7e7e, 0x477a3d3d, 0xacc86464, 0xe7ba5d5d, 0x2b321919, 0x95e67373, 0xa0c06060, 0x98198181, 0xd19e4f4f, 0x7fa3dcdc, 0x66442222, 0x7e542a2a, 0xab3b9090, 0x830b8888, 0xca8c4646, 0x29c7eeee, 0xd36bb8b8, 0x3c281414, 0x79a7dede, 0xe2bc5e5e, 0x1d160b0b, 0x76addbdb, 0x3bdbe0e0, 0x56643232, 0x4e743a3a, 0x1e140a0a, 0xdb924949, 0x0a0c0606, 0x6c482424, 0xe4b85c5c, 0x5d9fc2c2, 0x6ebdd3d3, 0xef43acac, 0xa6c46262, 0xa8399191, 0xa4319595, 0x37d3e4e4, 0x8bf27979, 0x32d5e7e7, 0x438bc8c8, 0x596e3737, 0xb7da6d6d, 0x8c018d8d, 0x64b1d5d5, 0xd29c4e4e, 0xe049a9a9, 0xb4d86c6c, 0xfaac5656, 0x07f3f4f4, 0x25cfeaea, 0xafca6565, 0x8ef47a7a, 0xe947aeae, 0x18100808, 0xd56fbaba, 0x88f07878, 0x6f4a2525, 0x725c2e2e, 0x24381c1c, 0xf157a6a6, 0xc773b4b4, 0x5197c6c6, 0x23cbe8e8, 0x7ca1dddd, 0x9ce87474, 0x213e1f1f, 0xdd964b4b, 0xdc61bdbd, 0x860d8b8b, 0x850f8a8a, 0x90e07070, 0x427c3e3e, 0xc471b5b5, 0xaacc6666, 0xd8904848, 0x05060303, 0x01f7f6f6, 0x121c0e0e, 0xa3c26161, 0x5f6a3535, 0xf9ae5757, 0xd069b9b9, 0x91178686, 0x5899c1c1, 0x273a1d1d, 0xb9279e9e, 0x38d9e1e1, 0x13ebf8f8, 0xb32b9898, 0x33221111, 0xbbd26969, 0x70a9d9d9, 0x89078e8e, 0xa7339494, 0xb62d9b9b, 0x223c1e1e, 0x92158787, 0x20c9e9e9, 0x4987cece, 0xffaa5555, 0x78502828, 0x7aa5dfdf, 0x8f038c8c, 0xf859a1a1, 0x80098989, 0x171a0d0d, 0xda65bfbf, 0x31d7e6e6, 0xc6844242, 0xb8d06868, 0xc3824141, 0xb0299999, 0x775a2d2d, 0x111e0f0f, 0xcb7bb0b0, 0xfca85454, 0xd66dbbbb, 0x3a2c1616];
        var T3 = [0x63a5c663, 0x7c84f87c, 0x7799ee77, 0x7b8df67b, 0xf20dfff2, 0x6bbdd66b, 0x6fb1de6f, 0xc55491c5, 0x30506030, 0x01030201, 0x67a9ce67, 0x2b7d562b, 0xfe19e7fe, 0xd762b5d7, 0xabe64dab, 0x769aec76, 0xca458fca, 0x829d1f82, 0xc94089c9, 0x7d87fa7d, 0xfa15effa, 0x59ebb259, 0x47c98e47, 0xf00bfbf0, 0xadec41ad, 0xd467b3d4, 0xa2fd5fa2, 0xafea45af, 0x9cbf239c, 0xa4f753a4, 0x7296e472, 0xc05b9bc0, 0xb7c275b7, 0xfd1ce1fd, 0x93ae3d93, 0x266a4c26, 0x365a6c36, 0x3f417e3f, 0xf702f5f7, 0xcc4f83cc, 0x345c6834, 0xa5f451a5, 0xe534d1e5, 0xf108f9f1, 0x7193e271, 0xd873abd8, 0x31536231, 0x153f2a15, 0x040c0804, 0xc75295c7, 0x23654623, 0xc35e9dc3, 0x18283018, 0x96a13796, 0x050f0a05, 0x9ab52f9a, 0x07090e07, 0x12362412, 0x809b1b80, 0xe23ddfe2, 0xeb26cdeb, 0x27694e27, 0xb2cd7fb2, 0x759fea75, 0x091b1209, 0x839e1d83, 0x2c74582c, 0x1a2e341a, 0x1b2d361b, 0x6eb2dc6e, 0x5aeeb45a, 0xa0fb5ba0, 0x52f6a452, 0x3b4d763b, 0xd661b7d6, 0xb3ce7db3, 0x297b5229, 0xe33edde3, 0x2f715e2f, 0x84971384, 0x53f5a653, 0xd168b9d1, 0x00000000, 0xed2cc1ed, 0x20604020, 0xfc1fe3fc, 0xb1c879b1, 0x5bedb65b, 0x6abed46a, 0xcb468dcb, 0xbed967be, 0x394b7239, 0x4ade944a, 0x4cd4984c, 0x58e8b058, 0xcf4a85cf, 0xd06bbbd0, 0xef2ac5ef, 0xaae54faa, 0xfb16edfb, 0x43c58643, 0x4dd79a4d, 0x33556633, 0x85941185, 0x45cf8a45, 0xf910e9f9, 0x02060402, 0x7f81fe7f, 0x50f0a050, 0x3c44783c, 0x9fba259f, 0xa8e34ba8, 0x51f3a251, 0xa3fe5da3, 0x40c08040, 0x8f8a058f, 0x92ad3f92, 0x9dbc219d, 0x38487038, 0xf504f1f5, 0xbcdf63bc, 0xb6c177b6, 0xda75afda, 0x21634221, 0x10302010, 0xff1ae5ff, 0xf30efdf3, 0xd26dbfd2, 0xcd4c81cd, 0x0c14180c, 0x13352613, 0xec2fc3ec, 0x5fe1be5f, 0x97a23597, 0x44cc8844, 0x17392e17, 0xc45793c4, 0xa7f255a7, 0x7e82fc7e, 0x3d477a3d, 0x64acc864, 0x5de7ba5d, 0x192b3219, 0x7395e673, 0x60a0c060, 0x81981981, 0x4fd19e4f, 0xdc7fa3dc, 0x22664422, 0x2a7e542a, 0x90ab3b90, 0x88830b88, 0x46ca8c46, 0xee29c7ee, 0xb8d36bb8, 0x143c2814, 0xde79a7de, 0x5ee2bc5e, 0x0b1d160b, 0xdb76addb, 0xe03bdbe0, 0x32566432, 0x3a4e743a, 0x0a1e140a, 0x49db9249, 0x060a0c06, 0x246c4824, 0x5ce4b85c, 0xc25d9fc2, 0xd36ebdd3, 0xacef43ac, 0x62a6c462, 0x91a83991, 0x95a43195, 0xe437d3e4, 0x798bf279, 0xe732d5e7, 0xc8438bc8, 0x37596e37, 0x6db7da6d, 0x8d8c018d, 0xd564b1d5, 0x4ed29c4e, 0xa9e049a9, 0x6cb4d86c, 0x56faac56, 0xf407f3f4, 0xea25cfea, 0x65afca65, 0x7a8ef47a, 0xaee947ae, 0x08181008, 0xbad56fba, 0x7888f078, 0x256f4a25, 0x2e725c2e, 0x1c24381c, 0xa6f157a6, 0xb4c773b4, 0xc65197c6, 0xe823cbe8, 0xdd7ca1dd, 0x749ce874, 0x1f213e1f, 0x4bdd964b, 0xbddc61bd, 0x8b860d8b, 0x8a850f8a, 0x7090e070, 0x3e427c3e, 0xb5c471b5, 0x66aacc66, 0x48d89048, 0x03050603, 0xf601f7f6, 0x0e121c0e, 0x61a3c261, 0x355f6a35, 0x57f9ae57, 0xb9d069b9, 0x86911786, 0xc15899c1, 0x1d273a1d, 0x9eb9279e, 0xe138d9e1, 0xf813ebf8, 0x98b32b98, 0x11332211, 0x69bbd269, 0xd970a9d9, 0x8e89078e, 0x94a73394, 0x9bb62d9b, 0x1e223c1e, 0x87921587, 0xe920c9e9, 0xce4987ce, 0x55ffaa55, 0x28785028, 0xdf7aa5df, 0x8c8f038c, 0xa1f859a1, 0x89800989, 0x0d171a0d, 0xbfda65bf, 0xe631d7e6, 0x42c68442, 0x68b8d068, 0x41c38241, 0x99b02999, 0x2d775a2d, 0x0f111e0f, 0xb0cb7bb0, 0x54fca854, 0xbbd66dbb, 0x163a2c16];
        var T4 = [0x6363a5c6, 0x7c7c84f8, 0x777799ee, 0x7b7b8df6, 0xf2f20dff, 0x6b6bbdd6, 0x6f6fb1de, 0xc5c55491, 0x30305060, 0x01010302, 0x6767a9ce, 0x2b2b7d56, 0xfefe19e7, 0xd7d762b5, 0xababe64d, 0x76769aec, 0xcaca458f, 0x82829d1f, 0xc9c94089, 0x7d7d87fa, 0xfafa15ef, 0x5959ebb2, 0x4747c98e, 0xf0f00bfb, 0xadadec41, 0xd4d467b3, 0xa2a2fd5f, 0xafafea45, 0x9c9cbf23, 0xa4a4f753, 0x727296e4, 0xc0c05b9b, 0xb7b7c275, 0xfdfd1ce1, 0x9393ae3d, 0x26266a4c, 0x36365a6c, 0x3f3f417e, 0xf7f702f5, 0xcccc4f83, 0x34345c68, 0xa5a5f451, 0xe5e534d1, 0xf1f108f9, 0x717193e2, 0xd8d873ab, 0x31315362, 0x15153f2a, 0x04040c08, 0xc7c75295, 0x23236546, 0xc3c35e9d, 0x18182830, 0x9696a137, 0x05050f0a, 0x9a9ab52f, 0x0707090e, 0x12123624, 0x80809b1b, 0xe2e23ddf, 0xebeb26cd, 0x2727694e, 0xb2b2cd7f, 0x75759fea, 0x09091b12, 0x83839e1d, 0x2c2c7458, 0x1a1a2e34, 0x1b1b2d36, 0x6e6eb2dc, 0x5a5aeeb4, 0xa0a0fb5b, 0x5252f6a4, 0x3b3b4d76, 0xd6d661b7, 0xb3b3ce7d, 0x29297b52, 0xe3e33edd, 0x2f2f715e, 0x84849713, 0x5353f5a6, 0xd1d168b9, 0x00000000, 0xeded2cc1, 0x20206040, 0xfcfc1fe3, 0xb1b1c879, 0x5b5bedb6, 0x6a6abed4, 0xcbcb468d, 0xbebed967, 0x39394b72, 0x4a4ade94, 0x4c4cd498, 0x5858e8b0, 0xcfcf4a85, 0xd0d06bbb, 0xefef2ac5, 0xaaaae54f, 0xfbfb16ed, 0x4343c586, 0x4d4dd79a, 0x33335566, 0x85859411, 0x4545cf8a, 0xf9f910e9, 0x02020604, 0x7f7f81fe, 0x5050f0a0, 0x3c3c4478, 0x9f9fba25, 0xa8a8e34b, 0x5151f3a2, 0xa3a3fe5d, 0x4040c080, 0x8f8f8a05, 0x9292ad3f, 0x9d9dbc21, 0x38384870, 0xf5f504f1, 0xbcbcdf63, 0xb6b6c177, 0xdada75af, 0x21216342, 0x10103020, 0xffff1ae5, 0xf3f30efd, 0xd2d26dbf, 0xcdcd4c81, 0x0c0c1418, 0x13133526, 0xecec2fc3, 0x5f5fe1be, 0x9797a235, 0x4444cc88, 0x1717392e, 0xc4c45793, 0xa7a7f255, 0x7e7e82fc, 0x3d3d477a, 0x6464acc8, 0x5d5de7ba, 0x19192b32, 0x737395e6, 0x6060a0c0, 0x81819819, 0x4f4fd19e, 0xdcdc7fa3, 0x22226644, 0x2a2a7e54, 0x9090ab3b, 0x8888830b, 0x4646ca8c, 0xeeee29c7, 0xb8b8d36b, 0x14143c28, 0xdede79a7, 0x5e5ee2bc, 0x0b0b1d16, 0xdbdb76ad, 0xe0e03bdb, 0x32325664, 0x3a3a4e74, 0x0a0a1e14, 0x4949db92, 0x06060a0c, 0x24246c48, 0x5c5ce4b8, 0xc2c25d9f, 0xd3d36ebd, 0xacacef43, 0x6262a6c4, 0x9191a839, 0x9595a431, 0xe4e437d3, 0x79798bf2, 0xe7e732d5, 0xc8c8438b, 0x3737596e, 0x6d6db7da, 0x8d8d8c01, 0xd5d564b1, 0x4e4ed29c, 0xa9a9e049, 0x6c6cb4d8, 0x5656faac, 0xf4f407f3, 0xeaea25cf, 0x6565afca, 0x7a7a8ef4, 0xaeaee947, 0x08081810, 0xbabad56f, 0x787888f0, 0x25256f4a, 0x2e2e725c, 0x1c1c2438, 0xa6a6f157, 0xb4b4c773, 0xc6c65197, 0xe8e823cb, 0xdddd7ca1, 0x74749ce8, 0x1f1f213e, 0x4b4bdd96, 0xbdbddc61, 0x8b8b860d, 0x8a8a850f, 0x707090e0, 0x3e3e427c, 0xb5b5c471, 0x6666aacc, 0x4848d890, 0x03030506, 0xf6f601f7, 0x0e0e121c, 0x6161a3c2, 0x35355f6a, 0x5757f9ae, 0xb9b9d069, 0x86869117, 0xc1c15899, 0x1d1d273a, 0x9e9eb927, 0xe1e138d9, 0xf8f813eb, 0x9898b32b, 0x11113322, 0x6969bbd2, 0xd9d970a9, 0x8e8e8907, 0x9494a733, 0x9b9bb62d, 0x1e1e223c, 0x87879215, 0xe9e920c9, 0xcece4987, 0x5555ffaa, 0x28287850, 0xdfdf7aa5, 0x8c8c8f03, 0xa1a1f859, 0x89898009, 0x0d0d171a, 0xbfbfda65, 0xe6e631d7, 0x4242c684, 0x6868b8d0, 0x4141c382, 0x9999b029, 0x2d2d775a, 0x0f0f111e, 0xb0b0cb7b, 0x5454fca8, 0xbbbbd66d, 0x16163a2c];

        // Transformations for decryption
        var T5 = [0x51f4a750, 0x7e416553, 0x1a17a4c3, 0x3a275e96, 0x3bab6bcb, 0x1f9d45f1, 0xacfa58ab, 0x4be30393, 0x2030fa55, 0xad766df6, 0x88cc7691, 0xf5024c25, 0x4fe5d7fc, 0xc52acbd7, 0x26354480, 0xb562a38f, 0xdeb15a49, 0x25ba1b67, 0x45ea0e98, 0x5dfec0e1, 0xc32f7502, 0x814cf012, 0x8d4697a3, 0x6bd3f9c6, 0x038f5fe7, 0x15929c95, 0xbf6d7aeb, 0x955259da, 0xd4be832d, 0x587421d3, 0x49e06929, 0x8ec9c844, 0x75c2896a, 0xf48e7978, 0x99583e6b, 0x27b971dd, 0xbee14fb6, 0xf088ad17, 0xc920ac66, 0x7dce3ab4, 0x63df4a18, 0xe51a3182, 0x97513360, 0x62537f45, 0xb16477e0, 0xbb6bae84, 0xfe81a01c, 0xf9082b94, 0x70486858, 0x8f45fd19, 0x94de6c87, 0x527bf8b7, 0xab73d323, 0x724b02e2, 0xe31f8f57, 0x6655ab2a, 0xb2eb2807, 0x2fb5c203, 0x86c57b9a, 0xd33708a5, 0x302887f2, 0x23bfa5b2, 0x02036aba, 0xed16825c, 0x8acf1c2b, 0xa779b492, 0xf307f2f0, 0x4e69e2a1, 0x65daf4cd, 0x0605bed5, 0xd134621f, 0xc4a6fe8a, 0x342e539d, 0xa2f355a0, 0x058ae132, 0xa4f6eb75, 0x0b83ec39, 0x4060efaa, 0x5e719f06, 0xbd6e1051, 0x3e218af9, 0x96dd063d, 0xdd3e05ae, 0x4de6bd46, 0x91548db5, 0x71c45d05, 0x0406d46f, 0x605015ff, 0x1998fb24, 0xd6bde997, 0x894043cc, 0x67d99e77, 0xb0e842bd, 0x07898b88, 0xe7195b38, 0x79c8eedb, 0xa17c0a47, 0x7c420fe9, 0xf8841ec9, 0x00000000, 0x09808683, 0x322bed48, 0x1e1170ac, 0x6c5a724e, 0xfd0efffb, 0x0f853856, 0x3daed51e, 0x362d3927, 0x0a0fd964, 0x685ca621, 0x9b5b54d1, 0x24362e3a, 0x0c0a67b1, 0x9357e70f, 0xb4ee96d2, 0x1b9b919e, 0x80c0c54f, 0x61dc20a2, 0x5a774b69, 0x1c121a16, 0xe293ba0a, 0xc0a02ae5, 0x3c22e043, 0x121b171d, 0x0e090d0b, 0xf28bc7ad, 0x2db6a8b9, 0x141ea9c8, 0x57f11985, 0xaf75074c, 0xee99ddbb, 0xa37f60fd, 0xf701269f, 0x5c72f5bc, 0x44663bc5, 0x5bfb7e34, 0x8b432976, 0xcb23c6dc, 0xb6edfc68, 0xb8e4f163, 0xd731dcca, 0x42638510, 0x13972240, 0x84c61120, 0x854a247d, 0xd2bb3df8, 0xaef93211, 0xc729a16d, 0x1d9e2f4b, 0xdcb230f3, 0x0d8652ec, 0x77c1e3d0, 0x2bb3166c, 0xa970b999, 0x119448fa, 0x47e96422, 0xa8fc8cc4, 0xa0f03f1a, 0x567d2cd8, 0x223390ef, 0x87494ec7, 0xd938d1c1, 0x8ccaa2fe, 0x98d40b36, 0xa6f581cf, 0xa57ade28, 0xdab78e26, 0x3fadbfa4, 0x2c3a9de4, 0x5078920d, 0x6a5fcc9b, 0x547e4662, 0xf68d13c2, 0x90d8b8e8, 0x2e39f75e, 0x82c3aff5, 0x9f5d80be, 0x69d0937c, 0x6fd52da9, 0xcf2512b3, 0xc8ac993b, 0x10187da7, 0xe89c636e, 0xdb3bbb7b, 0xcd267809, 0x6e5918f4, 0xec9ab701, 0x834f9aa8, 0xe6956e65, 0xaaffe67e, 0x21bccf08, 0xef15e8e6, 0xbae79bd9, 0x4a6f36ce, 0xea9f09d4, 0x29b07cd6, 0x31a4b2af, 0x2a3f2331, 0xc6a59430, 0x35a266c0, 0x744ebc37, 0xfc82caa6, 0xe090d0b0, 0x33a7d815, 0xf104984a, 0x41ecdaf7, 0x7fcd500e, 0x1791f62f, 0x764dd68d, 0x43efb04d, 0xccaa4d54, 0xe49604df, 0x9ed1b5e3, 0x4c6a881b, 0xc12c1fb8, 0x4665517f, 0x9d5eea04, 0x018c355d, 0xfa877473, 0xfb0b412e, 0xb3671d5a, 0x92dbd252, 0xe9105633, 0x6dd64713, 0x9ad7618c, 0x37a10c7a, 0x59f8148e, 0xeb133c89, 0xcea927ee, 0xb761c935, 0xe11ce5ed, 0x7a47b13c, 0x9cd2df59, 0x55f2733f, 0x1814ce79, 0x73c737bf, 0x53f7cdea, 0x5ffdaa5b, 0xdf3d6f14, 0x7844db86, 0xcaaff381, 0xb968c43e, 0x3824342c, 0xc2a3405f, 0x161dc372, 0xbce2250c, 0x283c498b, 0xff0d9541, 0x39a80171, 0x080cb3de, 0xd8b4e49c, 0x6456c190, 0x7bcb8461, 0xd532b670, 0x486c5c74, 0xd0b85742];
        var T6 = [0x5051f4a7, 0x537e4165, 0xc31a17a4, 0x963a275e, 0xcb3bab6b, 0xf11f9d45, 0xabacfa58, 0x934be303, 0x552030fa, 0xf6ad766d, 0x9188cc76, 0x25f5024c, 0xfc4fe5d7, 0xd7c52acb, 0x80263544, 0x8fb562a3, 0x49deb15a, 0x6725ba1b, 0x9845ea0e, 0xe15dfec0, 0x02c32f75, 0x12814cf0, 0xa38d4697, 0xc66bd3f9, 0xe7038f5f, 0x9515929c, 0xebbf6d7a, 0xda955259, 0x2dd4be83, 0xd3587421, 0x2949e069, 0x448ec9c8, 0x6a75c289, 0x78f48e79, 0x6b99583e, 0xdd27b971, 0xb6bee14f, 0x17f088ad, 0x66c920ac, 0xb47dce3a, 0x1863df4a, 0x82e51a31, 0x60975133, 0x4562537f, 0xe0b16477, 0x84bb6bae, 0x1cfe81a0, 0x94f9082b, 0x58704868, 0x198f45fd, 0x8794de6c, 0xb7527bf8, 0x23ab73d3, 0xe2724b02, 0x57e31f8f, 0x2a6655ab, 0x07b2eb28, 0x032fb5c2, 0x9a86c57b, 0xa5d33708, 0xf2302887, 0xb223bfa5, 0xba02036a, 0x5ced1682, 0x2b8acf1c, 0x92a779b4, 0xf0f307f2, 0xa14e69e2, 0xcd65daf4, 0xd50605be, 0x1fd13462, 0x8ac4a6fe, 0x9d342e53, 0xa0a2f355, 0x32058ae1, 0x75a4f6eb, 0x390b83ec, 0xaa4060ef, 0x065e719f, 0x51bd6e10, 0xf93e218a, 0x3d96dd06, 0xaedd3e05, 0x464de6bd, 0xb591548d, 0x0571c45d, 0x6f0406d4, 0xff605015, 0x241998fb, 0x97d6bde9, 0xcc894043, 0x7767d99e, 0xbdb0e842, 0x8807898b, 0x38e7195b, 0xdb79c8ee, 0x47a17c0a, 0xe97c420f, 0xc9f8841e, 0x00000000, 0x83098086, 0x48322bed, 0xac1e1170, 0x4e6c5a72, 0xfbfd0eff, 0x560f8538, 0x1e3daed5, 0x27362d39, 0x640a0fd9, 0x21685ca6, 0xd19b5b54, 0x3a24362e, 0xb10c0a67, 0x0f9357e7, 0xd2b4ee96, 0x9e1b9b91, 0x4f80c0c5, 0xa261dc20, 0x695a774b, 0x161c121a, 0x0ae293ba, 0xe5c0a02a, 0x433c22e0, 0x1d121b17, 0x0b0e090d, 0xadf28bc7, 0xb92db6a8, 0xc8141ea9, 0x8557f119, 0x4caf7507, 0xbbee99dd, 0xfda37f60, 0x9ff70126, 0xbc5c72f5, 0xc544663b, 0x345bfb7e, 0x768b4329, 0xdccb23c6, 0x68b6edfc, 0x63b8e4f1, 0xcad731dc, 0x10426385, 0x40139722, 0x2084c611, 0x7d854a24, 0xf8d2bb3d, 0x11aef932, 0x6dc729a1, 0x4b1d9e2f, 0xf3dcb230, 0xec0d8652, 0xd077c1e3, 0x6c2bb316, 0x99a970b9, 0xfa119448, 0x2247e964, 0xc4a8fc8c, 0x1aa0f03f, 0xd8567d2c, 0xef223390, 0xc787494e, 0xc1d938d1, 0xfe8ccaa2, 0x3698d40b, 0xcfa6f581, 0x28a57ade, 0x26dab78e, 0xa43fadbf, 0xe42c3a9d, 0x0d507892, 0x9b6a5fcc, 0x62547e46, 0xc2f68d13, 0xe890d8b8, 0x5e2e39f7, 0xf582c3af, 0xbe9f5d80, 0x7c69d093, 0xa96fd52d, 0xb3cf2512, 0x3bc8ac99, 0xa710187d, 0x6ee89c63, 0x7bdb3bbb, 0x09cd2678, 0xf46e5918, 0x01ec9ab7, 0xa8834f9a, 0x65e6956e, 0x7eaaffe6, 0x0821bccf, 0xe6ef15e8, 0xd9bae79b, 0xce4a6f36, 0xd4ea9f09, 0xd629b07c, 0xaf31a4b2, 0x312a3f23, 0x30c6a594, 0xc035a266, 0x37744ebc, 0xa6fc82ca, 0xb0e090d0, 0x1533a7d8, 0x4af10498, 0xf741ecda, 0x0e7fcd50, 0x2f1791f6, 0x8d764dd6, 0x4d43efb0, 0x54ccaa4d, 0xdfe49604, 0xe39ed1b5, 0x1b4c6a88, 0xb8c12c1f, 0x7f466551, 0x049d5eea, 0x5d018c35, 0x73fa8774, 0x2efb0b41, 0x5ab3671d, 0x5292dbd2, 0x33e91056, 0x136dd647, 0x8c9ad761, 0x7a37a10c, 0x8e59f814, 0x89eb133c, 0xeecea927, 0x35b761c9, 0xede11ce5, 0x3c7a47b1, 0x599cd2df, 0x3f55f273, 0x791814ce, 0xbf73c737, 0xea53f7cd, 0x5b5ffdaa, 0x14df3d6f, 0x867844db, 0x81caaff3, 0x3eb968c4, 0x2c382434, 0x5fc2a340, 0x72161dc3, 0x0cbce225, 0x8b283c49, 0x41ff0d95, 0x7139a801, 0xde080cb3, 0x9cd8b4e4, 0x906456c1, 0x617bcb84, 0x70d532b6, 0x74486c5c, 0x42d0b857];
        var T7 = [0xa75051f4, 0x65537e41, 0xa4c31a17, 0x5e963a27, 0x6bcb3bab, 0x45f11f9d, 0x58abacfa, 0x03934be3, 0xfa552030, 0x6df6ad76, 0x769188cc, 0x4c25f502, 0xd7fc4fe5, 0xcbd7c52a, 0x44802635, 0xa38fb562, 0x5a49deb1, 0x1b6725ba, 0x0e9845ea, 0xc0e15dfe, 0x7502c32f, 0xf012814c, 0x97a38d46, 0xf9c66bd3, 0x5fe7038f, 0x9c951592, 0x7aebbf6d, 0x59da9552, 0x832dd4be, 0x21d35874, 0x692949e0, 0xc8448ec9, 0x896a75c2, 0x7978f48e, 0x3e6b9958, 0x71dd27b9, 0x4fb6bee1, 0xad17f088, 0xac66c920, 0x3ab47dce, 0x4a1863df, 0x3182e51a, 0x33609751, 0x7f456253, 0x77e0b164, 0xae84bb6b, 0xa01cfe81, 0x2b94f908, 0x68587048, 0xfd198f45, 0x6c8794de, 0xf8b7527b, 0xd323ab73, 0x02e2724b, 0x8f57e31f, 0xab2a6655, 0x2807b2eb, 0xc2032fb5, 0x7b9a86c5, 0x08a5d337, 0x87f23028, 0xa5b223bf, 0x6aba0203, 0x825ced16, 0x1c2b8acf, 0xb492a779, 0xf2f0f307, 0xe2a14e69, 0xf4cd65da, 0xbed50605, 0x621fd134, 0xfe8ac4a6, 0x539d342e, 0x55a0a2f3, 0xe132058a, 0xeb75a4f6, 0xec390b83, 0xefaa4060, 0x9f065e71, 0x1051bd6e, 0x8af93e21, 0x063d96dd, 0x05aedd3e, 0xbd464de6, 0x8db59154, 0x5d0571c4, 0xd46f0406, 0x15ff6050, 0xfb241998, 0xe997d6bd, 0x43cc8940, 0x9e7767d9, 0x42bdb0e8, 0x8b880789, 0x5b38e719, 0xeedb79c8, 0x0a47a17c, 0x0fe97c42, 0x1ec9f884, 0x00000000, 0x86830980, 0xed48322b, 0x70ac1e11, 0x724e6c5a, 0xfffbfd0e, 0x38560f85, 0xd51e3dae, 0x3927362d, 0xd9640a0f, 0xa621685c, 0x54d19b5b, 0x2e3a2436, 0x67b10c0a, 0xe70f9357, 0x96d2b4ee, 0x919e1b9b, 0xc54f80c0, 0x20a261dc, 0x4b695a77, 0x1a161c12, 0xba0ae293, 0x2ae5c0a0, 0xe0433c22, 0x171d121b, 0x0d0b0e09, 0xc7adf28b, 0xa8b92db6, 0xa9c8141e, 0x198557f1, 0x074caf75, 0xddbbee99, 0x60fda37f, 0x269ff701, 0xf5bc5c72, 0x3bc54466, 0x7e345bfb, 0x29768b43, 0xc6dccb23, 0xfc68b6ed, 0xf163b8e4, 0xdccad731, 0x85104263, 0x22401397, 0x112084c6, 0x247d854a, 0x3df8d2bb, 0x3211aef9, 0xa16dc729, 0x2f4b1d9e, 0x30f3dcb2, 0x52ec0d86, 0xe3d077c1, 0x166c2bb3, 0xb999a970, 0x48fa1194, 0x642247e9, 0x8cc4a8fc, 0x3f1aa0f0, 0x2cd8567d, 0x90ef2233, 0x4ec78749, 0xd1c1d938, 0xa2fe8cca, 0x0b3698d4, 0x81cfa6f5, 0xde28a57a, 0x8e26dab7, 0xbfa43fad, 0x9de42c3a, 0x920d5078, 0xcc9b6a5f, 0x4662547e, 0x13c2f68d, 0xb8e890d8, 0xf75e2e39, 0xaff582c3, 0x80be9f5d, 0x937c69d0, 0x2da96fd5, 0x12b3cf25, 0x993bc8ac, 0x7da71018, 0x636ee89c, 0xbb7bdb3b, 0x7809cd26, 0x18f46e59, 0xb701ec9a, 0x9aa8834f, 0x6e65e695, 0xe67eaaff, 0xcf0821bc, 0xe8e6ef15, 0x9bd9bae7, 0x36ce4a6f, 0x09d4ea9f, 0x7cd629b0, 0xb2af31a4, 0x23312a3f, 0x9430c6a5, 0x66c035a2, 0xbc37744e, 0xcaa6fc82, 0xd0b0e090, 0xd81533a7, 0x984af104, 0xdaf741ec, 0x500e7fcd, 0xf62f1791, 0xd68d764d, 0xb04d43ef, 0x4d54ccaa, 0x04dfe496, 0xb5e39ed1, 0x881b4c6a, 0x1fb8c12c, 0x517f4665, 0xea049d5e, 0x355d018c, 0x7473fa87, 0x412efb0b, 0x1d5ab367, 0xd25292db, 0x5633e910, 0x47136dd6, 0x618c9ad7, 0x0c7a37a1, 0x148e59f8, 0x3c89eb13, 0x27eecea9, 0xc935b761, 0xe5ede11c, 0xb13c7a47, 0xdf599cd2, 0x733f55f2, 0xce791814, 0x37bf73c7, 0xcdea53f7, 0xaa5b5ffd, 0x6f14df3d, 0xdb867844, 0xf381caaf, 0xc43eb968, 0x342c3824, 0x405fc2a3, 0xc372161d, 0x250cbce2, 0x498b283c, 0x9541ff0d, 0x017139a8, 0xb3de080c, 0xe49cd8b4, 0xc1906456, 0x84617bcb, 0xb670d532, 0x5c74486c, 0x5742d0b8];
        var T8 = [0xf4a75051, 0x4165537e, 0x17a4c31a, 0x275e963a, 0xab6bcb3b, 0x9d45f11f, 0xfa58abac, 0xe303934b, 0x30fa5520, 0x766df6ad, 0xcc769188, 0x024c25f5, 0xe5d7fc4f, 0x2acbd7c5, 0x35448026, 0x62a38fb5, 0xb15a49de, 0xba1b6725, 0xea0e9845, 0xfec0e15d, 0x2f7502c3, 0x4cf01281, 0x4697a38d, 0xd3f9c66b, 0x8f5fe703, 0x929c9515, 0x6d7aebbf, 0x5259da95, 0xbe832dd4, 0x7421d358, 0xe0692949, 0xc9c8448e, 0xc2896a75, 0x8e7978f4, 0x583e6b99, 0xb971dd27, 0xe14fb6be, 0x88ad17f0, 0x20ac66c9, 0xce3ab47d, 0xdf4a1863, 0x1a3182e5, 0x51336097, 0x537f4562, 0x6477e0b1, 0x6bae84bb, 0x81a01cfe, 0x082b94f9, 0x48685870, 0x45fd198f, 0xde6c8794, 0x7bf8b752, 0x73d323ab, 0x4b02e272, 0x1f8f57e3, 0x55ab2a66, 0xeb2807b2, 0xb5c2032f, 0xc57b9a86, 0x3708a5d3, 0x2887f230, 0xbfa5b223, 0x036aba02, 0x16825ced, 0xcf1c2b8a, 0x79b492a7, 0x07f2f0f3, 0x69e2a14e, 0xdaf4cd65, 0x05bed506, 0x34621fd1, 0xa6fe8ac4, 0x2e539d34, 0xf355a0a2, 0x8ae13205, 0xf6eb75a4, 0x83ec390b, 0x60efaa40, 0x719f065e, 0x6e1051bd, 0x218af93e, 0xdd063d96, 0x3e05aedd, 0xe6bd464d, 0x548db591, 0xc45d0571, 0x06d46f04, 0x5015ff60, 0x98fb2419, 0xbde997d6, 0x4043cc89, 0xd99e7767, 0xe842bdb0, 0x898b8807, 0x195b38e7, 0xc8eedb79, 0x7c0a47a1, 0x420fe97c, 0x841ec9f8, 0x00000000, 0x80868309, 0x2bed4832, 0x1170ac1e, 0x5a724e6c, 0x0efffbfd, 0x8538560f, 0xaed51e3d, 0x2d392736, 0x0fd9640a, 0x5ca62168, 0x5b54d19b, 0x362e3a24, 0x0a67b10c, 0x57e70f93, 0xee96d2b4, 0x9b919e1b, 0xc0c54f80, 0xdc20a261, 0x774b695a, 0x121a161c, 0x93ba0ae2, 0xa02ae5c0, 0x22e0433c, 0x1b171d12, 0x090d0b0e, 0x8bc7adf2, 0xb6a8b92d, 0x1ea9c814, 0xf1198557, 0x75074caf, 0x99ddbbee, 0x7f60fda3, 0x01269ff7, 0x72f5bc5c, 0x663bc544, 0xfb7e345b, 0x4329768b, 0x23c6dccb, 0xedfc68b6, 0xe4f163b8, 0x31dccad7, 0x63851042, 0x97224013, 0xc6112084, 0x4a247d85, 0xbb3df8d2, 0xf93211ae, 0x29a16dc7, 0x9e2f4b1d, 0xb230f3dc, 0x8652ec0d, 0xc1e3d077, 0xb3166c2b, 0x70b999a9, 0x9448fa11, 0xe9642247, 0xfc8cc4a8, 0xf03f1aa0, 0x7d2cd856, 0x3390ef22, 0x494ec787, 0x38d1c1d9, 0xcaa2fe8c, 0xd40b3698, 0xf581cfa6, 0x7ade28a5, 0xb78e26da, 0xadbfa43f, 0x3a9de42c, 0x78920d50, 0x5fcc9b6a, 0x7e466254, 0x8d13c2f6, 0xd8b8e890, 0x39f75e2e, 0xc3aff582, 0x5d80be9f, 0xd0937c69, 0xd52da96f, 0x2512b3cf, 0xac993bc8, 0x187da710, 0x9c636ee8, 0x3bbb7bdb, 0x267809cd, 0x5918f46e, 0x9ab701ec, 0x4f9aa883, 0x956e65e6, 0xffe67eaa, 0xbccf0821, 0x15e8e6ef, 0xe79bd9ba, 0x6f36ce4a, 0x9f09d4ea, 0xb07cd629, 0xa4b2af31, 0x3f23312a, 0xa59430c6, 0xa266c035, 0x4ebc3774, 0x82caa6fc, 0x90d0b0e0, 0xa7d81533, 0x04984af1, 0xecdaf741, 0xcd500e7f, 0x91f62f17, 0x4dd68d76, 0xefb04d43, 0xaa4d54cc, 0x9604dfe4, 0xd1b5e39e, 0x6a881b4c, 0x2c1fb8c1, 0x65517f46, 0x5eea049d, 0x8c355d01, 0x877473fa, 0x0b412efb, 0x671d5ab3, 0xdbd25292, 0x105633e9, 0xd647136d, 0xd7618c9a, 0xa10c7a37, 0xf8148e59, 0x133c89eb, 0xa927eece, 0x61c935b7, 0x1ce5ede1, 0x47b13c7a, 0xd2df599c, 0xf2733f55, 0x14ce7918, 0xc737bf73, 0xf7cdea53, 0xfdaa5b5f, 0x3d6f14df, 0x44db8678, 0xaff381ca, 0x68c43eb9, 0x24342c38, 0xa3405fc2, 0x1dc37216, 0xe2250cbc, 0x3c498b28, 0x0d9541ff, 0xa8017139, 0x0cb3de08, 0xb4e49cd8, 0x56c19064, 0xcb84617b, 0x32b670d5, 0x6c5c7448, 0xb85742d0];

        // Transformations for decryption key expansion
        var U1 = [0x00000000, 0x0e090d0b, 0x1c121a16, 0x121b171d, 0x3824342c, 0x362d3927, 0x24362e3a, 0x2a3f2331, 0x70486858, 0x7e416553, 0x6c5a724e, 0x62537f45, 0x486c5c74, 0x4665517f, 0x547e4662, 0x5a774b69, 0xe090d0b0, 0xee99ddbb, 0xfc82caa6, 0xf28bc7ad, 0xd8b4e49c, 0xd6bde997, 0xc4a6fe8a, 0xcaaff381, 0x90d8b8e8, 0x9ed1b5e3, 0x8ccaa2fe, 0x82c3aff5, 0xa8fc8cc4, 0xa6f581cf, 0xb4ee96d2, 0xbae79bd9, 0xdb3bbb7b, 0xd532b670, 0xc729a16d, 0xc920ac66, 0xe31f8f57, 0xed16825c, 0xff0d9541, 0xf104984a, 0xab73d323, 0xa57ade28, 0xb761c935, 0xb968c43e, 0x9357e70f, 0x9d5eea04, 0x8f45fd19, 0x814cf012, 0x3bab6bcb, 0x35a266c0, 0x27b971dd, 0x29b07cd6, 0x038f5fe7, 0x0d8652ec, 0x1f9d45f1, 0x119448fa, 0x4be30393, 0x45ea0e98, 0x57f11985, 0x59f8148e, 0x73c737bf, 0x7dce3ab4, 0x6fd52da9, 0x61dc20a2, 0xad766df6, 0xa37f60fd, 0xb16477e0, 0xbf6d7aeb, 0x955259da, 0x9b5b54d1, 0x894043cc, 0x87494ec7, 0xdd3e05ae, 0xd33708a5, 0xc12c1fb8, 0xcf2512b3, 0xe51a3182, 0xeb133c89, 0xf9082b94, 0xf701269f, 0x4de6bd46, 0x43efb04d, 0x51f4a750, 0x5ffdaa5b, 0x75c2896a, 0x7bcb8461, 0x69d0937c, 0x67d99e77, 0x3daed51e, 0x33a7d815, 0x21bccf08, 0x2fb5c203, 0x058ae132, 0x0b83ec39, 0x1998fb24, 0x1791f62f, 0x764dd68d, 0x7844db86, 0x6a5fcc9b, 0x6456c190, 0x4e69e2a1, 0x4060efaa, 0x527bf8b7, 0x5c72f5bc, 0x0605bed5, 0x080cb3de, 0x1a17a4c3, 0x141ea9c8, 0x3e218af9, 0x302887f2, 0x223390ef, 0x2c3a9de4, 0x96dd063d, 0x98d40b36, 0x8acf1c2b, 0x84c61120, 0xaef93211, 0xa0f03f1a, 0xb2eb2807, 0xbce2250c, 0xe6956e65, 0xe89c636e, 0xfa877473, 0xf48e7978, 0xdeb15a49, 0xd0b85742, 0xc2a3405f, 0xccaa4d54, 0x41ecdaf7, 0x4fe5d7fc, 0x5dfec0e1, 0x53f7cdea, 0x79c8eedb, 0x77c1e3d0, 0x65daf4cd, 0x6bd3f9c6, 0x31a4b2af, 0x3fadbfa4, 0x2db6a8b9, 0x23bfa5b2, 0x09808683, 0x07898b88, 0x15929c95, 0x1b9b919e, 0xa17c0a47, 0xaf75074c, 0xbd6e1051, 0xb3671d5a, 0x99583e6b, 0x97513360, 0x854a247d, 0x8b432976, 0xd134621f, 0xdf3d6f14, 0xcd267809, 0xc32f7502, 0xe9105633, 0xe7195b38, 0xf5024c25, 0xfb0b412e, 0x9ad7618c, 0x94de6c87, 0x86c57b9a, 0x88cc7691, 0xa2f355a0, 0xacfa58ab, 0xbee14fb6, 0xb0e842bd, 0xea9f09d4, 0xe49604df, 0xf68d13c2, 0xf8841ec9, 0xd2bb3df8, 0xdcb230f3, 0xcea927ee, 0xc0a02ae5, 0x7a47b13c, 0x744ebc37, 0x6655ab2a, 0x685ca621, 0x42638510, 0x4c6a881b, 0x5e719f06, 0x5078920d, 0x0a0fd964, 0x0406d46f, 0x161dc372, 0x1814ce79, 0x322bed48, 0x3c22e043, 0x2e39f75e, 0x2030fa55, 0xec9ab701, 0xe293ba0a, 0xf088ad17, 0xfe81a01c, 0xd4be832d, 0xdab78e26, 0xc8ac993b, 0xc6a59430, 0x9cd2df59, 0x92dbd252, 0x80c0c54f, 0x8ec9c844, 0xa4f6eb75, 0xaaffe67e, 0xb8e4f163, 0xb6edfc68, 0x0c0a67b1, 0x02036aba, 0x10187da7, 0x1e1170ac, 0x342e539d, 0x3a275e96, 0x283c498b, 0x26354480, 0x7c420fe9, 0x724b02e2, 0x605015ff, 0x6e5918f4, 0x44663bc5, 0x4a6f36ce, 0x587421d3, 0x567d2cd8, 0x37a10c7a, 0x39a80171, 0x2bb3166c, 0x25ba1b67, 0x0f853856, 0x018c355d, 0x13972240, 0x1d9e2f4b, 0x47e96422, 0x49e06929, 0x5bfb7e34, 0x55f2733f, 0x7fcd500e, 0x71c45d05, 0x63df4a18, 0x6dd64713, 0xd731dcca, 0xd938d1c1, 0xcb23c6dc, 0xc52acbd7, 0xef15e8e6, 0xe11ce5ed, 0xf307f2f0, 0xfd0efffb, 0xa779b492, 0xa970b999, 0xbb6bae84, 0xb562a38f, 0x9f5d80be, 0x91548db5, 0x834f9aa8, 0x8d4697a3];
        var U2 = [0x00000000, 0x0b0e090d, 0x161c121a, 0x1d121b17, 0x2c382434, 0x27362d39, 0x3a24362e, 0x312a3f23, 0x58704868, 0x537e4165, 0x4e6c5a72, 0x4562537f, 0x74486c5c, 0x7f466551, 0x62547e46, 0x695a774b, 0xb0e090d0, 0xbbee99dd, 0xa6fc82ca, 0xadf28bc7, 0x9cd8b4e4, 0x97d6bde9, 0x8ac4a6fe, 0x81caaff3, 0xe890d8b8, 0xe39ed1b5, 0xfe8ccaa2, 0xf582c3af, 0xc4a8fc8c, 0xcfa6f581, 0xd2b4ee96, 0xd9bae79b, 0x7bdb3bbb, 0x70d532b6, 0x6dc729a1, 0x66c920ac, 0x57e31f8f, 0x5ced1682, 0x41ff0d95, 0x4af10498, 0x23ab73d3, 0x28a57ade, 0x35b761c9, 0x3eb968c4, 0x0f9357e7, 0x049d5eea, 0x198f45fd, 0x12814cf0, 0xcb3bab6b, 0xc035a266, 0xdd27b971, 0xd629b07c, 0xe7038f5f, 0xec0d8652, 0xf11f9d45, 0xfa119448, 0x934be303, 0x9845ea0e, 0x8557f119, 0x8e59f814, 0xbf73c737, 0xb47dce3a, 0xa96fd52d, 0xa261dc20, 0xf6ad766d, 0xfda37f60, 0xe0b16477, 0xebbf6d7a, 0xda955259, 0xd19b5b54, 0xcc894043, 0xc787494e, 0xaedd3e05, 0xa5d33708, 0xb8c12c1f, 0xb3cf2512, 0x82e51a31, 0x89eb133c, 0x94f9082b, 0x9ff70126, 0x464de6bd, 0x4d43efb0, 0x5051f4a7, 0x5b5ffdaa, 0x6a75c289, 0x617bcb84, 0x7c69d093, 0x7767d99e, 0x1e3daed5, 0x1533a7d8, 0x0821bccf, 0x032fb5c2, 0x32058ae1, 0x390b83ec, 0x241998fb, 0x2f1791f6, 0x8d764dd6, 0x867844db, 0x9b6a5fcc, 0x906456c1, 0xa14e69e2, 0xaa4060ef, 0xb7527bf8, 0xbc5c72f5, 0xd50605be, 0xde080cb3, 0xc31a17a4, 0xc8141ea9, 0xf93e218a, 0xf2302887, 0xef223390, 0xe42c3a9d, 0x3d96dd06, 0x3698d40b, 0x2b8acf1c, 0x2084c611, 0x11aef932, 0x1aa0f03f, 0x07b2eb28, 0x0cbce225, 0x65e6956e, 0x6ee89c63, 0x73fa8774, 0x78f48e79, 0x49deb15a, 0x42d0b857, 0x5fc2a340, 0x54ccaa4d, 0xf741ecda, 0xfc4fe5d7, 0xe15dfec0, 0xea53f7cd, 0xdb79c8ee, 0xd077c1e3, 0xcd65daf4, 0xc66bd3f9, 0xaf31a4b2, 0xa43fadbf, 0xb92db6a8, 0xb223bfa5, 0x83098086, 0x8807898b, 0x9515929c, 0x9e1b9b91, 0x47a17c0a, 0x4caf7507, 0x51bd6e10, 0x5ab3671d, 0x6b99583e, 0x60975133, 0x7d854a24, 0x768b4329, 0x1fd13462, 0x14df3d6f, 0x09cd2678, 0x02c32f75, 0x33e91056, 0x38e7195b, 0x25f5024c, 0x2efb0b41, 0x8c9ad761, 0x8794de6c, 0x9a86c57b, 0x9188cc76, 0xa0a2f355, 0xabacfa58, 0xb6bee14f, 0xbdb0e842, 0xd4ea9f09, 0xdfe49604, 0xc2f68d13, 0xc9f8841e, 0xf8d2bb3d, 0xf3dcb230, 0xeecea927, 0xe5c0a02a, 0x3c7a47b1, 0x37744ebc, 0x2a6655ab, 0x21685ca6, 0x10426385, 0x1b4c6a88, 0x065e719f, 0x0d507892, 0x640a0fd9, 0x6f0406d4, 0x72161dc3, 0x791814ce, 0x48322bed, 0x433c22e0, 0x5e2e39f7, 0x552030fa, 0x01ec9ab7, 0x0ae293ba, 0x17f088ad, 0x1cfe81a0, 0x2dd4be83, 0x26dab78e, 0x3bc8ac99, 0x30c6a594, 0x599cd2df, 0x5292dbd2, 0x4f80c0c5, 0x448ec9c8, 0x75a4f6eb, 0x7eaaffe6, 0x63b8e4f1, 0x68b6edfc, 0xb10c0a67, 0xba02036a, 0xa710187d, 0xac1e1170, 0x9d342e53, 0x963a275e, 0x8b283c49, 0x80263544, 0xe97c420f, 0xe2724b02, 0xff605015, 0xf46e5918, 0xc544663b, 0xce4a6f36, 0xd3587421, 0xd8567d2c, 0x7a37a10c, 0x7139a801, 0x6c2bb316, 0x6725ba1b, 0x560f8538, 0x5d018c35, 0x40139722, 0x4b1d9e2f, 0x2247e964, 0x2949e069, 0x345bfb7e, 0x3f55f273, 0x0e7fcd50, 0x0571c45d, 0x1863df4a, 0x136dd647, 0xcad731dc, 0xc1d938d1, 0xdccb23c6, 0xd7c52acb, 0xe6ef15e8, 0xede11ce5, 0xf0f307f2, 0xfbfd0eff, 0x92a779b4, 0x99a970b9, 0x84bb6bae, 0x8fb562a3, 0xbe9f5d80, 0xb591548d, 0xa8834f9a, 0xa38d4697];
        var U3 = [0x00000000, 0x0d0b0e09, 0x1a161c12, 0x171d121b, 0x342c3824, 0x3927362d, 0x2e3a2436, 0x23312a3f, 0x68587048, 0x65537e41, 0x724e6c5a, 0x7f456253, 0x5c74486c, 0x517f4665, 0x4662547e, 0x4b695a77, 0xd0b0e090, 0xddbbee99, 0xcaa6fc82, 0xc7adf28b, 0xe49cd8b4, 0xe997d6bd, 0xfe8ac4a6, 0xf381caaf, 0xb8e890d8, 0xb5e39ed1, 0xa2fe8cca, 0xaff582c3, 0x8cc4a8fc, 0x81cfa6f5, 0x96d2b4ee, 0x9bd9bae7, 0xbb7bdb3b, 0xb670d532, 0xa16dc729, 0xac66c920, 0x8f57e31f, 0x825ced16, 0x9541ff0d, 0x984af104, 0xd323ab73, 0xde28a57a, 0xc935b761, 0xc43eb968, 0xe70f9357, 0xea049d5e, 0xfd198f45, 0xf012814c, 0x6bcb3bab, 0x66c035a2, 0x71dd27b9, 0x7cd629b0, 0x5fe7038f, 0x52ec0d86, 0x45f11f9d, 0x48fa1194, 0x03934be3, 0x0e9845ea, 0x198557f1, 0x148e59f8, 0x37bf73c7, 0x3ab47dce, 0x2da96fd5, 0x20a261dc, 0x6df6ad76, 0x60fda37f, 0x77e0b164, 0x7aebbf6d, 0x59da9552, 0x54d19b5b, 0x43cc8940, 0x4ec78749, 0x05aedd3e, 0x08a5d337, 0x1fb8c12c, 0x12b3cf25, 0x3182e51a, 0x3c89eb13, 0x2b94f908, 0x269ff701, 0xbd464de6, 0xb04d43ef, 0xa75051f4, 0xaa5b5ffd, 0x896a75c2, 0x84617bcb, 0x937c69d0, 0x9e7767d9, 0xd51e3dae, 0xd81533a7, 0xcf0821bc, 0xc2032fb5, 0xe132058a, 0xec390b83, 0xfb241998, 0xf62f1791, 0xd68d764d, 0xdb867844, 0xcc9b6a5f, 0xc1906456, 0xe2a14e69, 0xefaa4060, 0xf8b7527b, 0xf5bc5c72, 0xbed50605, 0xb3de080c, 0xa4c31a17, 0xa9c8141e, 0x8af93e21, 0x87f23028, 0x90ef2233, 0x9de42c3a, 0x063d96dd, 0x0b3698d4, 0x1c2b8acf, 0x112084c6, 0x3211aef9, 0x3f1aa0f0, 0x2807b2eb, 0x250cbce2, 0x6e65e695, 0x636ee89c, 0x7473fa87, 0x7978f48e, 0x5a49deb1, 0x5742d0b8, 0x405fc2a3, 0x4d54ccaa, 0xdaf741ec, 0xd7fc4fe5, 0xc0e15dfe, 0xcdea53f7, 0xeedb79c8, 0xe3d077c1, 0xf4cd65da, 0xf9c66bd3, 0xb2af31a4, 0xbfa43fad, 0xa8b92db6, 0xa5b223bf, 0x86830980, 0x8b880789, 0x9c951592, 0x919e1b9b, 0x0a47a17c, 0x074caf75, 0x1051bd6e, 0x1d5ab367, 0x3e6b9958, 0x33609751, 0x247d854a, 0x29768b43, 0x621fd134, 0x6f14df3d, 0x7809cd26, 0x7502c32f, 0x5633e910, 0x5b38e719, 0x4c25f502, 0x412efb0b, 0x618c9ad7, 0x6c8794de, 0x7b9a86c5, 0x769188cc, 0x55a0a2f3, 0x58abacfa, 0x4fb6bee1, 0x42bdb0e8, 0x09d4ea9f, 0x04dfe496, 0x13c2f68d, 0x1ec9f884, 0x3df8d2bb, 0x30f3dcb2, 0x27eecea9, 0x2ae5c0a0, 0xb13c7a47, 0xbc37744e, 0xab2a6655, 0xa621685c, 0x85104263, 0x881b4c6a, 0x9f065e71, 0x920d5078, 0xd9640a0f, 0xd46f0406, 0xc372161d, 0xce791814, 0xed48322b, 0xe0433c22, 0xf75e2e39, 0xfa552030, 0xb701ec9a, 0xba0ae293, 0xad17f088, 0xa01cfe81, 0x832dd4be, 0x8e26dab7, 0x993bc8ac, 0x9430c6a5, 0xdf599cd2, 0xd25292db, 0xc54f80c0, 0xc8448ec9, 0xeb75a4f6, 0xe67eaaff, 0xf163b8e4, 0xfc68b6ed, 0x67b10c0a, 0x6aba0203, 0x7da71018, 0x70ac1e11, 0x539d342e, 0x5e963a27, 0x498b283c, 0x44802635, 0x0fe97c42, 0x02e2724b, 0x15ff6050, 0x18f46e59, 0x3bc54466, 0x36ce4a6f, 0x21d35874, 0x2cd8567d, 0x0c7a37a1, 0x017139a8, 0x166c2bb3, 0x1b6725ba, 0x38560f85, 0x355d018c, 0x22401397, 0x2f4b1d9e, 0x642247e9, 0x692949e0, 0x7e345bfb, 0x733f55f2, 0x500e7fcd, 0x5d0571c4, 0x4a1863df, 0x47136dd6, 0xdccad731, 0xd1c1d938, 0xc6dccb23, 0xcbd7c52a, 0xe8e6ef15, 0xe5ede11c, 0xf2f0f307, 0xfffbfd0e, 0xb492a779, 0xb999a970, 0xae84bb6b, 0xa38fb562, 0x80be9f5d, 0x8db59154, 0x9aa8834f, 0x97a38d46];
        var U4 = [0x00000000, 0x090d0b0e, 0x121a161c, 0x1b171d12, 0x24342c38, 0x2d392736, 0x362e3a24, 0x3f23312a, 0x48685870, 0x4165537e, 0x5a724e6c, 0x537f4562, 0x6c5c7448, 0x65517f46, 0x7e466254, 0x774b695a, 0x90d0b0e0, 0x99ddbbee, 0x82caa6fc, 0x8bc7adf2, 0xb4e49cd8, 0xbde997d6, 0xa6fe8ac4, 0xaff381ca, 0xd8b8e890, 0xd1b5e39e, 0xcaa2fe8c, 0xc3aff582, 0xfc8cc4a8, 0xf581cfa6, 0xee96d2b4, 0xe79bd9ba, 0x3bbb7bdb, 0x32b670d5, 0x29a16dc7, 0x20ac66c9, 0x1f8f57e3, 0x16825ced, 0x0d9541ff, 0x04984af1, 0x73d323ab, 0x7ade28a5, 0x61c935b7, 0x68c43eb9, 0x57e70f93, 0x5eea049d, 0x45fd198f, 0x4cf01281, 0xab6bcb3b, 0xa266c035, 0xb971dd27, 0xb07cd629, 0x8f5fe703, 0x8652ec0d, 0x9d45f11f, 0x9448fa11, 0xe303934b, 0xea0e9845, 0xf1198557, 0xf8148e59, 0xc737bf73, 0xce3ab47d, 0xd52da96f, 0xdc20a261, 0x766df6ad, 0x7f60fda3, 0x6477e0b1, 0x6d7aebbf, 0x5259da95, 0x5b54d19b, 0x4043cc89, 0x494ec787, 0x3e05aedd, 0x3708a5d3, 0x2c1fb8c1, 0x2512b3cf, 0x1a3182e5, 0x133c89eb, 0x082b94f9, 0x01269ff7, 0xe6bd464d, 0xefb04d43, 0xf4a75051, 0xfdaa5b5f, 0xc2896a75, 0xcb84617b, 0xd0937c69, 0xd99e7767, 0xaed51e3d, 0xa7d81533, 0xbccf0821, 0xb5c2032f, 0x8ae13205, 0x83ec390b, 0x98fb2419, 0x91f62f17, 0x4dd68d76, 0x44db8678, 0x5fcc9b6a, 0x56c19064, 0x69e2a14e, 0x60efaa40, 0x7bf8b752, 0x72f5bc5c, 0x05bed506, 0x0cb3de08, 0x17a4c31a, 0x1ea9c814, 0x218af93e, 0x2887f230, 0x3390ef22, 0x3a9de42c, 0xdd063d96, 0xd40b3698, 0xcf1c2b8a, 0xc6112084, 0xf93211ae, 0xf03f1aa0, 0xeb2807b2, 0xe2250cbc, 0x956e65e6, 0x9c636ee8, 0x877473fa, 0x8e7978f4, 0xb15a49de, 0xb85742d0, 0xa3405fc2, 0xaa4d54cc, 0xecdaf741, 0xe5d7fc4f, 0xfec0e15d, 0xf7cdea53, 0xc8eedb79, 0xc1e3d077, 0xdaf4cd65, 0xd3f9c66b, 0xa4b2af31, 0xadbfa43f, 0xb6a8b92d, 0xbfa5b223, 0x80868309, 0x898b8807, 0x929c9515, 0x9b919e1b, 0x7c0a47a1, 0x75074caf, 0x6e1051bd, 0x671d5ab3, 0x583e6b99, 0x51336097, 0x4a247d85, 0x4329768b, 0x34621fd1, 0x3d6f14df, 0x267809cd, 0x2f7502c3, 0x105633e9, 0x195b38e7, 0x024c25f5, 0x0b412efb, 0xd7618c9a, 0xde6c8794, 0xc57b9a86, 0xcc769188, 0xf355a0a2, 0xfa58abac, 0xe14fb6be, 0xe842bdb0, 0x9f09d4ea, 0x9604dfe4, 0x8d13c2f6, 0x841ec9f8, 0xbb3df8d2, 0xb230f3dc, 0xa927eece, 0xa02ae5c0, 0x47b13c7a, 0x4ebc3774, 0x55ab2a66, 0x5ca62168, 0x63851042, 0x6a881b4c, 0x719f065e, 0x78920d50, 0x0fd9640a, 0x06d46f04, 0x1dc37216, 0x14ce7918, 0x2bed4832, 0x22e0433c, 0x39f75e2e, 0x30fa5520, 0x9ab701ec, 0x93ba0ae2, 0x88ad17f0, 0x81a01cfe, 0xbe832dd4, 0xb78e26da, 0xac993bc8, 0xa59430c6, 0xd2df599c, 0xdbd25292, 0xc0c54f80, 0xc9c8448e, 0xf6eb75a4, 0xffe67eaa, 0xe4f163b8, 0xedfc68b6, 0x0a67b10c, 0x036aba02, 0x187da710, 0x1170ac1e, 0x2e539d34, 0x275e963a, 0x3c498b28, 0x35448026, 0x420fe97c, 0x4b02e272, 0x5015ff60, 0x5918f46e, 0x663bc544, 0x6f36ce4a, 0x7421d358, 0x7d2cd856, 0xa10c7a37, 0xa8017139, 0xb3166c2b, 0xba1b6725, 0x8538560f, 0x8c355d01, 0x97224013, 0x9e2f4b1d, 0xe9642247, 0xe0692949, 0xfb7e345b, 0xf2733f55, 0xcd500e7f, 0xc45d0571, 0xdf4a1863, 0xd647136d, 0x31dccad7, 0x38d1c1d9, 0x23c6dccb, 0x2acbd7c5, 0x15e8e6ef, 0x1ce5ede1, 0x07f2f0f3, 0x0efffbfd, 0x79b492a7, 0x70b999a9, 0x6bae84bb, 0x62a38fb5, 0x5d80be9f, 0x548db591, 0x4f9aa883, 0x4697a38d];

        function convertToInt32(bytes) {
            var result = [];
            for (var i = 0; i < bytes.length; i += 4) {
                result.push(
                    (bytes[i    ] << 24) |
                    (bytes[i + 1] << 16) |
                    (bytes[i + 2] <<  8) |
                     bytes[i + 3]
                );
            }
            return result;
        }

        var AES = function(key) {
            if (!(this instanceof AES)) {
                throw Error('AES must be instanitated with `new`');
            }

            Object.defineProperty(this, 'key', {
                value: coerceArray(key, true)
            });

            this._prepare();
        }

        AES.prototype._prepare = function() {

            var rounds = numberOfRounds[this.key.length];
            if (rounds == null) {
                throw new Error('invalid key size (must be 16, 24 or 32 bytes)');
            }

            // encryption round keys
            this._Ke = [];

            // decryption round keys
            this._Kd = [];

            for (var i = 0; i <= rounds; i++) {
                this._Ke.push([0, 0, 0, 0]);
                this._Kd.push([0, 0, 0, 0]);
            }

            var roundKeyCount = (rounds + 1) * 4;
            var KC = this.key.length / 4;

            // convert the key into ints
            var tk = convertToInt32(this.key);

            // copy values into round key arrays
            var index;
            for (var i = 0; i < KC; i++) {
                index = i >> 2;
                this._Ke[index][i % 4] = tk[i];
                this._Kd[rounds - index][i % 4] = tk[i];
            }

            // key expansion (fips-197 section 5.2)
            var rconpointer = 0;
            var t = KC, tt;
            while (t < roundKeyCount) {
                tt = tk[KC - 1];
                tk[0] ^= ((S[(tt >> 16) & 0xFF] << 24) ^
                          (S[(tt >>  8) & 0xFF] << 16) ^
                          (S[ tt        & 0xFF] <<  8) ^
                           S[(tt >> 24) & 0xFF]        ^
                          (rcon[rconpointer] << 24));
                rconpointer += 1;

                // key expansion (for non-256 bit)
                if (KC != 8) {
                    for (var i = 1; i < KC; i++) {
                        tk[i] ^= tk[i - 1];
                    }

                // key expansion for 256-bit keys is "slightly different" (fips-197)
                } else {
                    for (var i = 1; i < (KC / 2); i++) {
                        tk[i] ^= tk[i - 1];
                    }
                    tt = tk[(KC / 2) - 1];

                    tk[KC / 2] ^= (S[ tt        & 0xFF]        ^
                                  (S[(tt >>  8) & 0xFF] <<  8) ^
                                  (S[(tt >> 16) & 0xFF] << 16) ^
                                  (S[(tt >> 24) & 0xFF] << 24));

                    for (var i = (KC / 2) + 1; i < KC; i++) {
                        tk[i] ^= tk[i - 1];
                    }
                }

                // copy values into round key arrays
                var i = 0, r, c;
                while (i < KC && t < roundKeyCount) {
                    r = t >> 2;
                    c = t % 4;
                    this._Ke[r][c] = tk[i];
                    this._Kd[rounds - r][c] = tk[i++];
                    t++;
                }
            }

            // inverse-cipher-ify the decryption round key (fips-197 section 5.3)
            for (var r = 1; r < rounds; r++) {
                for (var c = 0; c < 4; c++) {
                    tt = this._Kd[r][c];
                    this._Kd[r][c] = (U1[(tt >> 24) & 0xFF] ^
                                      U2[(tt >> 16) & 0xFF] ^
                                      U3[(tt >>  8) & 0xFF] ^
                                      U4[ tt        & 0xFF]);
                }
            }
        }

        AES.prototype.encrypt = function(plaintext) {
            if (plaintext.length != 16) {
                throw new Error('invalid plaintext size (must be 16 bytes)');
            }

            var rounds = this._Ke.length - 1;
            var a = [0, 0, 0, 0];

            // convert plaintext to (ints ^ key)
            var t = convertToInt32(plaintext);
            for (var i = 0; i < 4; i++) {
                t[i] ^= this._Ke[0][i];
            }

            // apply round transforms
            for (var r = 1; r < rounds; r++) {
                for (var i = 0; i < 4; i++) {
                    a[i] = (T1[(t[ i         ] >> 24) & 0xff] ^
                            T2[(t[(i + 1) % 4] >> 16) & 0xff] ^
                            T3[(t[(i + 2) % 4] >>  8) & 0xff] ^
                            T4[ t[(i + 3) % 4]        & 0xff] ^
                            this._Ke[r][i]);
                }
                t = a.slice();
            }

            // the last round is special
            var result = createArray(16), tt;
            for (var i = 0; i < 4; i++) {
                tt = this._Ke[rounds][i];
                result[4 * i    ] = (S[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;
                result[4 * i + 1] = (S[(t[(i + 1) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;
                result[4 * i + 2] = (S[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;
                result[4 * i + 3] = (S[ t[(i + 3) % 4]        & 0xff] ^  tt       ) & 0xff;
            }

            return result;
        }


        AES.prototype.decrypt = function(ciphertext) {
            if (ciphertext.length != 16) {
                throw new Error('invalid ciphertext size (must be 16 bytes)');
            }

            var rounds = this._Kd.length - 1;
            var a = [0, 0, 0, 0];

            // convert plaintext to (ints ^ key)
            var t = convertToInt32(ciphertext);
            for (var i = 0; i < 4; i++) {
                t[i] ^= this._Kd[0][i];
            }

            // apply round transforms
            for (var r = 1; r < rounds; r++) {
                for (var i = 0; i < 4; i++) {
                    a[i] = (T5[(t[ i          ] >> 24) & 0xff] ^
                            T6[(t[(i + 3) % 4] >> 16) & 0xff] ^
                            T7[(t[(i + 2) % 4] >>  8) & 0xff] ^
                            T8[ t[(i + 1) % 4]        & 0xff] ^
                            this._Kd[r][i]);
                }
                t = a.slice();
            }

            // the last round is special
            var result = createArray(16), tt;
            for (var i = 0; i < 4; i++) {
                tt = this._Kd[rounds][i];
                result[4 * i    ] = (Si[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;
                result[4 * i + 1] = (Si[(t[(i + 3) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;
                result[4 * i + 2] = (Si[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;
                result[4 * i + 3] = (Si[ t[(i + 1) % 4]        & 0xff] ^  tt       ) & 0xff;
            }
            if(returnString == true)
            {
              window.alert("return string");
            }
            return result;
        }


        /**
         *  Mode Of Operation - Electonic Codebook (ECB)
         */
        var ModeOfOperationECB = function(key) {
            if (!(this instanceof ModeOfOperationECB)) {
                throw Error('AES must be instanitated with `new`');
            }

            this.description = "Electronic Code Block";
            this.name = "ecb";

            this._aes = new AES(key);
        }

        ModeOfOperationECB.prototype.encrypt = function(plaintext) {
            plaintext = coerceArray(plaintext);

            if ((plaintext.length % 16) !== 0) {
                throw new Error('invalid plaintext size (must be multiple of 16 bytes)');
            }

            var ciphertext = createArray(plaintext.length);
            var block = createArray(16);

            for (var i = 0; i < plaintext.length; i += 16) {
                copyArray(plaintext, block, 0, i, i + 16);
                block = this._aes.encrypt(block);
                copyArray(block, ciphertext, i);
            }

            return ciphertext;
        }

        ModeOfOperationECB.prototype.decrypt = function(ciphertext) {
            ciphertext = coerceArray(ciphertext);

            if ((ciphertext.length % 16) !== 0) {
                throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');
            }

            var plaintext = createArray(ciphertext.length);
            var block = createArray(16);

            for (var i = 0; i < ciphertext.length; i += 16) {
                copyArray(ciphertext, block, 0, i, i + 16);
                block = this._aes.decrypt(block);
                copyArray(block, plaintext, i);
            }

            return plaintext;
        }


        /**
         *  Mode Of Operation - Cipher Block Chaining (CBC)
         */
        var ModeOfOperationCBC = function(key, iv) {
            if (!(this instanceof ModeOfOperationCBC)) {
                throw Error('AES must be instanitated with `new`');
            }

            this.description = "Cipher Block Chaining";
            this.name = "cbc";

            if (!iv) {
                iv = createArray(16);

            } else if (iv.length != 16) {
                throw new Error('invalid initialation vector size (must be 16 bytes)');
            }

            this._lastCipherblock = coerceArray(iv, true);

            this._aes = new AES(key);
        }

        ModeOfOperationCBC.prototype.encrypt = function(plaintext) {
            plaintext = coerceArray(plaintext);

            if ((plaintext.length % 16) !== 0) {
                throw new Error('invalid plaintext size (must be multiple of 16 bytes)');
            }

            var ciphertext = createArray(plaintext.length);
            var block = createArray(16);

            for (var i = 0; i < plaintext.length; i += 16) {
                copyArray(plaintext, block, 0, i, i + 16);

                for (var j = 0; j < 16; j++) {
                    block[j] ^= this._lastCipherblock[j];
                }

                this._lastCipherblock = this._aes.encrypt(block);
                copyArray(this._lastCipherblock, ciphertext, i);
            }

            return ciphertext;
        }

        ModeOfOperationCBC.prototype.decrypt = function(ciphertext) {
            ciphertext = coerceArray(ciphertext);

            if ((ciphertext.length % 16) !== 0) {
                throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');
            }

            var plaintext = createArray(ciphertext.length);
            var block = createArray(16);

            for (var i = 0; i < ciphertext.length; i += 16) {
                copyArray(ciphertext, block, 0, i, i + 16);
                block = this._aes.decrypt(block);

                for (var j = 0; j < 16; j++) {
                    plaintext[i + j] = block[j] ^ this._lastCipherblock[j];
                }

                copyArray(ciphertext, this._lastCipherblock, 0, i, i + 16);
            }

            return plaintext;
        }


        /**
         *  Mode Of Operation - Cipher Feedback (CFB)
         */
        var ModeOfOperationCFB = function(key, iv, segmentSize) {
            if (!(this instanceof ModeOfOperationCFB)) {
                throw Error('AES must be instanitated with `new`');
            }

            this.description = "Cipher Feedback";
            this.name = "cfb";

            if (!iv) {
                iv = createArray(16);

            } else if (iv.length != 16) {
                throw new Error('invalid initialation vector size (must be 16 size)');
            }

            if (!segmentSize) { segmentSize = 1; }

            this.segmentSize = segmentSize;

            this._shiftRegister = coerceArray(iv, true);

            this._aes = new AES(key);
        }

        ModeOfOperationCFB.prototype.encrypt = function(plaintext) {
            if ((plaintext.length % this.segmentSize) != 0) {
                throw new Error('invalid plaintext size (must be segmentSize bytes)');
            }

            var encrypted = coerceArray(plaintext, true);

            var xorSegment;
            for (var i = 0; i < encrypted.length; i += this.segmentSize) {
                xorSegment = this._aes.encrypt(this._shiftRegister);
                for (var j = 0; j < this.segmentSize; j++) {
                    encrypted[i + j] ^= xorSegment[j];
                }

                // Shift the register
                copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);
                copyArray(encrypted, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);
            }

            return encrypted;
        }

        ModeOfOperationCFB.prototype.decrypt = function(ciphertext) {
            if ((ciphertext.length % this.segmentSize) != 0) {
                throw new Error('invalid ciphertext size (must be segmentSize bytes)');
            }

            var plaintext = coerceArray(ciphertext, true);

            var xorSegment;
            for (var i = 0; i < plaintext.length; i += this.segmentSize) {
                xorSegment = this._aes.encrypt(this._shiftRegister);

                for (var j = 0; j < this.segmentSize; j++) {
                    plaintext[i + j] ^= xorSegment[j];
                }

                // Shift the register
                copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);
                copyArray(ciphertext, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);
            }

            return plaintext;
        }

        /**
         *  Mode Of Operation - Output Feedback (OFB)
         */
        var ModeOfOperationOFB = function(key, iv) {
            if (!(this instanceof ModeOfOperationOFB)) {
                throw Error('AES must be instanitated with `new`');
            }

            this.description = "Output Feedback";
            this.name = "ofb";

            if (!iv) {
                iv = createArray(16);

            } else if (iv.length != 16) {
                throw new Error('invalid initialation vector size (must be 16 bytes)');
            }

            this._lastPrecipher = coerceArray(iv, true);
            this._lastPrecipherIndex = 16;

            this._aes = new AES(key);
        }

        ModeOfOperationOFB.prototype.encrypt = function(plaintext) {
            var encrypted = coerceArray(plaintext, true);

            for (var i = 0; i < encrypted.length; i++) {
                if (this._lastPrecipherIndex === 16) {
                    this._lastPrecipher = this._aes.encrypt(this._lastPrecipher);
                    this._lastPrecipherIndex = 0;
                }
                encrypted[i] ^= this._lastPrecipher[this._lastPrecipherIndex++];
            }

            return encrypted;
        }

        // Decryption is symetric
        ModeOfOperationOFB.prototype.decrypt = ModeOfOperationOFB.prototype.encrypt;


        /**
         *  Counter object for CTR common mode of operation
         */
        var Counter = function(initialValue) {
            if (!(this instanceof Counter)) {
                throw Error('Counter must be instanitated with `new`');
            }

            // We allow 0, but anything false-ish uses the default 1
            if (initialValue !== 0 && !initialValue) { initialValue = 1; }

            if (typeof(initialValue) === 'number') {
                this._counter = createArray(16);
                this.setValue(initialValue);

            } else {
                this.setBytes(initialValue);
            }
        }

        Counter.prototype.setValue = function(value) {
            if (typeof(value) !== 'number' || parseInt(value) != value) {
                throw new Error('invalid counter value (must be an integer)');
            }

            for (var index = 15; index >= 0; --index) {
                this._counter[index] = value % 256;
                value = value >> 8;
            }
        }

        Counter.prototype.setBytes = function(bytes) {
            bytes = coerceArray(bytes, true);

            if (bytes.length != 16) {
                throw new Error('invalid counter bytes size (must be 16 bytes)');
            }

            this._counter = bytes;
        };

        Counter.prototype.increment = function() {
            for (var i = 15; i >= 0; i--) {
                if (this._counter[i] === 255) {
                    this._counter[i] = 0;
                } else {
                    this._counter[i]++;
                    break;
                }
            }
        }


        /**
         *  Mode Of Operation - Counter (CTR)
         */
        var ModeOfOperationCTR = function(key, counter) {
            if (!(this instanceof ModeOfOperationCTR)) {
                throw Error('AES must be instanitated with `new`');
            }

            this.description = "Counter";
            this.name = "ctr";

            if (!(counter instanceof Counter)) {
                counter = new Counter(counter)
            }

            this._counter = counter;

            this._remainingCounter = null;
            this._remainingCounterIndex = 16;

            this._aes = new AES(key);
        }

        ModeOfOperationCTR.prototype.encrypt = function(plaintext) {
            var encrypted = coerceArray(plaintext, true);

            for (var i = 0; i < encrypted.length; i++) {
                if (this._remainingCounterIndex === 16) {
                    this._remainingCounter = this._aes.encrypt(this._counter._counter);
                    this._remainingCounterIndex = 0;
                    this._counter.increment();
                }
                encrypted[i] ^= this._remainingCounter[this._remainingCounterIndex++];
            }

            return encrypted;
        }

        // Decryption is symetric
        ModeOfOperationCTR.prototype.decrypt = ModeOfOperationCTR.prototype.encrypt;


        ///////////////////////
        // Padding

        // See:https://tools.ietf.org/html/rfc2315
        function pkcs7pad(data) {
            data = coerceArray(data, true);
            var padder = 16 - (data.length % 16);
            var result = createArray(data.length + padder);
            copyArray(data, result);
            for (var i = data.length; i < result.length; i++) {
                result[i] = padder;
            }
            return result;
        }

        function pkcs7strip(data) {
            data = coerceArray(data, true);
            if (data.length < 16) { throw new Error('PKCS#7 invalid length'); }

            var padder = data[data.length - 1];
            if (padder > 16) { throw new Error('PKCS#7 padding byte out of range'); }

            var length = data.length - padder;
            for (var i = 0; i < padder; i++) {
                if (data[length + i] !== padder) {
                    throw new Error('PKCS#7 invalid padding byte');
                }
            }

            var result = createArray(length);
            copyArray(data, result, 0, 0, length);
            return result;
        }

        ///////////////////////
        // Exporting


        // The block cipher
        var aesjs = {
            AES: AES,
            Counter: Counter,

            ModeOfOperation: {
                ecb: ModeOfOperationECB,
                cbc: ModeOfOperationCBC,
                cfb: ModeOfOperationCFB,
                ofb: ModeOfOperationOFB,
                ctr: ModeOfOperationCTR
            },

            utils: {
                hex: convertHex,
                utf8: convertUtf8
            },

            padding: {
                pkcs7: {
                    pad: pkcs7pad,
                    strip: pkcs7strip
                }
            },

            _arrayTest: {
                coerceArray: coerceArray,
                createArray: createArray,
                copyArray: copyArray,
            }
        };


        // node.js
        if (typeof exports !== 'undefined') {
            module.exports = aesjs

        // RequireJS/AMD
        // http://www.requirejs.org/docs/api.html
        // https://github.com/amdjs/amdjs-api/wiki/AMD
        } else if (typeof(define) === 'function' && define.amd) {
            define(aesjs);

        // Web Browsers
        } else {

            // If there was an existing library at "aesjs" make sure it's still available
            if (root.aesjs) {
                aesjs._aesjs = root.aesjs;
            }

            root.aesjs = aesjs;
        }


    })(this);

    </script>

    <script type="text/javascript">
    function strToUtf8Bytes(str) {
        var utf8 = [];
        for (var i = 0; i < str.length; i++) {
            var charcode = str.charCodeAt(i);
            if (charcode < 0x80) utf8.push(charcode);
            else if (charcode < 0x800) {
                utf8.push(0xc0 | (charcode >> 6),
                    0x80 | (charcode & 0x3f));
            }
            else if (charcode < 0xd800 || charcode >= 0xe000) {
                utf8.push(0xe0 | (charcode >> 12),
                    0x80 | ((charcode >> 6) & 0x3f),
                    0x80 | (charcode & 0x3f));
            }
            // surrogate pair
            else {
                i++;
                // UTF-16 encodes 0x10000-0x10FFFF by
                // subtracting 0x10000 and splitting the
                // 20 bits of 0x0-0xFFFFF into two halves
                charcode = 0x10000 + (((charcode & 0x3ff) << 10)
                    | (str.charCodeAt(i) & 0x3ff));
                utf8.push(0xf0 | (charcode >> 18),
                    0x80 | ((charcode >> 12) & 0x3f),
                    0x80 | ((charcode >> 6) & 0x3f),
                    0x80 | (charcode & 0x3f));
            }
        }
        return utf8;
    }

    function bytesToUtf8String(data) { // array of bytes
        var str = '',
            i;

        //we loop trough each element in array, each byte in this case
        for (i = 0; i < data.length; i++) {
            var value = data[i];

            if (value < 0x80) {
                str += String.fromCharCode(value);
            } else if (value > 0xBF && value < 0xE0) {
                str += String.fromCharCode((value & 0x1F) << 6 | data[i + 1] & 0x3F);
                i += 1;
            } else if (value > 0xDF && value < 0xF0) {
                str += String.fromCharCode((value & 0x0F) << 12 | (data[i + 1] & 0x3F) << 6 | data[i + 2] & 0x3F);
                i += 2;
            } else {
                // surrogate pair
                var charCode = ((value & 0x07) << 18 | (data[i + 1] & 0x3F) << 12 | (data[i + 2] & 0x3F) << 6 | data[i + 3] & 0x3F) - 0x010000;

                str += String.fromCharCode(charCode >> 10 | 0xD800, charCode & 0x03FF | 0xDC00);
                i += 3;
            }
        }

        return str;
    }

    // http://www.ietf.org/rfc/rfc2781.txt
    function bytesToUtf16String(w) {
        var i = 0;
        var len = w.length;
        var w1, w2;
        var charCodes = [];
        while (i < len) {
            var w1 = w[i++];
            if ((w1 & 0xF800) !== 0xD800) { // w1 < 0xD800 || w1 > 0xDFFF
                charCodes.push(w1);
                continue;
            }
            if ((w1 & 0xFC00) === 0xD800) { // w1 >= 0xD800 && w1 <= 0xDBFF
                throw new RangeError('Invalid octet 0x' + w1.toString(16) + ' at offset ' + (i - 1));
            }
            if (i === len) {
                throw new RangeError('Expected additional octet');
            }
            w2 = w[i++];
            if ((w2 & 0xFC00) !== 0xDC00) { // w2 < 0xDC00 || w2 > 0xDFFF)
                throw new RangeError('Invalid octet 0x' + w2.toString(16) + ' at offset ' + (i - 1));
            }
            charCodes.push(((w1 & 0x3ff) << 10) + (w2 & 0x3ff) + 0x10000);
        }
        return String.fromCharCode.apply(String, charCodes);
    }

    function strToUtf16Bytes(str) {
        const bytes = [];
        for (i = 0; i < str.length; i++) {
            const code = str.charCodeAt(i); // x00-xFFFF
            bytes.push(code & 255, code >> 8); // low, high
        }
        return bytes;
    }

    function bytesToBase64String(arr) {
      const abc = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"; // base64 alphabet
      const bin = n => n.toString(2).padStart(8,0); // convert num to 8-bit binary string
      const l = arr.length
      let result = '';

      for(let i=0; i<=(l-1)/3; i++) {
        let c1 = i*3+1>=l; // case when "=" is on end
        let c2 = i*3+2>=l; // case when "=" is on end
        let chunk = bin(arr[3*i]) + bin(c1? 0:arr[3*i+1]) + bin(c2? 0:arr[3*i+2]);
        let r = chunk.match(/.{1,6}/g).map((x,j)=> j==3&&c2 ? '=' :(j==2&&c1 ? '=':abc[+('0b'+x)]));
        result += r.join('');
      }

      return result;
    }

    function base64StringToBytes(str) {
      const abc = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"]; // base64 alphabet
      let result = [];

      for(let i=0; i<str.length/4; i++) {
        let chunk = [...str.slice(4*i,4*i+4)]
        let bin = chunk.map(x=> abc.indexOf(x).toString(2).padStart(6,0)).join('');
        let bytes = bin.match(/.{1,8}/g).map(x=> +('0b'+x));
        result.push(...bytes.slice(0,3 - (str[4*i+2]=="=") - (str[4*i+3]=="=")));
      }
      return result;
    }


    function substringByNullTerminator(str)
    {
        for(var x = 0; x < str.length; x++)
        {
          if(str.charCodeAt(x) == 0)
          {
              return str.substring(0,x);
          }
        }
        return str;
    }

    var sha256 = function sha256(ascii) {
        function rightRotate(value, amount) {
            return (value>>>amount) | (value<<(32 - amount));
        };

        var mathPow = Math.pow;
        var maxWord = mathPow(2, 32);
        var lengthProperty = 'length'
        var i, j; // Used as a counter across the whole file
        var result = ''

        var words = [];
        var asciiBitLength = ascii[lengthProperty]*8;

        //* caching results is optional - remove/add slash from front of this line to toggle
        // Initial hash value: first 32 bits of the fractional parts of the square roots of the first 8 primes
        // (we actually calculate the first 64, but extra values are just ignored)
        var hash = sha256.h = sha256.h || [];
        // Round constants: first 32 bits of the fractional parts of the cube roots of the first 64 primes
        var k = sha256.k = sha256.k || [];
        var primeCounter = k[lengthProperty];
        /*/
        var hash = [], k = [];
        var primeCounter = 0;
        //*/

        var isComposite = {};
        for (var candidate = 2; primeCounter < 64; candidate++) {
            if (!isComposite[candidate]) {
                for (i = 0; i < 313; i += candidate) {
                    isComposite[i] = candidate;
                }
                hash[primeCounter] = (mathPow(candidate, .5)*maxWord)|0;
                k[primeCounter++] = (mathPow(candidate, 1/3)*maxWord)|0;
            }
        }

        ascii += '\x80' // Append ' bit (plus zero padding)
        while (ascii[lengthProperty]%64 - 56) ascii += '\x00' // More zero padding
        for (i = 0; i < ascii[lengthProperty]; i++) {
            j = ascii.charCodeAt(i);
            if (j>>8) return; // ASCII check: only accept characters in range 0-255
            words[i>>2] |= j << ((3 - i)%4)*8;
        }
        words[words[lengthProperty]] = ((asciiBitLength/maxWord)|0);
        words[words[lengthProperty]] = (asciiBitLength)

        // process each chunk
        for (j = 0; j < words[lengthProperty];) {
            var w = words.slice(j, j += 16); // The message is expanded into 64 words as part of the iteration
            var oldHash = hash;
            // This is now the undefinedworking hash", often labelled as variables a...g
            // (we have to truncate as well, otherwise extra entries at the end accumulate
            hash = hash.slice(0, 8);

            for (i = 0; i < 64; i++) {
                var i2 = i + j;
                // Expand the message into 64 words
                // Used below if
                var w15 = w[i - 15], w2 = w[i - 2];

                // Iterate
                var a = hash[0], e = hash[4];
                var temp1 = hash[7]
                    + (rightRotate(e, 6) ^ rightRotate(e, 11) ^ rightRotate(e, 25)) // S1
                    + ((e&hash[5])^((~e)&hash[6])) // ch
                    + k[i]
                    // Expand the message schedule if needed
                    + (w[i] = (i < 16) ? w[i] : (
                            w[i - 16]
                            + (rightRotate(w15, 7) ^ rightRotate(w15, 18) ^ (w15>>>3)) // s0
                            + w[i - 7]
                            + (rightRotate(w2, 17) ^ rightRotate(w2, 19) ^ (w2>>>10)) // s1
                        )|0
                    );
                // This is only used once, so *could* be moved below, but it only saves 4 bytes and makes things unreadble
                var temp2 = (rightRotate(a, 2) ^ rightRotate(a, 13) ^ rightRotate(a, 22)) // S0
                    + ((a&hash[1])^(a&hash[2])^(hash[1]&hash[2])); // maj

                hash = [(temp1 + temp2)|0].concat(hash); // We don't bother trimming off the extra ones, they're harmless as long as we're truncating when we do the slice()
                hash[4] = (hash[4] + temp1)|0;
            }

            for (i = 0; i < 8; i++) {
                hash[i] = (hash[i] + oldHash[i])|0;
            }
        }

        for (i = 0; i < 8; i++) {
            for (j = 3; j + 1; j--) {
                var b = (hash[i]>>(j*8))&255;
                result += ((b < 16) ? 0 : '') + b.toString(16);
            }
        }
        return result;
    };

    </script>

    <script type="text/javascript">
    // Copyright (c) 2005  Tom Wu
    // All Rights Reserved.
    // See "LICENSE" for details.
    // Basic JavaScript BN library - subset useful for RSA encryption.

    // Bits per digit
    var dbits;

    // JavaScript engine analysis
    var canary = 0xdeadbeefcafe;
    var j_lm = ((canary & 0xffffff) == 0xefcafe);

    // (public) Constructor

    function BigInteger(a, b, c) {
        if (a != null) if ("number" == typeof a) this.fromNumber(a, b, c);
        else if (b == null && "string" != typeof a) this.fromString(a, 256);
        else this.fromString(a, b);
    }

    // return new, unset BigInteger

    function nbi() {
        return new BigInteger(null);
    }

    // am: Compute w_j += (x*this_i), propagate carries,
    // c is initial carry, returns final carry.
    // c < 3*dvalue, x < 2*dvalue, this_i < dvalue
    // We need to select the fastest one that works in this environment.
    // am1: use a single mult and divide to get the high bits,
    // max digit bits should be 26 because
    // max internal value = 2*dvalue^2-2*dvalue (< 2^53)

    function am1(i, x, w, j, c, n) {
        while (--n >= 0) {
            var v = x * this[i++] + w[j] + c;
            c = Math.floor(v / 0x4000000);
            w[j++] = v & 0x3ffffff;
        }
        return c;
    }
    // am2 avoids a big mult-and-extract completely.
    // Max digit bits should be <= 30 because we do bitwise ops
    // on values up to 2*hdvalue^2-hdvalue-1 (< 2^31)

    function am2(i, x, w, j, c, n) {
        var xl = x & 0x7fff,
            xh = x >> 15;
        while (--n >= 0) {
            var l = this[i] & 0x7fff;
            var h = this[i++] >> 15;
            var m = xh * l + h * xl;
            l = xl * l + ((m & 0x7fff) << 15) + w[j] + (c & 0x3fffffff);
            c = (l >>> 30) + (m >>> 15) + xh * h + (c >>> 30);
            w[j++] = l & 0x3fffffff;
        }
        return c;
    }
    // Alternately, set max digit bits to 28 since some
    // browsers slow down when dealing with 32-bit numbers.

    function am3(i, x, w, j, c, n) {
        var xl = x & 0x3fff,
            xh = x >> 14;
        while (--n >= 0) {
            var l = this[i] & 0x3fff;
            var h = this[i++] >> 14;
            var m = xh * l + h * xl;
            l = xl * l + ((m & 0x3fff) << 14) + w[j] + c;
            c = (l >> 28) + (m >> 14) + xh * h;
            w[j++] = l & 0xfffffff;
        }
        return c;
    }
    if (j_lm && (navigator.appName == "Microsoft Internet Explorer")) {
        BigInteger.prototype.am = am2;
        dbits = 30;
    }
    else if (j_lm && (navigator.appName != "Netscape")) {
        BigInteger.prototype.am = am1;
        dbits = 26;
    }
    else { // Mozilla/Netscape seems to prefer am3
        BigInteger.prototype.am = am3;
        dbits = 28;
    }

    BigInteger.prototype.DB = dbits;
    BigInteger.prototype.DM = ((1 << dbits) - 1);
    BigInteger.prototype.DV = (1 << dbits);

    var BI_FP = 52;
    BigInteger.prototype.FV = Math.pow(2, BI_FP);
    BigInteger.prototype.F1 = BI_FP - dbits;
    BigInteger.prototype.F2 = 2 * dbits - BI_FP;

    // Digit conversions
    var BI_RM = "0123456789abcdefghijklmnopqrstuvwxyz";
    var BI_RC = new Array();
    var rr, vv;
    rr = "0".charCodeAt(0);
    for (vv = 0; vv <= 9; ++vv) BI_RC[rr++] = vv;
    rr = "a".charCodeAt(0);
    for (vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;
    rr = "A".charCodeAt(0);
    for (vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;

    function int2char(n) {
        return BI_RM.charAt(n);
    }

    function intAt(s, i) {
        var c = BI_RC[s.charCodeAt(i)];
        return (c == null) ? -1 : c;
    }

    // (protected) copy this to r

    function bnpCopyTo(r) {
        for (var i = this.t - 1; i >= 0; --i) r[i] = this[i];
        r.t = this.t;
        r.s = this.s;
    }

    // (protected) set from integer value x, -DV <= x < DV

    function bnpFromInt(x) {
        this.t = 1;
        this.s = (x < 0) ? -1 : 0;
        if (x > 0) this[0] = x;
        else if (x < -1) this[0] = x + DV;
        else this.t = 0;
    }

    // return bigint initialized to value

    function nbv(i) {
        var r = nbi();
        r.fromInt(i);
        return r;
    }

    // (protected) set from string and radix

    function bnpFromString(s, b) {
        var k;
        if (b == 16) k = 4;
        else if (b == 8) k = 3;
        else if (b == 256) k = 8; // byte array
        else if (b == 2) k = 1;
        else if (b == 32) k = 5;
        else if (b == 4) k = 2;
        else {
            this.fromRadix(s, b);
            return;
        }
        this.t = 0;
        this.s = 0;
        var i = s.length,
            mi = false,
            sh = 0;
        while (--i >= 0) {
            var x = (k == 8) ? s[i] & 0xff : intAt(s, i);
            if (x < 0) {
                if (s.charAt(i) == "-") mi = true;
                continue;
            }
            mi = false;
            if (sh == 0) this[this.t++] = x;
            else if (sh + k > this.DB) {
                this[this.t - 1] |= (x & ((1 << (this.DB - sh)) - 1)) << sh;
                this[this.t++] = (x >> (this.DB - sh));
            }
            else this[this.t - 1] |= x << sh;
            sh += k;
            if (sh >= this.DB) sh -= this.DB;
        }
        if (k == 8 && (s[0] & 0x80) != 0) {
            this.s = -1;
            if (sh > 0) this[this.t - 1] |= ((1 << (this.DB - sh)) - 1) << sh;
        }
        this.clamp();
        if (mi) BigInteger.ZERO.subTo(this, this);
    }

    // (protected) clamp off excess high words

    function bnpClamp() {
        var c = this.s & this.DM;
        while (this.t > 0 && this[this.t - 1] == c)--this.t;
    }

    // (public) return string representation in given radix

    function bnToString(b) {
        if (this.s < 0) return "-" + this.negate().toString(b);
        var k;
        if (b == 16) k = 4;
        else if (b == 8) k = 3;
        else if (b == 2) k = 1;
        else if (b == 32) k = 5;
        else if (b == 64) k = 6;
        else if (b == 4) k = 2;
        else return this.toRadix(b);
        var km = (1 << k) - 1,
            d, m = false,
            r = "",
            i = this.t;
        var p = this.DB - (i * this.DB) % k;
        if (i-- > 0) {
            if (p < this.DB && (d = this[i] >> p) > 0) {
                m = true;
                r = int2char(d);
            }
            while (i >= 0) {
                if (p < k) {
                    d = (this[i] & ((1 << p) - 1)) << (k - p);
                    d |= this[--i] >> (p += this.DB - k);
                }
                else {
                    d = (this[i] >> (p -= k)) & km;
                    if (p <= 0) {
                        p += this.DB;
                        --i;
                    }
                }
                if (d > 0) m = true;
                if (m) r += int2char(d);
            }
        }
        return m ? r : "0";
    }

    // (public) -this

    function bnNegate() {
        var r = nbi();
        BigInteger.ZERO.subTo(this, r);
        return r;
    }

    // (public) |this|

    function bnAbs() {
        return (this.s < 0) ? this.negate() : this;
    }

    // (public) return + if this > a, - if this < a, 0 if equal

    function bnCompareTo(a) {
        var r = this.s - a.s;
        if (r != 0) return r;
        var i = this.t;
        r = i - a.t;
        if (r != 0) return r;
        while (--i >= 0) if ((r = this[i] - a[i]) != 0) return r;
        return 0;
    }

    // returns bit length of the integer x

    function nbits(x) {
        var r = 1,
            t;
        if ((t = x >>> 16) != 0) {
            x = t;
            r += 16;
        }
        if ((t = x >> 8) != 0) {
            x = t;
            r += 8;
        }
        if ((t = x >> 4) != 0) {
            x = t;
            r += 4;
        }
        if ((t = x >> 2) != 0) {
            x = t;
            r += 2;
        }
        if ((t = x >> 1) != 0) {
            x = t;
            r += 1;
        }
        return r;
    }

    // (public) return the number of bits in "this"

    function bnBitLength() {
        if (this.t <= 0) return 0;
        return this.DB * (this.t - 1) + nbits(this[this.t - 1] ^ (this.s & this.DM));
    }

    // (protected) r = this << n*DB

    function bnpDLShiftTo(n, r) {
        var i;
        for (i = this.t - 1; i >= 0; --i) r[i + n] = this[i];
        for (i = n - 1; i >= 0; --i) r[i] = 0;
        r.t = this.t + n;
        r.s = this.s;
    }

    // (protected) r = this >> n*DB

    function bnpDRShiftTo(n, r) {
        for (var i = n; i < this.t; ++i) r[i - n] = this[i];
        r.t = Math.max(this.t - n, 0);
        r.s = this.s;
    }

    // (protected) r = this << n

    function bnpLShiftTo(n, r) {
        var bs = n % this.DB;
        var cbs = this.DB - bs;
        var bm = (1 << cbs) - 1;
        var ds = Math.floor(n / this.DB),
            c = (this.s << bs) & this.DM,
            i;
        for (i = this.t - 1; i >= 0; --i) {
            r[i + ds + 1] = (this[i] >> cbs) | c;
            c = (this[i] & bm) << bs;
        }
        for (i = ds - 1; i >= 0; --i) r[i] = 0;
        r[ds] = c;
        r.t = this.t + ds + 1;
        r.s = this.s;
        r.clamp();
    }

    // (protected) r = this >> n

    function bnpRShiftTo(n, r) {
        r.s = this.s;
        var ds = Math.floor(n / this.DB);
        if (ds >= this.t) {
            r.t = 0;
            return;
        }
        var bs = n % this.DB;
        var cbs = this.DB - bs;
        var bm = (1 << bs) - 1;
        r[0] = this[ds] >> bs;
        for (var i = ds + 1; i < this.t; ++i) {
            r[i - ds - 1] |= (this[i] & bm) << cbs;
            r[i - ds] = this[i] >> bs;
        }
        if (bs > 0) r[this.t - ds - 1] |= (this.s & bm) << cbs;
        r.t = this.t - ds;
        r.clamp();
    }

    // (protected) r = this - a

    function bnpSubTo(a, r) {
        var i = 0,
            c = 0,
            m = Math.min(a.t, this.t);
        while (i < m) {
            c += this[i] - a[i];
            r[i++] = c & this.DM;
            c >>= this.DB;
        }
        if (a.t < this.t) {
            c -= a.s;
            while (i < this.t) {
                c += this[i];
                r[i++] = c & this.DM;
                c >>= this.DB;
            }
            c += this.s;
        }
        else {
            c += this.s;
            while (i < a.t) {
                c -= a[i];
                r[i++] = c & this.DM;
                c >>= this.DB;
            }
            c -= a.s;
        }
        r.s = (c < 0) ? -1 : 0;
        if (c < -1) r[i++] = this.DV + c;
        else if (c > 0) r[i++] = c;
        r.t = i;
        r.clamp();
    }

    // (protected) r = this * a, r != this,a (HAC 14.12)
    // "this" should be the larger one if appropriate.

    function bnpMultiplyTo(a, r) {
        var x = this.abs(),
            y = a.abs();
        var i = x.t;
        r.t = i + y.t;
        while (--i >= 0) r[i] = 0;
        for (i = 0; i < y.t; ++i) r[i + x.t] = x.am(0, y[i], r, i, 0, x.t);
        r.s = 0;
        r.clamp();
        if (this.s != a.s) BigInteger.ZERO.subTo(r, r);
    }

    // (protected) r = this^2, r != this (HAC 14.16)

    function bnpSquareTo(r) {
        var x = this.abs();
        var i = r.t = 2 * x.t;
        while (--i >= 0) r[i] = 0;
        for (i = 0; i < x.t - 1; ++i) {
            var c = x.am(i, x[i], r, 2 * i, 0, 1);
            if ((r[i + x.t] += x.am(i + 1, 2 * x[i], r, 2 * i + 1, c, x.t - i - 1)) >= x.DV) {
                r[i + x.t] -= x.DV;
                r[i + x.t + 1] = 1;
            }
        }
        if (r.t > 0) r[r.t - 1] += x.am(i, x[i], r, 2 * i, 0, 1);
        r.s = 0;
        r.clamp();
    }

    // (protected) divide this by m, quotient and remainder to q, r (HAC 14.20)
    // r != q, this != m.  q or r may be null.

    function bnpDivRemTo(m, q, r) {
        var pm = m.abs();
        if (pm.t <= 0) return;
        var pt = this.abs();
        if (pt.t < pm.t) {
            if (q != null) q.fromInt(0);
            if (r != null) this.copyTo(r);
            return;
        }
        if (r == null) r = nbi();
        var y = nbi(),
            ts = this.s,
            ms = m.s;
        var nsh = this.DB - nbits(pm[pm.t - 1]); // normalize modulus
        if (nsh > 0) {
            pm.lShiftTo(nsh, y);
            pt.lShiftTo(nsh, r);
        }
        else {
            pm.copyTo(y);
            pt.copyTo(r);
        }
        var ys = y.t;
        var y0 = y[ys - 1];
        if (y0 == 0) return;
        var yt = y0 * (1 << this.F1) + ((ys > 1) ? y[ys - 2] >> this.F2 : 0);
        var d1 = this.FV / yt,
            d2 = (1 << this.F1) / yt,
            e = 1 << this.F2;
        var i = r.t,
            j = i - ys,
            t = (q == null) ? nbi() : q;
        y.dlShiftTo(j, t);
        if (r.compareTo(t) >= 0) {
            r[r.t++] = 1;
            r.subTo(t, r);
        }
        BigInteger.ONE.dlShiftTo(ys, t);
        t.subTo(y, y); // "negative" y so we can replace sub with am later
        while (y.t < ys) y[y.t++] = 0;
        while (--j >= 0) {
            // Estimate quotient digit
            var qd = (r[--i] == y0) ? this.DM : Math.floor(r[i] * d1 + (r[i - 1] + e) * d2);
            if ((r[i] += y.am(0, qd, r, j, 0, ys)) < qd) { // Try it out
                y.dlShiftTo(j, t);
                r.subTo(t, r);
                while (r[i] < --qd) r.subTo(t, r);
            }
        }
        if (q != null) {
            r.drShiftTo(ys, q);
            if (ts != ms) BigInteger.ZERO.subTo(q, q);
        }
        r.t = ys;
        r.clamp();
        if (nsh > 0) r.rShiftTo(nsh, r); // Denormalize remainder
        if (ts < 0) BigInteger.ZERO.subTo(r, r);
    }

    // (public) this mod a

    function bnMod(a) {
        var r = nbi();
        this.abs().divRemTo(a, null, r);
        if (this.s < 0 && r.compareTo(BigInteger.ZERO) > 0) a.subTo(r, r);
        return r;
    }

    // Modular reduction using "classic" algorithm

    function Classic(m) {
        this.m = m;
    }

    function cConvert(x) {
        if (x.s < 0 || x.compareTo(this.m) >= 0) return x.mod(this.m);
        else return x;
    }

    function cRevert(x) {
        return x;
    }

    function cReduce(x) {
        x.divRemTo(this.m, null, x);
    }

    function cMulTo(x, y, r) {
        x.multiplyTo(y, r);
        this.reduce(r);
    }

    function cSqrTo(x, r) {
        x.squareTo(r);
        this.reduce(r);
    }

    Classic.prototype.convert = cConvert;
    Classic.prototype.revert = cRevert;
    Classic.prototype.reduce = cReduce;
    Classic.prototype.mulTo = cMulTo;
    Classic.prototype.sqrTo = cSqrTo;

    // (protected) return "-1/this % 2^DB"; useful for Mont. reduction
    // justification:
    //         xy == 1 (mod m)
    //         xy =  1+km
    //   xy(2-xy) = (1+km)(1-km)
    // x[y(2-xy)] = 1-k^2m^2
    // x[y(2-xy)] == 1 (mod m^2)
    // if y is 1/x mod m, then y(2-xy) is 1/x mod m^2
    // should reduce x and y(2-xy) by m^2 at each step to keep size bounded.
    // JS multiply "overflows" differently from C/C++, so care is needed here.

    function bnpInvDigit() {
        if (this.t < 1) return 0;
        var x = this[0];
        if ((x & 1) == 0) return 0;
        var y = x & 3; // y == 1/x mod 2^2
        y = (y * (2 - (x & 0xf) * y)) & 0xf; // y == 1/x mod 2^4
        y = (y * (2 - (x & 0xff) * y)) & 0xff; // y == 1/x mod 2^8
        y = (y * (2 - (((x & 0xffff) * y) & 0xffff))) & 0xffff; // y == 1/x mod 2^16
        // last step - calculate inverse mod DV directly;
        // assumes 16 < DB <= 32 and assumes ability to handle 48-bit ints
        y = (y * (2 - x * y % this.DV)) % this.DV; // y == 1/x mod 2^dbits
        // we really want the negative inverse, and -DV < y < DV
        return (y > 0) ? this.DV - y : -y;
    }

    // Montgomery reduction

    function Montgomery(m) {
        this.m = m;
        this.mp = m.invDigit();
        this.mpl = this.mp & 0x7fff;
        this.mph = this.mp >> 15;
        this.um = (1 << (m.DB - 15)) - 1;
        this.mt2 = 2 * m.t;
    }

    // xR mod m

    function montConvert(x) {
        var r = nbi();
        x.abs().dlShiftTo(this.m.t, r);
        r.divRemTo(this.m, null, r);
        if (x.s < 0 && r.compareTo(BigInteger.ZERO) > 0) this.m.subTo(r, r);
        return r;
    }

    // x/R mod m

    function montRevert(x) {
        var r = nbi();
        x.copyTo(r);
        this.reduce(r);
        return r;
    }

    // x = x/R mod m (HAC 14.32)

    function montReduce(x) {
        while (x.t <= this.mt2) // pad x so am has enough room later
        x[x.t++] = 0;
        for (var i = 0; i < this.m.t; ++i) {
            // faster way of calculating u0 = x[i]*mp mod DV
            var j = x[i] & 0x7fff;
            var u0 = (j * this.mpl + (((j * this.mph + (x[i] >> 15) * this.mpl) & this.um) << 15)) & x.DM;
            // use am to combine the multiply-shift-add into one call
            j = i + this.m.t;
            x[j] += this.m.am(0, u0, x, i, 0, this.m.t);
            // propagate carry
            while (x[j] >= x.DV) {
                x[j] -= x.DV;
                x[++j]++;
            }
        }
        x.clamp();
        x.drShiftTo(this.m.t, x);
        if (x.compareTo(this.m) >= 0) x.subTo(this.m, x);
    }

    // r = "x^2/R mod m"; x != r

    function montSqrTo(x, r) {
        x.squareTo(r);
        this.reduce(r);
    }

    // r = "xy/R mod m"; x,y != r

    function montMulTo(x, y, r) {
        x.multiplyTo(y, r);
        this.reduce(r);
    }

    Montgomery.prototype.convert = montConvert;
    Montgomery.prototype.revert = montRevert;
    Montgomery.prototype.reduce = montReduce;
    Montgomery.prototype.mulTo = montMulTo;
    Montgomery.prototype.sqrTo = montSqrTo;

    // (protected) true iff this is even

    function bnpIsEven() {
        return ((this.t > 0) ? (this[0] & 1) : this.s) == 0;
    }

    // (protected) this^e, e < 2^32, doing sqr and mul with "r" (HAC 14.79)

    function bnpExp(e, z) {
        if (e > 0xffffffff || e < 1) return BigInteger.ONE;
        var r = nbi(),
            r2 = nbi(),
            g = z.convert(this),
            i = nbits(e) - 1;
        g.copyTo(r);
        while (--i >= 0) {
            z.sqrTo(r, r2);
            if ((e & (1 << i)) > 0) z.mulTo(r2, g, r);
            else {
                var t = r;
                r = r2;
                r2 = t;
            }
        }
        return z.revert(r);
    }

    // (public) this^e % m, 0 <= e < 2^32

    function bnModPowInt(e, m) {
        var z;
        if (e < 256 || m.isEven()) z = new Classic(m);
        else z = new Montgomery(m);
        return this.exp(e, z);
    }

    // protected
    BigInteger.prototype.copyTo = bnpCopyTo;
    BigInteger.prototype.fromInt = bnpFromInt;
    BigInteger.prototype.fromString = bnpFromString;
    BigInteger.prototype.clamp = bnpClamp;
    BigInteger.prototype.dlShiftTo = bnpDLShiftTo;
    BigInteger.prototype.drShiftTo = bnpDRShiftTo;
    BigInteger.prototype.lShiftTo = bnpLShiftTo;
    BigInteger.prototype.rShiftTo = bnpRShiftTo;
    BigInteger.prototype.subTo = bnpSubTo;
    BigInteger.prototype.multiplyTo = bnpMultiplyTo;
    BigInteger.prototype.squareTo = bnpSquareTo;
    BigInteger.prototype.divRemTo = bnpDivRemTo;
    BigInteger.prototype.invDigit = bnpInvDigit;
    BigInteger.prototype.isEven = bnpIsEven;
    BigInteger.prototype.exp = bnpExp;

    // public
    BigInteger.prototype.toString = bnToString;
    BigInteger.prototype.negate = bnNegate;
    BigInteger.prototype.abs = bnAbs;
    BigInteger.prototype.compareTo = bnCompareTo;
    BigInteger.prototype.bitLength = bnBitLength;
    BigInteger.prototype.mod = bnMod;
    BigInteger.prototype.modPowInt = bnModPowInt;

    // "constants"
    BigInteger.ZERO = nbv(0);
    BigInteger.ONE = nbv(1);


    function bnClone() {
        var r = nbi();
        this.copyTo(r);
        return r;
    }

    // (public) return value as integer

    function bnIntValue() {
        if (this.s < 0) {
            if (this.t == 1) return this[0] - this.DV;
            else if (this.t == 0) return -1;
        }
        else if (this.t == 1) return this[0];
        else if (this.t == 0) return 0;
        // assumes 16 < DB < 32
        return ((this[1] & ((1 << (32 - this.DB)) - 1)) << this.DB) | this[0];
    }

    // (public) return value as byte

    function bnByteValue() {
        return (this.t == 0) ? this.s : (this[0] << 24) >> 24;
    }

    // (public) return value as short (assumes DB>=16)

    function bnShortValue() {
        return (this.t == 0) ? this.s : (this[0] << 16) >> 16;
    }

    // (protected) return x s.t. r^x < DV

    function bnpChunkSize(r) {
        return Math.floor(Math.LN2 * this.DB / Math.log(r));
    }

    // (public) 0 if this == 0, 1 if this > 0

    function bnSigNum() {
        if (this.s < 0) return -1;
        else if (this.t <= 0 || (this.t == 1 && this[0] <= 0)) return 0;
        else return 1;
    }

    // (protected) convert to radix string

    function bnpToRadix(b) {
        if (b == null) b = 10;
        if (this.signum() == 0 || b < 2 || b > 36) return "0";
        var cs = this.chunkSize(b);
        var a = Math.pow(b, cs);
        var d = nbv(a),
            y = nbi(),
            z = nbi(),
            r = "";
        this.divRemTo(d, y, z);
        while (y.signum() > 0) {
            r = (a + z.intValue()).toString(b).substr(1) + r;
            y.divRemTo(d, y, z);
        }
        return z.intValue().toString(b) + r;
    }

    // (protected) convert from radix string

    function bnpFromRadix(s, b) {
        this.fromInt(0);
        if (b == null) b = 10;
        var cs = this.chunkSize(b);
        var d = Math.pow(b, cs),
            mi = false,
            j = 0,
            w = 0;
        for (var i = 0; i < s.length; ++i) {
            var x = intAt(s, i);
            if (x < 0) {
                if (s.charAt(i) == "-" && this.signum() == 0) mi = true;
                continue;
            }
            w = b * w + x;
            if (++j >= cs) {
                this.dMultiply(d);
                this.dAddOffset(w, 0);
                j = 0;
                w = 0;
            }
        }
        if (j > 0) {
            this.dMultiply(Math.pow(b, j));
            this.dAddOffset(w, 0);
        }
        if (mi) BigInteger.ZERO.subTo(this, this);
    }

    // (protected) alternate constructor

    function bnpFromNumber(a, b, c) {
        if ("number" == typeof b) {
            // new BigInteger(int,int,RNG)
            if (a < 2) this.fromInt(1);
            else {
                this.fromNumber(a, c);
                if (!this.testBit(a - 1)) // force MSB set
                this.bitwiseTo(BigInteger.ONE.shiftLeft(a - 1), op_or, this);
                if (this.isEven()) this.dAddOffset(1, 0); // force odd
                while (!this.isProbablePrime(b)) {
                    this.dAddOffset(2, 0);
                    if (this.bitLength() > a) this.subTo(BigInteger.ONE.shiftLeft(a - 1), this);
                }
            }
        }
        else {
            // new BigInteger(int,RNG)
            var x = new Array(),
                t = a & 7;
            x.length = (a >> 3) + 1;
            b.nextBytes(x);
            if (t > 0) x[0] &= ((1 << t) - 1);
            else x[0] = 0;
            this.fromString(x, 256);
        }
    }

    // (public) convert to bigendian byte array

    function bnToByteArray() {
        var i = this.t,
            r = new Array();
        r[0] = this.s;
        var p = this.DB - (i * this.DB) % 8,
            d, k = 0;
        if (i-- > 0) {
            if (p < this.DB && (d = this[i] >> p) != (this.s & this.DM) >> p) r[k++] = d | (this.s << (this.DB - p));
            while (i >= 0) {
                if (p < 8) {
                    d = (this[i] & ((1 << p) - 1)) << (8 - p);
                    d |= this[--i] >> (p += this.DB - 8);
                }
                else {
                    d = (this[i] >> (p -= 8)) & 0xff;
                    if (p <= 0) {
                        p += this.DB;
                        --i;
                    }
                }
                if ((d & 0x80) != 0) d |= -256;
                if (k == 0 && (this.s & 0x80) != (d & 0x80))++k;
                if (k > 0 || d != this.s) r[k++] = d;
            }
        }
        return r;
    }

    function bnEquals(a) {
        return (this.compareTo(a) == 0);
    }

    function bnMin(a) {
        return (this.compareTo(a) < 0) ? this : a;
    }

    function bnMax(a) {
        return (this.compareTo(a) > 0) ? this : a;
    }

    // (protected) r = this op a (bitwise)

    function bnpBitwiseTo(a, op, r) {
        var i, f, m = Math.min(a.t, this.t);
        for (i = 0; i < m; ++i) r[i] = op(this[i], a[i]);
        if (a.t < this.t) {
            f = a.s & this.DM;
            for (i = m; i < this.t; ++i) r[i] = op(this[i], f);
            r.t = this.t;
        }
        else {
            f = this.s & this.DM;
            for (i = m; i < a.t; ++i) r[i] = op(f, a[i]);
            r.t = a.t;
        }
        r.s = op(this.s, a.s);
        r.clamp();
    }

    // (public) this & a

    function op_and(x, y) {
        return x & y;
    }

    function bnAnd(a) {
        var r = nbi();
        this.bitwiseTo(a, op_and, r);
        return r;
    }

    // (public) this | a

    function op_or(x, y) {
        return x | y;
    }

    function bnOr(a) {
        var r = nbi();
        this.bitwiseTo(a, op_or, r);
        return r;
    }

    // (public) this ^ a

    function op_xor(x, y) {
        return x ^ y;
    }

    function bnXor(a) {
        var r = nbi();
        this.bitwiseTo(a, op_xor, r);
        return r;
    }

    // (public) this & ~a

    function op_andnot(x, y) {
        return x & ~y;
    }

    function bnAndNot(a) {
        var r = nbi();
        this.bitwiseTo(a, op_andnot, r);
        return r;
    }

    // (public) ~this

    function bnNot() {
        var r = nbi();
        for (var i = 0; i < this.t; ++i) r[i] = this.DM & ~this[i];
        r.t = this.t;
        r.s = ~this.s;
        return r;
    }

    // (public) this << n

    function bnShiftLeft(n) {
        var r = nbi();
        if (n < 0) this.rShiftTo(-n, r);
        else this.lShiftTo(n, r);
        return r;
    }

    // (public) this >> n

    function bnShiftRight(n) {
        var r = nbi();
        if (n < 0) this.lShiftTo(-n, r);
        else this.rShiftTo(n, r);
        return r;
    }

    // return index of lowest 1-bit in x, x < 2^31

    function lbit(x) {
        if (x == 0) return -1;
        var r = 0;
        if ((x & 0xffff) == 0) {
            x >>= 16;
            r += 16;
        }
        if ((x & 0xff) == 0) {
            x >>= 8;
            r += 8;
        }
        if ((x & 0xf) == 0) {
            x >>= 4;
            r += 4;
        }
        if ((x & 3) == 0) {
            x >>= 2;
            r += 2;
        }
        if ((x & 1) == 0)++r;
        return r;
    }

    // (public) returns index of lowest 1-bit (or -1 if none)

    function bnGetLowestSetBit() {
        for (var i = 0; i < this.t; ++i)
        if (this[i] != 0) return i * this.DB + lbit(this[i]);
        if (this.s < 0) return this.t * this.DB;
        return -1;
    }

    // return number of 1 bits in x

    function cbit(x) {
        var r = 0;
        while (x != 0) {
            x &= x - 1;
            ++r;
        }
        return r;
    }

    // (public) return number of set bits

    function bnBitCount() {
        var r = 0,
            x = this.s & this.DM;
        for (var i = 0; i < this.t; ++i) r += cbit(this[i] ^ x);
        return r;
    }

    // (public) true iff nth bit is set

    function bnTestBit(n) {
        var j = Math.floor(n / this.DB);
        if (j >= this.t) return (this.s != 0);
        return ((this[j] & (1 << (n % this.DB))) != 0);
    }

    // (protected) this op (1<<n)

    function bnpChangeBit(n, op) {
        var r = BigInteger.ONE.shiftLeft(n);
        this.bitwiseTo(r, op, r);
        return r;
    }

    // (public) this | (1<<n)

    function bnSetBit(n) {
        return this.changeBit(n, op_or);
    }

    // (public) this & ~(1<<n)

    function bnClearBit(n) {
        return this.changeBit(n, op_andnot);
    }

    // (public) this ^ (1<<n)

    function bnFlipBit(n) {
        return this.changeBit(n, op_xor);
    }

    // (protected) r = this + a

    function bnpAddTo(a, r) {
        var i = 0,
            c = 0,
            m = Math.min(a.t, this.t);
        while (i < m) {
            c += this[i] + a[i];
            r[i++] = c & this.DM;
            c >>= this.DB;
        }
        if (a.t < this.t) {
            c += a.s;
            while (i < this.t) {
                c += this[i];
                r[i++] = c & this.DM;
                c >>= this.DB;
            }
            c += this.s;
        }
        else {
            c += this.s;
            while (i < a.t) {
                c += a[i];
                r[i++] = c & this.DM;
                c >>= this.DB;
            }
            c += a.s;
        }
        r.s = (c < 0) ? -1 : 0;
        if (c > 0) r[i++] = c;
        else if (c < -1) r[i++] = this.DV + c;
        r.t = i;
        r.clamp();
    }

    // (public) this + a

    function bnAdd(a) {
        var r = nbi();
        this.addTo(a, r);
        return r;
    }

    // (public) this - a

    function bnSubtract(a) {
        var r = nbi();
        this.subTo(a, r);
        return r;
    }

    // (public) this * a

    function bnMultiply(a) {
        var r = nbi();
        this.multiplyTo(a, r);
        return r;
    }

    // (public) this^2

    function bnSquare() {
        var r = nbi();
        this.squareTo(r);
        return r;
    }

    // (public) this / a

    function bnDivide(a) {
        var r = nbi();
        this.divRemTo(a, r, null);
        return r;
    }

    // (public) this % a

    function bnRemainder(a) {
        var r = nbi();
        this.divRemTo(a, null, r);
        return r;
    }

    // (public) [this/a,this%a]

    function bnDivideAndRemainder(a) {
        var q = nbi(),
            r = nbi();
        this.divRemTo(a, q, r);
        return new Array(q, r);
    }

    // (protected) this *= n, this >= 0, 1 < n < DV

    function bnpDMultiply(n) {
        this[this.t] = this.am(0, n - 1, this, 0, 0, this.t);
        ++this.t;
        this.clamp();
    }

    // (protected) this += n << w words, this >= 0

    function bnpDAddOffset(n, w) {
        if (n == 0) return;
        while (this.t <= w) this[this.t++] = 0;
        this[w] += n;
        while (this[w] >= this.DV) {
            this[w] -= this.DV;
            if (++w >= this.t) this[this.t++] = 0;
            ++this[w];
        }
    }

    // A "null" reducer

    function NullExp() {}

    function nNop(x) {
        return x;
    }

    function nMulTo(x, y, r) {
        x.multiplyTo(y, r);
    }

    function nSqrTo(x, r) {
        x.squareTo(r);
    }

    NullExp.prototype.convert = nNop;
    NullExp.prototype.revert = nNop;
    NullExp.prototype.mulTo = nMulTo;
    NullExp.prototype.sqrTo = nSqrTo;

    // (public) this^e

    function bnPow(e) {
        return this.exp(e, new NullExp());
    }

    // (protected) r = lower n words of "this * a", a.t <= n
    // "this" should be the larger one if appropriate.

    function bnpMultiplyLowerTo(a, n, r) {
        var i = Math.min(this.t + a.t, n);
        r.s = 0; // assumes a,this >= 0
        r.t = i;
        while (i > 0) r[--i] = 0;
        var j;
        for (j = r.t - this.t; i < j; ++i) r[i + this.t] = this.am(0, a[i], r, i, 0, this.t);
        for (j = Math.min(a.t, n); i < j; ++i) this.am(0, a[i], r, i, 0, n - i);
        r.clamp();
    }

    // (protected) r = "this * a" without lower n words, n > 0
    // "this" should be the larger one if appropriate.

    function bnpMultiplyUpperTo(a, n, r) {
        --n;
        var i = r.t = this.t + a.t - n;
        r.s = 0; // assumes a,this >= 0
        while (--i >= 0) r[i] = 0;
        for (i = Math.max(n - this.t, 0); i < a.t; ++i)
        r[this.t + i - n] = this.am(n - i, a[i], r, 0, 0, this.t + i - n);
        r.clamp();
        r.drShiftTo(1, r);
    }

    // Barrett modular reduction

    function Barrett(m) {
        // setup Barrett
        this.r2 = nbi();
        this.q3 = nbi();
        BigInteger.ONE.dlShiftTo(2 * m.t, this.r2);
        this.mu = this.r2.divide(m);
        this.m = m;
    }

    function barrettConvert(x) {
        if (x.s < 0 || x.t > 2 * this.m.t) return x.mod(this.m);
        else if (x.compareTo(this.m) < 0) return x;
        else {
            var r = nbi();
            x.copyTo(r);
            this.reduce(r);
            return r;
        }
    }

    function barrettRevert(x) {
        return x;
    }

    // x = x mod m (HAC 14.42)

    function barrettReduce(x) {
        x.drShiftTo(this.m.t - 1, this.r2);
        if (x.t > this.m.t + 1) {
            x.t = this.m.t + 1;
            x.clamp();
        }
        this.mu.multiplyUpperTo(this.r2, this.m.t + 1, this.q3);
        this.m.multiplyLowerTo(this.q3, this.m.t + 1, this.r2);
        while (x.compareTo(this.r2) < 0) x.dAddOffset(1, this.m.t + 1);
        x.subTo(this.r2, x);
        while (x.compareTo(this.m) >= 0) x.subTo(this.m, x);
    }

    // r = x^2 mod m; x != r

    function barrettSqrTo(x, r) {
        x.squareTo(r);
        this.reduce(r);
    }

    // r = x*y mod m; x,y != r

    function barrettMulTo(x, y, r) {
        x.multiplyTo(y, r);
        this.reduce(r);
    }

    Barrett.prototype.convert = barrettConvert;
    Barrett.prototype.revert = barrettRevert;
    Barrett.prototype.reduce = barrettReduce;
    Barrett.prototype.mulTo = barrettMulTo;
    Barrett.prototype.sqrTo = barrettSqrTo;

    // (public) this^e % m (HAC 14.85)

    function bnModPow(e, m) {
        var i = e.bitLength(),
            k, r = nbv(1),
            z;
        if (i <= 0) return r;
        else if (i < 18) k = 1;
        else if (i < 48) k = 3;
        else if (i < 144) k = 4;
        else if (i < 768) k = 5;
        else k = 6;
        if (i < 8) z = new Classic(m);
        else if (m.isEven()) z = new Barrett(m);
        else z = new Montgomery(m);

        // precomputation
        var g = new Array(),
            n = 3,
            k1 = k - 1,
            km = (1 << k) - 1;
        g[1] = z.convert(this);
        if (k > 1) {
            var g2 = nbi();
            z.sqrTo(g[1], g2);
            while (n <= km) {
                g[n] = nbi();
                z.mulTo(g2, g[n - 2], g[n]);
                n += 2;
            }
        }

        var j = e.t - 1,
            w, is1 = true,
            r2 = nbi(),
            t;
        i = nbits(e[j]) - 1;
        while (j >= 0) {
            if (i >= k1) w = (e[j] >> (i - k1)) & km;
            else {
                w = (e[j] & ((1 << (i + 1)) - 1)) << (k1 - i);
                if (j > 0) w |= e[j - 1] >> (this.DB + i - k1);
            }

            n = k;
            while ((w & 1) == 0) {
                w >>= 1;
                --n;
            }
            if ((i -= n) < 0) {
                i += this.DB;
                --j;
            }
            if (is1) { // ret == 1, don't bother squaring or multiplying it
                g[w].copyTo(r);
                is1 = false;
            }
            else {
                while (n > 1) {
                    z.sqrTo(r, r2);
                    z.sqrTo(r2, r);
                    n -= 2;
                }
                if (n > 0) z.sqrTo(r, r2);
                else {
                    t = r;
                    r = r2;
                    r2 = t;
                }
                z.mulTo(r2, g[w], r);
            }

            while (j >= 0 && (e[j] & (1 << i)) == 0) {
                z.sqrTo(r, r2);
                t = r;
                r = r2;
                r2 = t;
                if (--i < 0) {
                    i = this.DB - 1;
                    --j;
                }
            }
        }
        return z.revert(r);
    }

    // (public) gcd(this,a) (HAC 14.54)

    function bnGCD(a) {
        var x = (this.s < 0) ? this.negate() : this.clone();
        var y = (a.s < 0) ? a.negate() : a.clone();
        if (x.compareTo(y) < 0) {
            var t = x;
            x = y;
            y = t;
        }
        var i = x.getLowestSetBit(),
            g = y.getLowestSetBit();
        if (g < 0) return x;
        if (i < g) g = i;
        if (g > 0) {
            x.rShiftTo(g, x);
            y.rShiftTo(g, y);
        }
        while (x.signum() > 0) {
            if ((i = x.getLowestSetBit()) > 0) x.rShiftTo(i, x);
            if ((i = y.getLowestSetBit()) > 0) y.rShiftTo(i, y);
            if (x.compareTo(y) >= 0) {
                x.subTo(y, x);
                x.rShiftTo(1, x);
            }
            else {
                y.subTo(x, y);
                y.rShiftTo(1, y);
            }
        }
        if (g > 0) y.lShiftTo(g, y);
        return y;
    }

    // (protected) this % n, n < 2^26

    function bnpModInt(n) {
        if (n <= 0) return 0;
        var d = this.DV % n,
            r = (this.s < 0) ? n - 1 : 0;
        if (this.t > 0) if (d == 0) r = this[0] % n;
        else for (var i = this.t - 1; i >= 0; --i) r = (d * r + this[i]) % n;
        return r;
    }

    // (public) 1/this % m (HAC 14.61)

    function bnModInverse(m) {
        var ac = m.isEven();
        if ((this.isEven() && ac) || m.signum() == 0) return BigInteger.ZERO;
        var u = m.clone(),
            v = this.clone();
        var a = nbv(1),
            b = nbv(0),
            c = nbv(0),
            d = nbv(1);
        while (u.signum() != 0) {
            while (u.isEven()) {
                u.rShiftTo(1, u);
                if (ac) {
                    if (!a.isEven() || !b.isEven()) {
                        a.addTo(this, a);
                        b.subTo(m, b);
                    }
                    a.rShiftTo(1, a);
                }
                else if (!b.isEven()) b.subTo(m, b);
                b.rShiftTo(1, b);
            }
            while (v.isEven()) {
                v.rShiftTo(1, v);
                if (ac) {
                    if (!c.isEven() || !d.isEven()) {
                        c.addTo(this, c);
                        d.subTo(m, d);
                    }
                    c.rShiftTo(1, c);
                }
                else if (!d.isEven()) d.subTo(m, d);
                d.rShiftTo(1, d);
            }
            if (u.compareTo(v) >= 0) {
                u.subTo(v, u);
                if (ac) a.subTo(c, a);
                b.subTo(d, b);
            }
            else {
                v.subTo(u, v);
                if (ac) c.subTo(a, c);
                d.subTo(b, d);
            }
        }
        if (v.compareTo(BigInteger.ONE) != 0) return BigInteger.ZERO;
        if (d.compareTo(m) >= 0) return d.subtract(m);
        if (d.signum() < 0) d.addTo(m, d);
        else return d;
        if (d.signum() < 0) return d.add(m);
        else return d;
    }

    var lowprimes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599, 601, 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 661, 673, 677, 683, 691, 701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797, 809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887, 907, 911, 919, 929, 937, 941, 947, 953, 967, 971, 977, 983, 991, 997];
    var lplim = (1 << 26) / lowprimes[lowprimes.length - 1];

    // (public) test primality with certainty >= 1-.5^t

    function bnIsProbablePrime(t) {
        var i, x = this.abs();
        if (x.t == 1 && x[0] <= lowprimes[lowprimes.length - 1]) {
            for (i = 0; i < lowprimes.length; ++i)
            if (x[0] == lowprimes[i]) return true;
            return false;
        }
        if (x.isEven()) return false;
        i = 1;
        while (i < lowprimes.length) {
            var m = lowprimes[i],
                j = i + 1;
            while (j < lowprimes.length && m < lplim) m *= lowprimes[j++];
            m = x.modInt(m);
            while (i < j) if (m % lowprimes[i++] == 0) return false;
        }
        return x.millerRabin(t);
    }

    // (protected) true if probably prime (HAC 4.24, Miller-Rabin)

    function bnpMillerRabin(t) {
        var n1 = this.subtract(BigInteger.ONE);
        var k = n1.getLowestSetBit();
        if (k <= 0) return false;
        var r = n1.shiftRight(k);
        t = (t + 1) >> 1;
        if (t > lowprimes.length) t = lowprimes.length;
        var a = nbi();
        for (var i = 0; i < t; ++i) {
            //Pick bases at random, instead of starting at 2
            a.fromInt(lowprimes[Math.floor(Math.random() * lowprimes.length)]);
            var y = a.modPow(r, this);
            if (y.compareTo(BigInteger.ONE) != 0 && y.compareTo(n1) != 0) {
                var j = 1;
                while (j++ < k && y.compareTo(n1) != 0) {
                    y = y.modPowInt(2, this);
                    if (y.compareTo(BigInteger.ONE) == 0) return false;
                }
                if (y.compareTo(n1) != 0) return false;
            }
        }
        return true;
    }

    // protected
    BigInteger.prototype.chunkSize = bnpChunkSize;
    BigInteger.prototype.toRadix = bnpToRadix;
    BigInteger.prototype.fromRadix = bnpFromRadix;
    BigInteger.prototype.fromNumber = bnpFromNumber;
    BigInteger.prototype.bitwiseTo = bnpBitwiseTo;
    BigInteger.prototype.changeBit = bnpChangeBit;
    BigInteger.prototype.addTo = bnpAddTo;
    BigInteger.prototype.dMultiply = bnpDMultiply;
    BigInteger.prototype.dAddOffset = bnpDAddOffset;
    BigInteger.prototype.multiplyLowerTo = bnpMultiplyLowerTo;
    BigInteger.prototype.multiplyUpperTo = bnpMultiplyUpperTo;
    BigInteger.prototype.modInt = bnpModInt;
    BigInteger.prototype.millerRabin = bnpMillerRabin;

    // public
    BigInteger.prototype.clone = bnClone;
    BigInteger.prototype.intValue = bnIntValue;
    BigInteger.prototype.byteValue = bnByteValue;
    BigInteger.prototype.shortValue = bnShortValue;
    BigInteger.prototype.signum = bnSigNum;
    BigInteger.prototype.toByteArray = bnToByteArray;
    BigInteger.prototype.equals = bnEquals;
    BigInteger.prototype.min = bnMin;
    BigInteger.prototype.max = bnMax;
    BigInteger.prototype.and = bnAnd;
    BigInteger.prototype.or = bnOr;
    BigInteger.prototype.xor = bnXor;
    BigInteger.prototype.andNot = bnAndNot;
    BigInteger.prototype.not = bnNot;
    BigInteger.prototype.shiftLeft = bnShiftLeft;
    BigInteger.prototype.shiftRight = bnShiftRight;
    BigInteger.prototype.getLowestSetBit = bnGetLowestSetBit;
    BigInteger.prototype.bitCount = bnBitCount;
    BigInteger.prototype.testBit = bnTestBit;
    BigInteger.prototype.setBit = bnSetBit;
    BigInteger.prototype.clearBit = bnClearBit;
    BigInteger.prototype.flipBit = bnFlipBit;
    BigInteger.prototype.add = bnAdd;
    BigInteger.prototype.subtract = bnSubtract;
    BigInteger.prototype.multiply = bnMultiply;
    BigInteger.prototype.divide = bnDivide;
    BigInteger.prototype.remainder = bnRemainder;
    BigInteger.prototype.divideAndRemainder = bnDivideAndRemainder;
    BigInteger.prototype.modPow = bnModPow;
    BigInteger.prototype.modInverse = bnModInverse;
    BigInteger.prototype.pow = bnPow;
    BigInteger.prototype.gcd = bnGCD;
    BigInteger.prototype.isProbablePrime = bnIsProbablePrime;

    // JSBN-specific extension
    BigInteger.prototype.square = bnSquare;


    /**
     * All code is in an anonymous closure to keep the global namespace clean.
     *
     * @param {number=} overflow
     * @param {number=} startdenom
     */
    (function (pool, math, width, chunks, significance, overflow, startdenom)
    {


        //
        // seedrandom()
        // This is the seedrandom function described above.
        //
        math['seedrandom'] = function seedrandom(seed, use_entropy)
        {
            var key = [];
            var arc4;

            // Flatten the seed string or build one from local entropy if needed.
            seed = mixkey(flatten(
            use_entropy ? [seed, pool] : arguments.length ? seed : [new Date().getTime(), pool, window], 3), key);

            // Use the seed to initialize an ARC4 generator.
            arc4 = new ARC4(key);

            // Mix the randomness into accumulated entropy.
            mixkey(arc4.S, pool);

            // Override Math.random
            // This function returns a random double in [0, 1) that contains
            // randomness in every bit of the mantissa of the IEEE 754 value.
            math['random'] = function random()
            { // Closure to return a random double:
                var n = arc4.g(chunks); // Start with a numerator n < 2 ^ 48
                var d = startdenom; //   and denominator d = 2 ^ 48.
                var x = 0; //   and no 'extra last byte'.
                while (n < significance)
                { // Fill up all significant digits by
                    n = (n + x) * width; //   shifting numerator and
                    d *= width; //   denominator and generating a
                    x = arc4.g(1); //   new least-significant-byte.
                }
                while (n >= overflow)
                { // To avoid rounding up, before adding
                    n /= 2; //   last byte, shift everything
                    d /= 2; //   right using integer math until
                    x >>>= 1; //   we have exactly the desired bits.
                }
                return (n + x) / d; // Form the number within [0, 1).
            };

            // Return the seed that was used
            return seed;
        };

        //
        // ARC4
        //
        // An ARC4 implementation.  The constructor takes a key in the form of
        // an array of at most (width) integers that should be 0 <= x < (width).
        //
        // The g(count) method returns a pseudorandom integer that concatenates
        // the next (count) outputs from ARC4.  Its return value is a number x
        // that is in the range 0 <= x < (width ^ count).
        //
        /** @constructor */

        function ARC4(key)
        {
            var t, u, me = this,
                keylen = key.length;
            var i = 0,
                j = me.i = me.j = me.m = 0;
            me.S = [];
            me.c = [];

            // The empty key [] is treated as [0].
            if (!keylen)
            {
                key = [keylen++];
            }

            // Set up S using the standard key scheduling algorithm.
            while (i < width)
            {
                me.S[i] = i++;
            }
            for (i = 0; i < width; i++)
            {
                t = me.S[i];
                j = lowbits(j + t + key[i % keylen]);
                u = me.S[j];
                me.S[i] = u;
                me.S[j] = t;
            }

            // The "g" method returns the next (count) outputs as one number.
            me.g = function getnext(count)
            {
                var s = me.S;
                var i = lowbits(me.i + 1);
                var t = s[i];
                var j = lowbits(me.j + t);
                var u = s[j];
                s[i] = u;
                s[j] = t;
                var r = s[lowbits(t + u)];
                while (--count)
                {
                    i = lowbits(i + 1);
                    t = s[i];
                    j = lowbits(j + t);
                    u = s[j];
                    s[i] = u;
                    s[j] = t;
                    r = r * width + s[lowbits(t + u)];
                }
                me.i = i;
                me.j = j;
                return r;
            };
            // For robust unpredictability discard an initial batch of values.
            // See http://www.rsa.com/rsalabs/node.asp?id=2009
            me.g(width);
        }

        //
        // flatten()
        // Converts an object tree to nested arrays of strings.
        //
        /** @param {Object=} result
         * @param {string=} prop
         * @param {string=} typ */

        function flatten(obj, depth, result, prop, typ)
        {
            result = [];
            typ = typeof (obj);
            if (depth && typ == 'object')
            {
                for (prop in obj)
                {
                    if (prop.indexOf('S') < 5)
                    { // Avoid FF3 bug (local/sessionStorage)
                        try
                        {
                            result.push(flatten(obj[prop], depth - 1));
                        }
                        catch (e)
                        {}
                    }
                }
            }
            return (result.length ? result : obj + (typ != 'string' ? '\0' : ''));
        }

        //
        // mixkey()
        // Mixes a string seed into a key that is an array of integers, and
        // returns a shortened string seed that is equivalent to the result key.
        //
        /** @param {number=} smear
         * @param {number=} j */

        function mixkey(seed, key, smear, j)
        {
            seed += ''; // Ensure the seed is a string
            smear = 0;
            for (j = 0; j < seed.length; j++)
            {
                key[lowbits(j)] = lowbits((smear ^= key[lowbits(j)] * 19) + seed.charCodeAt(j));
            }
            seed = '';
            for (j in key)
            {
                seed += String.fromCharCode(key[j]);
            }
            return seed;
        }

        //
        // lowbits()
        // A quick "n mod width" for width a power of 2.
        //


        function lowbits(n)
        {
            return n & (width - 1);
        }

        //
        // The following constants are related to IEEE 754 limits.
        //
        startdenom = math.pow(width, chunks);
        significance = math.pow(2, significance);
        overflow = significance * 2;

        //
        // When seedrandom.js is loaded, we immediately mix a few bits
        // from the built-in RNG into the entropy pool.  Because we do
        // not want to intefere with determinstic PRNG state later,
        // seedrandom will not call math.random on its own again after
        // initialization.
        //
        mixkey(math.random(), pool);

        // End anonymous scope, and pass initial values.
    })([], // pool: entropy pool starts empty
    Math, // math: package containing random, pow, and seedrandom
    256, // width: each RC4 output is 0 <= x < 256
    6, // chunks: at least six RC4 outputs for each double
    52 // significance: there are 52 significant digits in a double
    );


    // This is not really a random number generator object, and two SeededRandom
    // objects will conflict with one another, but it's good enough for generating
    // the rsa key.
    function SeededRandom(){}

    function SRnextBytes(ba)
    {
        var i;
        for(i = 0; i < ba.length; i++)
        {
            ba[i] = Math.floor(Math.random() * 256);
        }
    }

    SeededRandom.prototype.nextBytes = SRnextBytes;

    // prng4.js - uses Arcfour as a PRNG

    function Arcfour() {
      this.i = 0;
      this.j = 0;
      this.S = new Array();
    }

    // Initialize arcfour context from key, an array of ints, each from [0..255]
    function ARC4init(key) {
      var i, j, t;
      for(i = 0; i < 256; ++i)
        this.S[i] = i;
      j = 0;
      for(i = 0; i < 256; ++i) {
        j = (j + this.S[i] + key[i % key.length]) & 255;
        t = this.S[i];
        this.S[i] = this.S[j];
        this.S[j] = t;
      }
      this.i = 0;
      this.j = 0;
    }

    function ARC4next() {
      var t;
      this.i = (this.i + 1) & 255;
      this.j = (this.j + this.S[this.i]) & 255;
      t = this.S[this.i];
      this.S[this.i] = this.S[this.j];
      this.S[this.j] = t;
      return this.S[(t + this.S[this.i]) & 255];
    }

    Arcfour.prototype.init = ARC4init;
    Arcfour.prototype.next = ARC4next;

    // Plug in your RNG constructor here
    function prng_newstate() {
      return new Arcfour();
    }

    // Pool size must be a multiple of 4 and greater than 32.
    // An array of bytes the size of the pool will be passed to init()
    var rng_psize = 256;

    // Random number generator - requires a PRNG backend, e.g. prng4.js

    // For best results, put code like
    // <body onClick='rng_seed_time();' onKeyPress='rng_seed_time();'>
    // in your main HTML document.

    var rng_state;
    var rng_pool;
    var rng_pptr;

    // Mix in a 32-bit integer into the pool
    function rng_seed_int(x) {
      rng_pool[rng_pptr++] ^= x & 255;
      rng_pool[rng_pptr++] ^= (x >> 8) & 255;
      rng_pool[rng_pptr++] ^= (x >> 16) & 255;
      rng_pool[rng_pptr++] ^= (x >> 24) & 255;
      if(rng_pptr >= rng_psize) rng_pptr -= rng_psize;
    }

    // Mix in the current time (w/milliseconds) into the pool
    function rng_seed_time() {
      rng_seed_int(new Date().getTime());
    }

    // Initialize the pool with junk if needed.
    if(rng_pool == null) {
      rng_pool = new Array();
      rng_pptr = 0;
      var t;
      if(navigator.appName == "Netscape" && navigator.appVersion < "5" && window.crypto) {
        // Extract entropy (256 bits) from NS4 RNG if available
        var z = window.crypto.random(32);
        for(t = 0; t < z.length; ++t)
          rng_pool[rng_pptr++] = z.charCodeAt(t) & 255;
      }
      while(rng_pptr < rng_psize) {  // extract some randomness from Math.random()
        t = Math.floor(65536 * Math.random());
        rng_pool[rng_pptr++] = t >>> 8;
        rng_pool[rng_pptr++] = t & 255;
      }
      rng_pptr = 0;
      rng_seed_time();
      //rng_seed_int(window.screenX);
      //rng_seed_int(window.screenY);
    }

    function rng_get_byte() {
      if(rng_state == null) {
        rng_seed_time();
        rng_state = prng_newstate();
        rng_state.init(rng_pool);
        for(rng_pptr = 0; rng_pptr < rng_pool.length; ++rng_pptr)
          rng_pool[rng_pptr] = 0;
        rng_pptr = 0;
        //rng_pool = null;
      }
      // TODO: allow reseeding after first request
      return rng_state.next();
    }

    function rng_get_bytes(ba) {
      var i;
      for(i = 0; i < ba.length; ++i) ba[i] = rng_get_byte();
    }

    function SecureRandom() {}

    SecureRandom.prototype.nextBytes = rng_get_bytes;



    /**
    *
    *  Secure Hash Algorithm (SHA256)
    *  http://www.webtoolkit.info/
    *
    *  Original code by Angel Marin, Paul Johnston.
    *
    **/

    function SHA256(s){

    	var chrsz   = 8;
    	var hexcase = 0;

    	function safe_add (x, y) {
    		var lsw = (x & 0xFFFF) + (y & 0xFFFF);
    		var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
    		return (msw << 16) | (lsw & 0xFFFF);
    	}

    	function S (X, n) { return ( X >>> n ) | (X << (32 - n)); }
    	function R (X, n) { return ( X >>> n ); }
    	function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }
    	function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }
    	function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }
    	function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }
    	function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }
    	function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }

    	function core_sha256 (m, l) {
    		var K = new Array(0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5, 0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5, 0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3, 0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174, 0xE49B69C1, 0xEFBE4786, 0xFC19DC6, 0x240CA1CC, 0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA, 0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7, 0xC6E00BF3, 0xD5A79147, 0x6CA6351, 0x14292967, 0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13, 0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85, 0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3, 0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070, 0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5, 0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3, 0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208, 0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2);
    		var HASH = new Array(0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19);
    		var W = new Array(64);
    		var a, b, c, d, e, f, g, h, i, j;
    		var T1, T2;

    		m[l >> 5] |= 0x80 << (24 - l % 32);
    		m[((l + 64 >> 9) << 4) + 15] = l;

    		for ( var i = 0; i<m.length; i+=16 ) {
    			a = HASH[0];
    			b = HASH[1];
    			c = HASH[2];
    			d = HASH[3];
    			e = HASH[4];
    			f = HASH[5];
    			g = HASH[6];
    			h = HASH[7];

    			for ( var j = 0; j<64; j++) {
    				if (j < 16) W[j] = m[j + i];
    				else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);

    				T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);
    				T2 = safe_add(Sigma0256(a), Maj(a, b, c));

    				h = g;
    				g = f;
    				f = e;
    				e = safe_add(d, T1);
    				d = c;
    				c = b;
    				b = a;
    				a = safe_add(T1, T2);
    			}

    			HASH[0] = safe_add(a, HASH[0]);
    			HASH[1] = safe_add(b, HASH[1]);
    			HASH[2] = safe_add(c, HASH[2]);
    			HASH[3] = safe_add(d, HASH[3]);
    			HASH[4] = safe_add(e, HASH[4]);
    			HASH[5] = safe_add(f, HASH[5]);
    			HASH[6] = safe_add(g, HASH[6]);
    			HASH[7] = safe_add(h, HASH[7]);
    		}
    		return HASH;
    	}

    	function str2binb (str) {
    		var bin = Array();
    		var mask = (1 << chrsz) - 1;
    		for(var i = 0; i < str.length * chrsz; i += chrsz) {
    			bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i%32);
    		}
    		return bin;
    	}

    	function Utf8Encode(string) {
    		string = string.replace(/\r\n/g,"\n");
    		var utftext = "";

    		for (var n = 0; n < string.length; n++) {

    			var c = string.charCodeAt(n);

    			if (c < 128) {
    				utftext += String.fromCharCode(c);
    			}
    			else if((c > 127) && (c < 2048)) {
    				utftext += String.fromCharCode((c >> 6) | 192);
    				utftext += String.fromCharCode((c & 63) | 128);
    			}
    			else {
    				utftext += String.fromCharCode((c >> 12) | 224);
    				utftext += String.fromCharCode(((c >> 6) & 63) | 128);
    				utftext += String.fromCharCode((c & 63) | 128);
    			}

    		}

    		return utftext;
    	}

    	function binb2hex (binarray) {
    		var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
    		var str = "";
    		for(var i = 0; i < binarray.length * 4; i++) {
    			str += hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8+4)) & 0xF) +
    			hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8  )) & 0xF);
    		}
    		return str;
    	}

    	s = Utf8Encode(s);
    	return binb2hex(core_sha256(str2binb(s), s.length * chrsz));
    }

    var sha256 = {}
    sha256.hex = function(s)
    {
        return SHA256(s);
    }

    /**
    *
    *  Secure Hash Algorithm (SHA1)
    *  http://www.webtoolkit.info/
    *
    **/

    function SHA1 (msg) {

    	function rotate_left(n,s) {
    		var t4 = ( n<<s ) | (n>>>(32-s));
    		return t4;
    	};

    	function lsb_hex(val) {
    		var str="";
    		var i;
    		var vh;
    		var vl;

    		for( i=0; i<=6; i+=2 ) {
    			vh = (val>>>(i*4+4))&0x0f;
    			vl = (val>>>(i*4))&0x0f;
    			str += vh.toString(16) + vl.toString(16);
    		}
    		return str;
    	};

    	function cvt_hex(val) {
    		var str="";
    		var i;
    		var v;

    		for( i=7; i>=0; i-- ) {
    			v = (val>>>(i*4))&0x0f;
    			str += v.toString(16);
    		}
    		return str;
    	};


    	function Utf8Encode(string) {
    		string = string.replace(/\r\n/g,"\n");
    		var utftext = "";

    		for (var n = 0; n < string.length; n++) {

    			var c = string.charCodeAt(n);

    			if (c < 128) {
    				utftext += String.fromCharCode(c);
    			}
    			else if((c > 127) && (c < 2048)) {
    				utftext += String.fromCharCode((c >> 6) | 192);
    				utftext += String.fromCharCode((c & 63) | 128);
    			}
    			else {
    				utftext += String.fromCharCode((c >> 12) | 224);
    				utftext += String.fromCharCode(((c >> 6) & 63) | 128);
    				utftext += String.fromCharCode((c & 63) | 128);
    			}

    		}

    		return utftext;
    	};

    	var blockstart;
    	var i, j;
    	var W = new Array(80);
    	var H0 = 0x67452301;
    	var H1 = 0xEFCDAB89;
    	var H2 = 0x98BADCFE;
    	var H3 = 0x10325476;
    	var H4 = 0xC3D2E1F0;
    	var A, B, C, D, E;
    	var temp;

    	msg = Utf8Encode(msg);

    	var msg_len = msg.length;

    	var word_array = new Array();
    	for( i=0; i<msg_len-3; i+=4 ) {
    		j = msg.charCodeAt(i)<<24 | msg.charCodeAt(i+1)<<16 |
    		msg.charCodeAt(i+2)<<8 | msg.charCodeAt(i+3);
    		word_array.push( j );
    	}

    	switch( msg_len % 4 ) {
    		case 0:
    			i = 0x080000000;
    		break;
    		case 1:
    			i = msg.charCodeAt(msg_len-1)<<24 | 0x0800000;
    		break;

    		case 2:
    			i = msg.charCodeAt(msg_len-2)<<24 | msg.charCodeAt(msg_len-1)<<16 | 0x08000;
    		break;

    		case 3:
    			i = msg.charCodeAt(msg_len-3)<<24 | msg.charCodeAt(msg_len-2)<<16 | msg.charCodeAt(msg_len-1)<<8	| 0x80;
    		break;
    	}

    	word_array.push( i );

    	while( (word_array.length % 16) != 14 ) word_array.push( 0 );

    	word_array.push( msg_len>>>29 );
    	word_array.push( (msg_len<<3)&0x0ffffffff );


    	for ( blockstart=0; blockstart<word_array.length; blockstart+=16 ) {

    		for( i=0; i<16; i++ ) W[i] = word_array[blockstart+i];
    		for( i=16; i<=79; i++ ) W[i] = rotate_left(W[i-3] ^ W[i-8] ^ W[i-14] ^ W[i-16], 1);

    		A = H0;
    		B = H1;
    		C = H2;
    		D = H3;
    		E = H4;

    		for( i= 0; i<=19; i++ ) {
    			temp = (rotate_left(A,5) + ((B&C) | (~B&D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;
    			E = D;
    			D = C;
    			C = rotate_left(B,30);
    			B = A;
    			A = temp;
    		}

    		for( i=20; i<=39; i++ ) {
    			temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;
    			E = D;
    			D = C;
    			C = rotate_left(B,30);
    			B = A;
    			A = temp;
    		}

    		for( i=40; i<=59; i++ ) {
    			temp = (rotate_left(A,5) + ((B&C) | (B&D) | (C&D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;
    			E = D;
    			D = C;
    			C = rotate_left(B,30);
    			B = A;
    			A = temp;
    		}

    		for( i=60; i<=79; i++ ) {
    			temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;
    			E = D;
    			D = C;
    			C = rotate_left(B,30);
    			B = A;
    			A = temp;
    		}

    		H0 = (H0 + A) & 0x0ffffffff;
    		H1 = (H1 + B) & 0x0ffffffff;
    		H2 = (H2 + C) & 0x0ffffffff;
    		H3 = (H3 + D) & 0x0ffffffff;
    		H4 = (H4 + E) & 0x0ffffffff;

    	}

    	var temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);

    	return temp.toLowerCase();

    }

    var sha1 = {}
    sha1.hex = function(s)
    {
        return SHA1(s);
    }

    /**
    *
    *  MD5 (Message-Digest Algorithm)
    *  http://www.webtoolkit.info/
    *
    **/

    var MD5 = function (string) {

    	function RotateLeft(lValue, iShiftBits) {
    		return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));
    	}

    	function AddUnsigned(lX,lY) {
    		var lX4,lY4,lX8,lY8,lResult;
    		lX8 = (lX & 0x80000000);
    		lY8 = (lY & 0x80000000);
    		lX4 = (lX & 0x40000000);
    		lY4 = (lY & 0x40000000);
    		lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);
    		if (lX4 & lY4) {
    			return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
    		}
    		if (lX4 | lY4) {
    			if (lResult & 0x40000000) {
    				return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
    			} else {
    				return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
    			}
    		} else {
    			return (lResult ^ lX8 ^ lY8);
    		}
     	}

     	function F(x,y,z) { return (x & y) | ((~x) & z); }
     	function G(x,y,z) { return (x & z) | (y & (~z)); }
     	function H(x,y,z) { return (x ^ y ^ z); }
    	function I(x,y,z) { return (y ^ (x | (~z))); }

    	function FF(a,b,c,d,x,s,ac) {
    		a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
    		return AddUnsigned(RotateLeft(a, s), b);
    	};

    	function GG(a,b,c,d,x,s,ac) {
    		a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
    		return AddUnsigned(RotateLeft(a, s), b);
    	};

    	function HH(a,b,c,d,x,s,ac) {
    		a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
    		return AddUnsigned(RotateLeft(a, s), b);
    	};

    	function II(a,b,c,d,x,s,ac) {
    		a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
    		return AddUnsigned(RotateLeft(a, s), b);
    	};

    	function ConvertToWordArray(string) {
    		var lWordCount;
    		var lMessageLength = string.length;
    		var lNumberOfWords_temp1=lMessageLength + 8;
    		var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;
    		var lNumberOfWords = (lNumberOfWords_temp2+1)*16;
    		var lWordArray=Array(lNumberOfWords-1);
    		var lBytePosition = 0;
    		var lByteCount = 0;
    		while ( lByteCount < lMessageLength ) {
    			lWordCount = (lByteCount-(lByteCount % 4))/4;
    			lBytePosition = (lByteCount % 4)*8;
    			lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount)<<lBytePosition));
    			lByteCount++;
    		}
    		lWordCount = (lByteCount-(lByteCount % 4))/4;
    		lBytePosition = (lByteCount % 4)*8;
    		lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80<<lBytePosition);
    		lWordArray[lNumberOfWords-2] = lMessageLength<<3;
    		lWordArray[lNumberOfWords-1] = lMessageLength>>>29;
    		return lWordArray;
    	};

    	function WordToHex(lValue) {
    		var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;
    		for (lCount = 0;lCount<=3;lCount++) {
    			lByte = (lValue>>>(lCount*8)) & 255;
    			WordToHexValue_temp = "0" + lByte.toString(16);
    			WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);
    		}
    		return WordToHexValue;
    	};

    	function Utf8Encode(string) {
    		string = string.replace(/\r\n/g,"\n");
    		var utftext = "";

    		for (var n = 0; n < string.length; n++) {

    			var c = string.charCodeAt(n);

    			if (c < 128) {
    				utftext += String.fromCharCode(c);
    			}
    			else if((c > 127) && (c < 2048)) {
    				utftext += String.fromCharCode((c >> 6) | 192);
    				utftext += String.fromCharCode((c & 63) | 128);
    			}
    			else {
    				utftext += String.fromCharCode((c >> 12) | 224);
    				utftext += String.fromCharCode(((c >> 6) & 63) | 128);
    				utftext += String.fromCharCode((c & 63) | 128);
    			}

    		}

    		return utftext;
    	};

    	var x=Array();
    	var k,AA,BB,CC,DD,a,b,c,d;
    	var S11=7, S12=12, S13=17, S14=22;
    	var S21=5, S22=9 , S23=14, S24=20;
    	var S31=4, S32=11, S33=16, S34=23;
    	var S41=6, S42=10, S43=15, S44=21;

    	string = Utf8Encode(string);

    	x = ConvertToWordArray(string);

    	a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;

    	for (k=0;k<x.length;k+=16) {
    		AA=a; BB=b; CC=c; DD=d;
    		a=FF(a,b,c,d,x[k+0], S11,0xD76AA478);
    		d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);
    		c=FF(c,d,a,b,x[k+2], S13,0x242070DB);
    		b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);
    		a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);
    		d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);
    		c=FF(c,d,a,b,x[k+6], S13,0xA8304613);
    		b=FF(b,c,d,a,x[k+7], S14,0xFD469501);
    		a=FF(a,b,c,d,x[k+8], S11,0x698098D8);
    		d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);
    		c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);
    		b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);
    		a=FF(a,b,c,d,x[k+12],S11,0x6B901122);
    		d=FF(d,a,b,c,x[k+13],S12,0xFD987193);
    		c=FF(c,d,a,b,x[k+14],S13,0xA679438E);
    		b=FF(b,c,d,a,x[k+15],S14,0x49B40821);
    		a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);
    		d=GG(d,a,b,c,x[k+6], S22,0xC040B340);
    		c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);
    		b=GG(b,c,d,a,x[k+0], S24,0xE9B6C7AA);
    		a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);
    		d=GG(d,a,b,c,x[k+10],S22,0x2441453);
    		c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);
    		b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);
    		a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);
    		d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);
    		c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);
    		b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);
    		a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);
    		d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);
    		c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);
    		b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);
    		a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);
    		d=HH(d,a,b,c,x[k+8], S32,0x8771F681);
    		c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);
    		b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);
    		a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);
    		d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);
    		c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);
    		b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);
    		a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);
    		d=HH(d,a,b,c,x[k+0], S32,0xEAA127FA);
    		c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);
    		b=HH(b,c,d,a,x[k+6], S34,0x4881D05);
    		a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);
    		d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);
    		c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);
    		b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);
    		a=II(a,b,c,d,x[k+0], S41,0xF4292244);
    		d=II(d,a,b,c,x[k+7], S42,0x432AFF97);
    		c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);
    		b=II(b,c,d,a,x[k+5], S44,0xFC93A039);
    		a=II(a,b,c,d,x[k+12],S41,0x655B59C3);
    		d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);
    		c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);
    		b=II(b,c,d,a,x[k+1], S44,0x85845DD1);
    		a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);
    		d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);
    		c=II(c,d,a,b,x[k+6], S43,0xA3014314);
    		b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);
    		a=II(a,b,c,d,x[k+4], S41,0xF7537E82);
    		d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);
    		c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);
    		b=II(b,c,d,a,x[k+9], S44,0xEB86D391);
    		a=AddUnsigned(a,AA);
    		b=AddUnsigned(b,BB);
    		c=AddUnsigned(c,CC);
    		d=AddUnsigned(d,DD);
    	}

    	var temp = WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);

    	return temp.toLowerCase();
    }

    // Depends on jsbn.js and rng.js
    // Version 1.1: support utf-8 encoding in pkcs1pad2
    // convert a (hex) string to a bignum object


    function parseBigInt(str, r)
    {
        return new BigInteger(str, r);
    }

    function linebrk(s, n)
    {
        var ret = "";
        var i = 0;
        while (i + n < s.length)
        {
            ret += s.substring(i, i + n) + "\n";
            i += n;
        }
        return ret + s.substring(i, s.length);
    }

    function byte2Hex(b)
    {
        if (b < 0x10) return "0" + b.toString(16);
        else return b.toString(16);
    }

    // PKCS#1 (type 2, random) pad input string s to n bytes, and return a bigint


    function pkcs1pad2(s, n)
    {
        if (n < s.length + 11)
        { // TODO: fix for utf-8
            //alert("Message too long for RSA (n=" + n + ", l=" + s.length + ")");
            //return null;
            throw "Message too long for RSA (n=" + n + ", l=" + s.length + ")";
        }
        var ba = new Array();
        var i = s.length - 1;
        while (i >= 0 && n > 0)
        {
            var c = s.charCodeAt(i--);
            if (c < 128)
            { // encode using utf-8
                ba[--n] = c;
            }
            else if ((c > 127) && (c < 2048))
            {
                ba[--n] = (c & 63) | 128;
                ba[--n] = (c >> 6) | 192;
            }
            else
            {
                ba[--n] = (c & 63) | 128;
                ba[--n] = ((c >> 6) & 63) | 128;
                ba[--n] = (c >> 12) | 224;
            }
        }
        ba[--n] = 0;
        var rng = new SecureRandom();
        var x = new Array();
        while (n > 2)
        { // random non-zero pad
            x[0] = 0;
            while (x[0] == 0) rng.nextBytes(x);
            ba[--n] = x[0];
        }
        ba[--n] = 2;
        ba[--n] = 0;
        return new BigInteger(ba);
    }

    // "empty" RSA key constructor


    function RSAKey()
    {
        this.n = null;
        this.e = 0;
        this.d = null;
        this.p = null;
        this.q = null;
        this.dmp1 = null;
        this.dmq1 = null;
        this.coeff = null;
    }
    // Set the public key fields N and e from hex strings


    function RSASetPublic(N, E)
    {
        if (N != null && E != null && N.length > 0 && E.length > 0)
        {
            this.n = parseBigInt(N, 16);
            this.e = parseInt(E, 16);
        }
        else alert("Invalid RSA public key");
    }

    // Perform raw public operation on "x": return x^e (mod n)


    function RSADoPublic(x)
    {
        return x.modPowInt(this.e, this.n);
    }

    // Return the PKCS#1 RSA encryption of "text" as an even-length hex string


    function RSAEncrypt(text)
    {
        var m = pkcs1pad2(text, (this.n.bitLength() + 7) >> 3);
        if (m == null) return null;
        var c = this.doPublic(m);
        if (c == null) return null;
        var h = c.toString(16);
        if ((h.length & 1) == 0) return h;
        else return "0" + h;
    }

    // Return the PKCS#1 RSA encryption of "text" as a Base64-encoded string
    //function RSAEncryptB64(text) {
    //  var h = this.encrypt(text);
    //  if(h) return hex2b64(h); else return null;
    //}
    // protected
    RSAKey.prototype.doPublic = RSADoPublic;

    // public
    RSAKey.prototype.setPublic = RSASetPublic;
    RSAKey.prototype.encrypt = RSAEncrypt;

    // Version 1.1: support utf-8 decoding in pkcs1unpad2
    // Undo PKCS#1 (type 2, random) padding and, if valid, return the plaintext

    function pkcs1unpad2(d, n)
    {
        var b = d.toByteArray();
        var i = 0;
        while (i < b.length && b[i] == 0)++i;
        if (b.length - i != n - 1 || b[i] != 2) return null;
        ++i;
        while (b[i] != 0)
        if (++i >= b.length) return null;
        var ret = "";
        while (++i < b.length)
        {
            var c = b[i] & 255;
            if (c < 128)
            { // utf-8 decode
                ret += String.fromCharCode(c);
            }
            else if ((c > 191) && (c < 224))
            {
                ret += String.fromCharCode(((c & 31) << 6) | (b[i + 1] & 63));
                ++i;
            }
            else
            {
                ret += String.fromCharCode(((c & 15) << 12) | ((b[i + 1] & 63) << 6) | (b[i + 2] & 63));
                i += 2;
            }
        }
        return ret;
    }

    // Set the private key fields N, e, and d from hex strings
    function RSASetPrivate(N, E, D)
    {
        if (N != null && E != null && N.length > 0 && E.length > 0)
        {
            this.n = parseBigInt(N, 16);
            this.e = parseInt(E, 16);
            this.d = parseBigInt(D, 16);
        }
        else alert("Invalid RSA private key");
    }

    // Set the private key fields N, e, d and CRT params from hex strings
    function RSASetPrivateEx(N, E, D, P, Q, DP, DQ, C)
    {
        if (N != null && E != null && N.length > 0 && E.length > 0)
        {
            this.n = parseBigInt(N, 16);
            this.e = parseInt(E, 16);
            this.d = parseBigInt(D, 16);
            this.p = parseBigInt(P, 16);
            this.q = parseBigInt(Q, 16);
            this.dmp1 = parseBigInt(DP, 16);
            this.dmq1 = parseBigInt(DQ, 16);
            this.coeff = parseBigInt(C, 16);
        }
        else alert("Invalid RSA private key");
    }

    // Generate a new random private key B bits long, using public expt E
    function RSAGenerate(B, E)
    {
        var rng = new SeededRandom();
        var qs = B >> 1;
        this.e = parseInt(E, 16);
        var ee = new BigInteger(E, 16);
        for (;;)
        {
            for (;;)
            {
                this.p = new BigInteger(B - qs, 1, rng);
                if (this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 && this.p.isProbablePrime(10)) break;
            }
            for (;;)
            {
                this.q = new BigInteger(qs, 1, rng);
                if (this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 && this.q.isProbablePrime(10)) break;
            }
            if (this.p.compareTo(this.q) <= 0)
            {
                var t = this.p;
                this.p = this.q;
                this.q = t;
            }
            var p1 = this.p.subtract(BigInteger.ONE);
            var q1 = this.q.subtract(BigInteger.ONE);
            var phi = p1.multiply(q1);
            if (phi.gcd(ee).compareTo(BigInteger.ONE) == 0)
            {
                this.n = this.p.multiply(this.q);
                this.d = ee.modInverse(phi);
                this.dmp1 = this.d.mod(p1);
                this.dmq1 = this.d.mod(q1);
                this.coeff = this.q.modInverse(this.p);
                break;
            }
        }
    }

    // Perform raw private operation on "x": return x^d (mod n)
    function RSADoPrivate(x)
    {
        if (this.p == null || this.q == null) return x.modPow(this.d, this.n);
        // TODO: re-calculate any missing CRT params
        var xp = x.mod(this.p).modPow(this.dmp1, this.p);
        var xq = x.mod(this.q).modPow(this.dmq1, this.q);
        while (xp.compareTo(xq) < 0)
        xp = xp.add(this.p);
        return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq);
    }

    // Return the PKCS#1 RSA decryption of "ctext".
    // "ctext" is an even-length hex string and the output is a plain string.
    function RSADecrypt(ctext)
    {
        var c = parseBigInt(ctext, 16);
        var m = this.doPrivate(c);
        if (m == null) return null;
        return pkcs1unpad2(m, (this.n.bitLength() + 7) >> 3);
    }

    // protected
    RSAKey.prototype.doPrivate = RSADoPrivate;

    // public
    RSAKey.prototype.setPrivate = RSASetPrivate;
    RSAKey.prototype.setPrivateEx = RSASetPrivateEx;
    RSAKey.prototype.generate = RSAGenerate;
    RSAKey.prototype.decrypt = RSADecrypt;


    //
    // rsa-sign.js - adding signing functions to RSAKey class.
    //
    //
    // version: 1.0 (2010-Jun-03)
    //
    // Copyright (c) 2010 Kenji Urushima (kenji.urushima@gmail.com)
    //
    // This software is licensed under the terms of the MIT License.
    // http://www.opensource.org/licenses/mit-license.php
    //
    // The above copyright and license notice shall be
    // included in all copies or substantial portions of the Software.
    //
    // Depends on:
    //   function sha1.hex(s) of sha1.js
    //   jsbn.js
    //   jsbn2.js
    //   rsa.js
    //   rsa2.js
    //
    // keysize / pmstrlen
    //  512 /  128
    // 1024 /  256
    // 2048 /  512
    // 4096 / 1024
    // As for _RSASGIN_DIHEAD values for each hash algorithm, see PKCS#1 v2.1 spec (p38).
    var _RSASIGN_DIHEAD = [];
    _RSASIGN_DIHEAD['sha1'] = "3021300906052b0e03021a05000414";
    _RSASIGN_DIHEAD['sha256'] = "3031300d060960864801650304020105000420";
    //_RSASIGN_DIHEAD['md2'] = "3020300c06082a864886f70d020205000410";
    //_RSASIGN_DIHEAD['md5'] = "3020300c06082a864886f70d020505000410";
    //_RSASIGN_DIHEAD['sha384'] = "3041300d060960864801650304020205000430";
    //_RSASIGN_DIHEAD['sha512'] = "3051300d060960864801650304020305000440";
    var _RSASIGN_HASHHEXFUNC = [];
    _RSASIGN_HASHHEXFUNC['sha1'] = sha1.hex;
    _RSASIGN_HASHHEXFUNC['sha256'] = sha256.hex;

    // ========================================================================
    // Signature Generation
    // ========================================================================

    function _rsasign_getHexPaddedDigestInfoForString(s, keySize, hashAlg)
    {
        var pmStrLen = keySize / 4;
        var hashFunc = _RSASIGN_HASHHEXFUNC[hashAlg];
        var sHashHex = hashFunc(s);

        var sHead = "0001";
        var sTail = "00" + _RSASIGN_DIHEAD[hashAlg] + sHashHex;
        var sMid = "";
        var fLen = pmStrLen - sHead.length - sTail.length;
        for (var i = 0; i < fLen; i += 2)
        {
            sMid += "ff";
        }
        sPaddedMessageHex = sHead + sMid + sTail;
        return sPaddedMessageHex;
    }

    function _rsasign_signString(s, hashAlg)
    {
        var hPM = _rsasign_getHexPaddedDigestInfoForString(s, this.n.bitLength(), hashAlg);
        var biPaddedMessage = parseBigInt(hPM, 16);
        var biSign = this.doPrivate(biPaddedMessage);
        var hexSign = biSign.toString(16);
        return hexSign;
    }

    function _rsasign_signStringWithSHA1(s)
    {
        var hPM = _rsasign_getHexPaddedDigestInfoForString(s, this.n.bitLength(), 'sha1');
        var biPaddedMessage = parseBigInt(hPM, 16);
        var biSign = this.doPrivate(biPaddedMessage);
        var hexSign = biSign.toString(16);
        return hexSign;
    }

    function _rsasign_signStringWithSHA256(s)
    {
        var hPM = _rsasign_getHexPaddedDigestInfoForString(s, this.n.bitLength(), 'sha256');
        var biPaddedMessage = parseBigInt(hPM, 16);
        var biSign = this.doPrivate(biPaddedMessage);
        var hexSign = biSign.toString(16);
        return hexSign;
    }

    // ========================================================================
    // Signature Verification
    // ========================================================================

    function _rsasign_getDecryptSignatureBI(biSig, hN, hE)
    {
        var rsa = new RSAKey();
        rsa.setPublic(hN, hE);
        var biDecryptedSig = rsa.doPublic(biSig);
        return biDecryptedSig;
    }

    function _rsasign_getHexDigestInfoFromSig(biSig, hN, hE)
    {
        var biDecryptedSig = _rsasign_getDecryptSignatureBI(biSig, hN, hE);
        var hDigestInfo = biDecryptedSig.toString(16).replace(/^1f+00/, '');
        return hDigestInfo;
    }

    function _rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo)
    {
        for (var algName in _RSASIGN_DIHEAD)
        {
            var head = _RSASIGN_DIHEAD[algName];
            var len = head.length;
            if (hDigestInfo.substring(0, len) == head)
            {
                var a = [algName, hDigestInfo.substring(len)];
                return a;
            }
        }
        return [];
    }

    function _rsasign_verifySignatureWithArgs(sMsg, biSig, hN, hE)
    {
        var hDigestInfo = _rsasign_getHexDigestInfoFromSig(biSig, hN, hE);
        var digestInfoAry = _rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo);
        if (digestInfoAry.length == 0) return false;
        var algName = digestInfoAry[0];
        var diHashValue = digestInfoAry[1];
        var ff = _RSASIGN_HASHHEXFUNC[algName];
        var msgHashValue = ff(sMsg);
        return (diHashValue == msgHashValue);
    }

    function _rsasign_verifyHexSignatureForMessage(hSig, sMsg)
    {
        var biSig = parseBigInt(hSig, 16);
        var result = _rsasign_verifySignatureWithArgs(sMsg, biSig, this.n.toString(16), this.e.toString(16));
        return result;
    }

    function _rsasign_verifyString(sMsg, hSig)
    {
        hSig = hSig.replace(/[ \n]+/g, "");
        var biSig = parseBigInt(hSig, 16);
        var biDecryptedSig = this.doPublic(biSig);
        var hDigestInfo = biDecryptedSig.toString(16).replace(/^1f+00/, '');
        var digestInfoAry = _rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo);

        if (digestInfoAry.length == 0) return false;
        var algName = digestInfoAry[0];
        var diHashValue = digestInfoAry[1];
        var ff = _RSASIGN_HASHHEXFUNC[algName];
        var msgHashValue = ff(sMsg);
        return (diHashValue == msgHashValue);
    }

    RSAKey.prototype.signString = _rsasign_signString;
    RSAKey.prototype.signStringWithSHA1 = _rsasign_signStringWithSHA1;
    RSAKey.prototype.signStringWithSHA256 = _rsasign_signStringWithSHA256;

    RSAKey.prototype.verifyString = _rsasign_verifyString;
    RSAKey.prototype.verifyHexSignatureForMessage = _rsasign_verifyHexSignatureForMessage;


    /*
     *  jsaes version 0.1  -  Copyright 2006 B. Poettering
     *
     *  This program is free software; you can redistribute it and/or
     *  modify it under the terms of the GNU General Public License as
     *  published by the Free Software Foundation; either version 2 of the
     *  License, or (at your option) any later version.
     *
     *  This program is distributed in the hope that it will be useful,
     *  but WITHOUT ANY WARRANTY; without even the implied warranty of
     *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
     *  General Public License for more details.
     *
     *  You should have received a copy of the GNU General Public License
     *  along with this program; if not, write to the Free Software
     *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
     *  02111-1307 USA
     */

     // later modifications by wwwtyro@github

    var aes = (function () {

        var my = {};

        my.Sbox = new Array(99, 124, 119, 123, 242, 107, 111, 197, 48, 1, 103, 43, 254, 215, 171, 118, 202, 130, 201, 125, 250, 89, 71, 240, 173, 212, 162, 175, 156, 164, 114, 192, 183, 253, 147, 38, 54, 63, 247, 204, 52, 165, 229, 241, 113, 216, 49, 21, 4, 199, 35, 195, 24, 150, 5, 154, 7, 18, 128, 226, 235, 39, 178, 117, 9, 131, 44, 26, 27, 110, 90, 160, 82, 59, 214, 179, 41, 227, 47, 132, 83, 209, 0, 237, 32, 252, 177, 91, 106, 203, 190, 57, 74, 76, 88, 207, 208, 239, 170, 251, 67, 77, 51, 133, 69, 249, 2, 127, 80, 60, 159, 168, 81, 163, 64, 143, 146, 157, 56, 245, 188, 182, 218, 33, 16, 255, 243, 210, 205, 12, 19, 236, 95, 151, 68, 23, 196, 167, 126, 61, 100, 93, 25, 115, 96, 129, 79, 220, 34, 42, 144, 136, 70, 238, 184, 20, 222, 94, 11, 219, 224, 50, 58, 10, 73, 6, 36, 92, 194, 211, 172, 98, 145, 149, 228, 121, 231, 200, 55, 109, 141, 213, 78, 169, 108, 86, 244, 234, 101, 122, 174, 8, 186, 120, 37, 46, 28, 166, 180, 198, 232, 221, 116, 31, 75, 189, 139, 138, 112, 62, 181, 102, 72, 3, 246, 14, 97, 53, 87, 185, 134, 193, 29, 158, 225, 248, 152, 17, 105, 217, 142, 148, 155, 30, 135, 233, 206, 85, 40, 223, 140, 161, 137, 13, 191, 230, 66, 104, 65, 153, 45, 15, 176, 84, 187, 22);

        my.ShiftRowTab = new Array(0, 5, 10, 15, 4, 9, 14, 3, 8, 13, 2, 7, 12, 1, 6, 11);

        my.Init = function () {
            my.Sbox_Inv = new Array(256);
            for (var i = 0; i < 256; i++)
            my.Sbox_Inv[my.Sbox[i]] = i;

            my.ShiftRowTab_Inv = new Array(16);
            for (var i = 0; i < 16; i++)
            my.ShiftRowTab_Inv[my.ShiftRowTab[i]] = i;

            my.xtime = new Array(256);
            for (var i = 0; i < 128; i++) {
                my.xtime[i] = i << 1;
                my.xtime[128 + i] = (i << 1) ^ 0x1b;
            }
        }

        my.Done = function () {
            delete my.Sbox_Inv;
            delete my.ShiftRowTab_Inv;
            delete my.xtime;
        }

        my.ExpandKey = function (key) {
            var kl = key.length,
                ks, Rcon = 1;
            switch (kl) {
            case 16:
                ks = 16 * (10 + 1);
                break;
            case 24:
                ks = 16 * (12 + 1);
                break;
            case 32:
                ks = 16 * (14 + 1);
                break;
            default:
                alert("my.ExpandKey: Only key lengths of 16, 24 or 32 bytes allowed!");
            }
            for (var i = kl; i < ks; i += 4) {
                var temp = key.slice(i - 4, i);
                if (i % kl == 0) {
                    temp = new Array(my.Sbox[temp[1]] ^ Rcon, my.Sbox[temp[2]], my.Sbox[temp[3]], my.Sbox[temp[0]]);
                    if ((Rcon <<= 1) >= 256) Rcon ^= 0x11b;
                }
                else if ((kl > 24) && (i % kl == 16)) temp = new Array(my.Sbox[temp[0]], my.Sbox[temp[1]], my.Sbox[temp[2]], my.Sbox[temp[3]]);
                for (var j = 0; j < 4; j++)
                key[i + j] = key[i + j - kl] ^ temp[j];
            }
        }

        my.Encrypt = function (block, key) {
            var l = key.length;
            my.AddRoundKey(block, key.slice(0, 16));
            for (var i = 16; i < l - 16; i += 16) {
                my.SubBytes(block, my.Sbox);
                my.ShiftRows(block, my.ShiftRowTab);
                my.MixColumns(block);
                my.AddRoundKey(block, key.slice(i, i + 16));
            }
            my.SubBytes(block, my.Sbox);
            my.ShiftRows(block, my.ShiftRowTab);
            my.AddRoundKey(block, key.slice(i, l));
        }

        my.Decrypt = function (block, key) {
            var l = key.length;
            my.AddRoundKey(block, key.slice(l - 16, l));
            my.ShiftRows(block, my.ShiftRowTab_Inv);
            my.SubBytes(block, my.Sbox_Inv);
            for (var i = l - 32; i >= 16; i -= 16) {
                my.AddRoundKey(block, key.slice(i, i + 16));
                my.MixColumns_Inv(block);
                my.ShiftRows(block, my.ShiftRowTab_Inv);
                my.SubBytes(block, my.Sbox_Inv);
            }
            my.AddRoundKey(block, key.slice(0, 16));
        }

        my.SubBytes = function (state, sbox) {
            for (var i = 0; i < 16; i++)
            state[i] = sbox[state[i]];
        }

        my.AddRoundKey = function (state, rkey) {
            for (var i = 0; i < 16; i++)
            state[i] ^= rkey[i];
        }

        my.ShiftRows = function (state, shifttab) {
            var h = new Array().concat(state);
            for (var i = 0; i < 16; i++)
            state[i] = h[shifttab[i]];
        }

        my.MixColumns = function (state) {
            for (var i = 0; i < 16; i += 4) {
                var s0 = state[i + 0],
                    s1 = state[i + 1];
                var s2 = state[i + 2],
                    s3 = state[i + 3];
                var h = s0 ^ s1 ^ s2 ^ s3;
                state[i + 0] ^= h ^ my.xtime[s0 ^ s1];
                state[i + 1] ^= h ^ my.xtime[s1 ^ s2];
                state[i + 2] ^= h ^ my.xtime[s2 ^ s3];
                state[i + 3] ^= h ^ my.xtime[s3 ^ s0];
            }
        }

        my.MixColumns_Inv = function (state) {
            for (var i = 0; i < 16; i += 4) {
                var s0 = state[i + 0],
                    s1 = state[i + 1];
                var s2 = state[i + 2],
                    s3 = state[i + 3];
                var h = s0 ^ s1 ^ s2 ^ s3;
                var xh = my.xtime[h];
                var h1 = my.xtime[my.xtime[xh ^ s0 ^ s2]] ^ h;
                var h2 = my.xtime[my.xtime[xh ^ s1 ^ s3]] ^ h;
                state[i + 0] ^= h1 ^ my.xtime[s0 ^ s1];
                state[i + 1] ^= h2 ^ my.xtime[s1 ^ s2];
                state[i + 2] ^= h1 ^ my.xtime[s2 ^ s3];
                state[i + 3] ^= h2 ^ my.xtime[s3 ^ s0];
            }
        }

        return my;

    }());




    var cryptico = (function() {

        var my = {};

        aes.Init();

        var base64Chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

        my.b256to64 = function(t) {
            var a, c, n;
            var r = '', l = 0, s = 0;
            var tl = t.length;
            for (n = 0; n < tl; n++)
            {
                c = t.charCodeAt(n);
                if (s == 0)
                {
                    r += base64Chars.charAt((c >> 2) & 63);
                    a = (c & 3) << 4;
                }
                else if (s == 1)
                {
                    r += base64Chars.charAt((a | (c >> 4) & 15));
                    a = (c & 15) << 2;
                }
                else if (s == 2)
                {
                    r += base64Chars.charAt(a | ((c >> 6) & 3));
                    l += 1;
                    r += base64Chars.charAt(c & 63);
                }
                l += 1;
                s += 1;
                if (s == 3) s = 0;
            }
            if (s > 0)
            {
                r += base64Chars.charAt(a);
                l += 1;
                r += '=';
                l += 1;
            }
            if (s == 1)
            {
                r += '=';
            }
            return r;
        }

        my.b64to256 = function(t)
        {
            var c, n;
            var r = '', s = 0, a = 0;
            var tl = t.length;
            for (n = 0; n < tl; n++)
            {
                c = base64Chars.indexOf(t.charAt(n));
                if (c >= 0)
                {
                    if (s) r += String.fromCharCode(a | (c >> (6 - s)) & 255);
                    s = (s + 2) & 7;
                    a = (c << s) & 255;
                }
            }
            return r;
        }

        my.b16to64 = function(h) {
            var i;
            var c;
            var ret = "";
            if(h.length % 2 == 1)
            {
                h = "0" + h;
            }
            for (i = 0; i + 3 <= h.length; i += 3)
            {
                c = parseInt(h.substring(i, i + 3), 16);
                ret += base64Chars.charAt(c >> 6) + base64Chars.charAt(c & 63);
            }
            if (i + 1 == h.length)
            {
                c = parseInt(h.substring(i, i + 1), 16);
                ret += base64Chars.charAt(c << 2);
            }
            else if (i + 2 == h.length)
            {
                c = parseInt(h.substring(i, i + 2), 16);
                ret += base64Chars.charAt(c >> 2) + base64Chars.charAt((c & 3) << 4);
            }
            while ((ret.length & 3) > 0) ret += "=";
            return ret;
        }

        my.b64to16 = function(s) {
            var ret = "";
            var i;
            var k = 0;
            var slop;
            for (i = 0; i < s.length; ++i)
            {
                if (s.charAt(i) == "=") break;
                v = base64Chars.indexOf(s.charAt(i));
                if (v < 0) continue;
                if (k == 0)
                {
                    ret += int2char(v >> 2);
                    slop = v & 3;
                    k = 1;
                }
                else if (k == 1)
                {
                    ret += int2char((slop << 2) | (v >> 4));
                    slop = v & 0xf;
                    k = 2;
                }
                else if (k == 2)
                {
                    ret += int2char(slop);
                    ret += int2char(v >> 2);
                    slop = v & 3;
                    k = 3;
                }
                else
                {
                    ret += int2char((slop << 2) | (v >> 4));
                    ret += int2char(v & 0xf);
                    k = 0;
                }
            }
            if (k == 1) ret += int2char(slop << 2);
            return ret;
        }

        // Converts a string to a byte array.
        my.string2bytes = function(string)
        {
            var bytes = new Array();
            for(var i = 0; i < string.length; i++)
            {
                bytes.push(string.charCodeAt(i));
            }
            return bytes;
        }

        // Converts a byte array to a string.
        my.bytes2string = function(bytes)
        {
            var string = "";
            for(var i = 0; i < bytes.length; i++)
            {
                string += String.fromCharCode(bytes[i]);
            }
            return string;
        }

        // Returns a XOR b, where a and b are 16-byte byte arrays.
        my.blockXOR = function(a, b)
        {
            var xor = new Array(16);
            for(var i = 0; i < 16; i++)
            {
                xor[i] = a[i] ^ b[i];
            }
            return xor;
        }

        // Returns a 16-byte initialization vector.
        my.blockIV = function()
        {
            var r = new SecureRandom();
            var IV = new Array(16);
            r.nextBytes(IV);
            return IV;
        }

        // Returns a copy of bytes with zeros appended to the end
        // so that the (length of bytes) % 16 == 0.
        my.pad16 = function(bytes)
        {
            var newBytes = bytes.slice(0);
            var padding = (16 - (bytes.length % 16)) % 16;
            for(i = bytes.length; i < bytes.length + padding; i++)
            {
                newBytes.push(0);
            }
            return newBytes;
        }

        // Removes trailing zeros from a byte array.
        my.depad = function(bytes)
        {
            var newBytes = bytes.slice(0);
            while(newBytes[newBytes.length - 1] == 0)
            {
                newBytes = newBytes.slice(0, newBytes.length - 1);
            }
            return newBytes;
        }

        // AES CBC Encryption.
        my.encryptAESCBC = function(plaintext, key)
        {
            var exkey = key.slice(0);
            aes.ExpandKey(exkey);
            var blocks = my.string2bytes(plaintext);
            blocks = my.pad16(blocks);
            var encryptedBlocks = my.blockIV();
            for(var i = 0; i < blocks.length/16; i++)
            {
                var tempBlock = blocks.slice(i * 16, i * 16 + 16);
                var prevBlock = encryptedBlocks.slice((i) * 16, (i) * 16 + 16);
                tempBlock = my.blockXOR(prevBlock, tempBlock);
                aes.Encrypt(tempBlock, exkey);
                encryptedBlocks = encryptedBlocks.concat(tempBlock);
            }
            var ciphertext = my.bytes2string(encryptedBlocks);
            return my.b256to64(ciphertext)
        }

        // AES CBC Decryption.
        my.decryptAESCBC = function(encryptedText, key)
        {
            var exkey = key.slice(0);
            aes.ExpandKey(exkey);
            var encryptedText = my.b64to256(encryptedText);
            var encryptedBlocks = my.string2bytes(encryptedText);
            var decryptedBlocks = new Array();
            for(var i = 1; i < encryptedBlocks.length/16; i++)
            {
                var tempBlock = encryptedBlocks.slice(i * 16, i * 16 + 16);
                var prevBlock = encryptedBlocks.slice((i-1) * 16, (i-1) * 16 + 16);
                aes.Decrypt(tempBlock, exkey);
                tempBlock = my.blockXOR(prevBlock, tempBlock);
                decryptedBlocks = decryptedBlocks.concat(tempBlock);
            }
            decryptedBlocks = my.depad(decryptedBlocks);
            return my.bytes2string(decryptedBlocks);
        }

        // Wraps a string to 60 characters.
        my.wrap60 = function(string)
        {
            var outstr = "";
            for(var i = 0; i < string.length; i++) {
                if(i % 60 == 0 && i != 0) outstr += "\n";
                outstr += string[i]; }
            return outstr;
        }

        // Generate a random key for the AES-encrypted message.
        my.generateAESKey = function()
        {
            var key = new Array(32);
            var r = new SecureRandom();
            r.nextBytes(key);
            return key;
        }

        // Generates an RSA key from a passphrase.
        my.generateRSAKey = function(passphrase, bitlength)
        {
            Math.seedrandom(sha256.hex(passphrase));
            var rsa = new RSAKey();
            rsa.generate(bitlength, "03");
            return rsa;
        }

        // Returns the ascii-armored version of the public key.
        my.publicKeyString = function(rsakey)
        {
            pubkey = my.b16to64(rsakey.n.toString(16));
            return pubkey;
        }

        // Returns an MD5 sum of a publicKeyString for easier identification.
        my.publicKeyID = function(publicKeyString)
        {
            return MD5(publicKeyString);
        }

        my.publicKeyFromString = function(string)
        {
            var N = my.b64to16(string.split("|")[0]);
            var E = "03";
            var rsa = new RSAKey();
            rsa.setPublic(N, E);
            return rsa
        }

        my.encrypt = function(plaintext, publickeystring, signingkey)
        {
            var cipherblock = "";
            var aeskey = my.generateAESKey();
            try
            {
                var publickey = my.publicKeyFromString(publickeystring);
                cipherblock += my.b16to64(publickey.encrypt(my.bytes2string(aeskey))) + "?";
            }
            catch(err)
            {
                return {status: "Invalid public key"};
            }
            if(signingkey)
            {
                signString = cryptico.b16to64(signingkey.signString(plaintext, "sha256"));
                plaintext += "::52cee64bb3a38f6403386519a39ac91c::";
                plaintext += cryptico.publicKeyString(signingkey);
                plaintext += "::52cee64bb3a38f6403386519a39ac91c::";
                plaintext += signString;
            }
            cipherblock += my.encryptAESCBC(plaintext, aeskey);
            return {status: "success", cipher: cipherblock};
        }

        my.decrypt = function(ciphertext, key)
        {
            var cipherblock = ciphertext.split("?");
            var aeskey = key.decrypt(my.b64to16(cipherblock[0]));
            if(aeskey == null)
            {
                return {status: "failure"};
            }
            aeskey = my.string2bytes(aeskey);
            var plaintext = my.decryptAESCBC(cipherblock[1], aeskey).split("::52cee64bb3a38f6403386519a39ac91c::");
            if(plaintext.length == 3)
            {
                var publickey = my.publicKeyFromString(plaintext[1]);
                var signature = my.b64to16(plaintext[2]);
                if(publickey.verifyString(plaintext[0], signature))
                {
                    return {status: "success",
                            plaintext: plaintext[0],
                            signature: "verified",
                            publicKeyString: my.publicKeyString(publickey)};
                }
                else
                {
                    return {status: "success",
                            plaintext: plaintext[0],
                            signature: "forged",
                            publicKeyString: my.publicKeyString(publickey)};
                }
            }
            else
            {
                return {status: "success", plaintext: plaintext[0], signature: "unsigned"};
            }
        }

        return my;

    }());


    </script>


    <script type="text/javascript">
    /**
     * [js-sha256]{@link https://github.com/emn178/js-sha256}
     *
     * @version 0.9.0
     * @author Chen, Yi-Cyuan [emn178@gmail.com]
     * @copyright Chen, Yi-Cyuan 2014-2017
     * @license MIT
     */
    /*jslint bitwise: true */
    (function () {
      'use strict';

      var ERROR = 'input is invalid type';
      var WINDOW = typeof window === 'object';
      var root = WINDOW ? window : {};
      if (root.JS_SHA256_NO_WINDOW) {
        WINDOW = false;
      }
      var WEB_WORKER = !WINDOW && typeof self === 'object';
      var NODE_JS = !root.JS_SHA256_NO_NODE_JS && typeof process === 'object' && process.versions && process.versions.node;
      if (NODE_JS) {
        root = global;
      } else if (WEB_WORKER) {
        root = self;
      }
      var COMMON_JS = !root.JS_SHA256_NO_COMMON_JS && typeof module === 'object' && module.exports;
      var AMD = typeof define === 'function' && define.amd;
      var ARRAY_BUFFER = !root.JS_SHA256_NO_ARRAY_BUFFER && typeof ArrayBuffer !== 'undefined';
      var HEX_CHARS = '0123456789abcdef'.split('');
      var EXTRA = [-2147483648, 8388608, 32768, 128];
      var SHIFT = [24, 16, 8, 0];
      var K = [
        0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,
        0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,
        0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
        0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,
        0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,
        0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
        0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,
        0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2
      ];
      var OUTPUT_TYPES = ['hex', 'array', 'digest', 'arrayBuffer'];

      var blocks = [];

      if (root.JS_SHA256_NO_NODE_JS || !Array.isArray) {
        Array.isArray = function (obj) {
          return Object.prototype.toString.call(obj) === '[object Array]';
        };
      }

      if (ARRAY_BUFFER && (root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW || !ArrayBuffer.isView)) {
        ArrayBuffer.isView = function (obj) {
          return typeof obj === 'object' && obj.buffer && obj.buffer.constructor === ArrayBuffer;
        };
      }

      var createOutputMethod = function (outputType, is224) {
        return function (message) {
          return new Sha256(is224, true).update(message)[outputType]();
        };
      };

      var createMethod = function (is224) {
        var method = createOutputMethod('hex', is224);
        if (NODE_JS) {
          method = nodeWrap(method, is224);
        }
        method.create = function () {
          return new Sha256(is224);
        };
        method.update = function (message) {
          return method.create().update(message);
        };
        for (var i = 0; i < OUTPUT_TYPES.length; ++i) {
          var type = OUTPUT_TYPES[i];
          method[type] = createOutputMethod(type, is224);
        }
        return method;
      };

      var nodeWrap = function (method, is224) {
        var crypto = eval("require('crypto')");
        var Buffer = eval("require('buffer').Buffer");
        var algorithm = is224 ? 'sha224' : 'sha256';
        var nodeMethod = function (message) {
          if (typeof message === 'string') {
            return crypto.createHash(algorithm).update(message, 'utf8').digest('hex');
          } else {
            if (message === null || message === undefined) {
              throw new Error(ERROR);
            } else if (message.constructor === ArrayBuffer) {
              message = new Uint8Array(message);
            }
          }
          if (Array.isArray(message) || ArrayBuffer.isView(message) ||
            message.constructor === Buffer) {
            return crypto.createHash(algorithm).update(new Buffer(message)).digest('hex');
          } else {
            return method(message);
          }
        };
        return nodeMethod;
      };

      var createHmacOutputMethod = function (outputType, is224) {
        return function (key, message) {
          return new HmacSha256(key, is224, true).update(message)[outputType]();
        };
      };

      var createHmacMethod = function (is224) {
        var method = createHmacOutputMethod('hex', is224);
        method.create = function (key) {
          return new HmacSha256(key, is224);
        };
        method.update = function (key, message) {
          return method.create(key).update(message);
        };
        for (var i = 0; i < OUTPUT_TYPES.length; ++i) {
          var type = OUTPUT_TYPES[i];
          method[type] = createHmacOutputMethod(type, is224);
        }
        return method;
      };

      function Sha256(is224, sharedMemory) {
        if (sharedMemory) {
          blocks[0] = blocks[16] = blocks[1] = blocks[2] = blocks[3] =
            blocks[4] = blocks[5] = blocks[6] = blocks[7] =
            blocks[8] = blocks[9] = blocks[10] = blocks[11] =
            blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
          this.blocks = blocks;
        } else {
          this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        }

        if (is224) {
          this.h0 = 0xc1059ed8;
          this.h1 = 0x367cd507;
          this.h2 = 0x3070dd17;
          this.h3 = 0xf70e5939;
          this.h4 = 0xffc00b31;
          this.h5 = 0x68581511;
          this.h6 = 0x64f98fa7;
          this.h7 = 0xbefa4fa4;
        } else { // 256
          this.h0 = 0x6a09e667;
          this.h1 = 0xbb67ae85;
          this.h2 = 0x3c6ef372;
          this.h3 = 0xa54ff53a;
          this.h4 = 0x510e527f;
          this.h5 = 0x9b05688c;
          this.h6 = 0x1f83d9ab;
          this.h7 = 0x5be0cd19;
        }

        this.block = this.start = this.bytes = this.hBytes = 0;
        this.finalized = this.hashed = false;
        this.first = true;
        this.is224 = is224;
      }

      Sha256.prototype.update = function (message) {
        if (this.finalized) {
          return;
        }
        var notString, type = typeof message;
        if (type !== 'string') {
          if (type === 'object') {
            if (message === null) {
              throw new Error(ERROR);
            } else if (ARRAY_BUFFER && message.constructor === ArrayBuffer) {
              message = new Uint8Array(message);
            } else if (!Array.isArray(message)) {
              if (!ARRAY_BUFFER || !ArrayBuffer.isView(message)) {
                throw new Error(ERROR);
              }
            }
          } else {
            throw new Error(ERROR);
          }
          notString = true;
        }
        var code, index = 0, i, length = message.length, blocks = this.blocks;

        while (index < length) {
          if (this.hashed) {
            this.hashed = false;
            blocks[0] = this.block;
            blocks[16] = blocks[1] = blocks[2] = blocks[3] =
              blocks[4] = blocks[5] = blocks[6] = blocks[7] =
              blocks[8] = blocks[9] = blocks[10] = blocks[11] =
              blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
          }

          if (notString) {
            for (i = this.start; index < length && i < 64; ++index) {
              blocks[i >> 2] |= message[index] << SHIFT[i++ & 3];
            }
          } else {
            for (i = this.start; index < length && i < 64; ++index) {
              code = message.charCodeAt(index);
              if (code < 0x80) {
                blocks[i >> 2] |= code << SHIFT[i++ & 3];
              } else if (code < 0x800) {
                blocks[i >> 2] |= (0xc0 | (code >> 6)) << SHIFT[i++ & 3];
                blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];
              } else if (code < 0xd800 || code >= 0xe000) {
                blocks[i >> 2] |= (0xe0 | (code >> 12)) << SHIFT[i++ & 3];
                blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];
                blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];
              } else {
                code = 0x10000 + (((code & 0x3ff) << 10) | (message.charCodeAt(++index) & 0x3ff));
                blocks[i >> 2] |= (0xf0 | (code >> 18)) << SHIFT[i++ & 3];
                blocks[i >> 2] |= (0x80 | ((code >> 12) & 0x3f)) << SHIFT[i++ & 3];
                blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];
                blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];
              }
            }
          }

          this.lastByteIndex = i;
          this.bytes += i - this.start;
          if (i >= 64) {
            this.block = blocks[16];
            this.start = i - 64;
            this.hash();
            this.hashed = true;
          } else {
            this.start = i;
          }
        }
        if (this.bytes > 4294967295) {
          this.hBytes += this.bytes / 4294967296 << 0;
          this.bytes = this.bytes % 4294967296;
        }
        return this;
      };

      Sha256.prototype.finalize = function () {
        if (this.finalized) {
          return;
        }
        this.finalized = true;
        var blocks = this.blocks, i = this.lastByteIndex;
        blocks[16] = this.block;
        blocks[i >> 2] |= EXTRA[i & 3];
        this.block = blocks[16];
        if (i >= 56) {
          if (!this.hashed) {
            this.hash();
          }
          blocks[0] = this.block;
          blocks[16] = blocks[1] = blocks[2] = blocks[3] =
            blocks[4] = blocks[5] = blocks[6] = blocks[7] =
            blocks[8] = blocks[9] = blocks[10] = blocks[11] =
            blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
        }
        blocks[14] = this.hBytes << 3 | this.bytes >>> 29;
        blocks[15] = this.bytes << 3;
        this.hash();
      };

      Sha256.prototype.hash = function () {
        var a = this.h0, b = this.h1, c = this.h2, d = this.h3, e = this.h4, f = this.h5, g = this.h6,
          h = this.h7, blocks = this.blocks, j, s0, s1, maj, t1, t2, ch, ab, da, cd, bc;

        for (j = 16; j < 64; ++j) {
          // rightrotate
          t1 = blocks[j - 15];
          s0 = ((t1 >>> 7) | (t1 << 25)) ^ ((t1 >>> 18) | (t1 << 14)) ^ (t1 >>> 3);
          t1 = blocks[j - 2];
          s1 = ((t1 >>> 17) | (t1 << 15)) ^ ((t1 >>> 19) | (t1 << 13)) ^ (t1 >>> 10);
          blocks[j] = blocks[j - 16] + s0 + blocks[j - 7] + s1 << 0;
        }

        bc = b & c;
        for (j = 0; j < 64; j += 4) {
          if (this.first) {
            if (this.is224) {
              ab = 300032;
              t1 = blocks[0] - 1413257819;
              h = t1 - 150054599 << 0;
              d = t1 + 24177077 << 0;
            } else {
              ab = 704751109;
              t1 = blocks[0] - 210244248;
              h = t1 - 1521486534 << 0;
              d = t1 + 143694565 << 0;
            }
            this.first = false;
          } else {
            s0 = ((a >>> 2) | (a << 30)) ^ ((a >>> 13) | (a << 19)) ^ ((a >>> 22) | (a << 10));
            s1 = ((e >>> 6) | (e << 26)) ^ ((e >>> 11) | (e << 21)) ^ ((e >>> 25) | (e << 7));
            ab = a & b;
            maj = ab ^ (a & c) ^ bc;
            ch = (e & f) ^ (~e & g);
            t1 = h + s1 + ch + K[j] + blocks[j];
            t2 = s0 + maj;
            h = d + t1 << 0;
            d = t1 + t2 << 0;
          }
          s0 = ((d >>> 2) | (d << 30)) ^ ((d >>> 13) | (d << 19)) ^ ((d >>> 22) | (d << 10));
          s1 = ((h >>> 6) | (h << 26)) ^ ((h >>> 11) | (h << 21)) ^ ((h >>> 25) | (h << 7));
          da = d & a;
          maj = da ^ (d & b) ^ ab;
          ch = (h & e) ^ (~h & f);
          t1 = g + s1 + ch + K[j + 1] + blocks[j + 1];
          t2 = s0 + maj;
          g = c + t1 << 0;
          c = t1 + t2 << 0;
          s0 = ((c >>> 2) | (c << 30)) ^ ((c >>> 13) | (c << 19)) ^ ((c >>> 22) | (c << 10));
          s1 = ((g >>> 6) | (g << 26)) ^ ((g >>> 11) | (g << 21)) ^ ((g >>> 25) | (g << 7));
          cd = c & d;
          maj = cd ^ (c & a) ^ da;
          ch = (g & h) ^ (~g & e);
          t1 = f + s1 + ch + K[j + 2] + blocks[j + 2];
          t2 = s0 + maj;
          f = b + t1 << 0;
          b = t1 + t2 << 0;
          s0 = ((b >>> 2) | (b << 30)) ^ ((b >>> 13) | (b << 19)) ^ ((b >>> 22) | (b << 10));
          s1 = ((f >>> 6) | (f << 26)) ^ ((f >>> 11) | (f << 21)) ^ ((f >>> 25) | (f << 7));
          bc = b & c;
          maj = bc ^ (b & d) ^ cd;
          ch = (f & g) ^ (~f & h);
          t1 = e + s1 + ch + K[j + 3] + blocks[j + 3];
          t2 = s0 + maj;
          e = a + t1 << 0;
          a = t1 + t2 << 0;
        }

        this.h0 = this.h0 + a << 0;
        this.h1 = this.h1 + b << 0;
        this.h2 = this.h2 + c << 0;
        this.h3 = this.h3 + d << 0;
        this.h4 = this.h4 + e << 0;
        this.h5 = this.h5 + f << 0;
        this.h6 = this.h6 + g << 0;
        this.h7 = this.h7 + h << 0;
      };

      Sha256.prototype.hex = function () {
        this.finalize();

        var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3, h4 = this.h4, h5 = this.h5,
          h6 = this.h6, h7 = this.h7;

        var hex = HEX_CHARS[(h0 >> 28) & 0x0F] + HEX_CHARS[(h0 >> 24) & 0x0F] +
          HEX_CHARS[(h0 >> 20) & 0x0F] + HEX_CHARS[(h0 >> 16) & 0x0F] +
          HEX_CHARS[(h0 >> 12) & 0x0F] + HEX_CHARS[(h0 >> 8) & 0x0F] +
          HEX_CHARS[(h0 >> 4) & 0x0F] + HEX_CHARS[h0 & 0x0F] +
          HEX_CHARS[(h1 >> 28) & 0x0F] + HEX_CHARS[(h1 >> 24) & 0x0F] +
          HEX_CHARS[(h1 >> 20) & 0x0F] + HEX_CHARS[(h1 >> 16) & 0x0F] +
          HEX_CHARS[(h1 >> 12) & 0x0F] + HEX_CHARS[(h1 >> 8) & 0x0F] +
          HEX_CHARS[(h1 >> 4) & 0x0F] + HEX_CHARS[h1 & 0x0F] +
          HEX_CHARS[(h2 >> 28) & 0x0F] + HEX_CHARS[(h2 >> 24) & 0x0F] +
          HEX_CHARS[(h2 >> 20) & 0x0F] + HEX_CHARS[(h2 >> 16) & 0x0F] +
          HEX_CHARS[(h2 >> 12) & 0x0F] + HEX_CHARS[(h2 >> 8) & 0x0F] +
          HEX_CHARS[(h2 >> 4) & 0x0F] + HEX_CHARS[h2 & 0x0F] +
          HEX_CHARS[(h3 >> 28) & 0x0F] + HEX_CHARS[(h3 >> 24) & 0x0F] +
          HEX_CHARS[(h3 >> 20) & 0x0F] + HEX_CHARS[(h3 >> 16) & 0x0F] +
          HEX_CHARS[(h3 >> 12) & 0x0F] + HEX_CHARS[(h3 >> 8) & 0x0F] +
          HEX_CHARS[(h3 >> 4) & 0x0F] + HEX_CHARS[h3 & 0x0F] +
          HEX_CHARS[(h4 >> 28) & 0x0F] + HEX_CHARS[(h4 >> 24) & 0x0F] +
          HEX_CHARS[(h4 >> 20) & 0x0F] + HEX_CHARS[(h4 >> 16) & 0x0F] +
          HEX_CHARS[(h4 >> 12) & 0x0F] + HEX_CHARS[(h4 >> 8) & 0x0F] +
          HEX_CHARS[(h4 >> 4) & 0x0F] + HEX_CHARS[h4 & 0x0F] +
          HEX_CHARS[(h5 >> 28) & 0x0F] + HEX_CHARS[(h5 >> 24) & 0x0F] +
          HEX_CHARS[(h5 >> 20) & 0x0F] + HEX_CHARS[(h5 >> 16) & 0x0F] +
          HEX_CHARS[(h5 >> 12) & 0x0F] + HEX_CHARS[(h5 >> 8) & 0x0F] +
          HEX_CHARS[(h5 >> 4) & 0x0F] + HEX_CHARS[h5 & 0x0F] +
          HEX_CHARS[(h6 >> 28) & 0x0F] + HEX_CHARS[(h6 >> 24) & 0x0F] +
          HEX_CHARS[(h6 >> 20) & 0x0F] + HEX_CHARS[(h6 >> 16) & 0x0F] +
          HEX_CHARS[(h6 >> 12) & 0x0F] + HEX_CHARS[(h6 >> 8) & 0x0F] +
          HEX_CHARS[(h6 >> 4) & 0x0F] + HEX_CHARS[h6 & 0x0F];
        if (!this.is224) {
          hex += HEX_CHARS[(h7 >> 28) & 0x0F] + HEX_CHARS[(h7 >> 24) & 0x0F] +
            HEX_CHARS[(h7 >> 20) & 0x0F] + HEX_CHARS[(h7 >> 16) & 0x0F] +
            HEX_CHARS[(h7 >> 12) & 0x0F] + HEX_CHARS[(h7 >> 8) & 0x0F] +
            HEX_CHARS[(h7 >> 4) & 0x0F] + HEX_CHARS[h7 & 0x0F];
        }
        return hex;
      };

      Sha256.prototype.toString = Sha256.prototype.hex;

      Sha256.prototype.digest = function () {
        this.finalize();

        var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3, h4 = this.h4, h5 = this.h5,
          h6 = this.h6, h7 = this.h7;

        var arr = [
          (h0 >> 24) & 0xFF, (h0 >> 16) & 0xFF, (h0 >> 8) & 0xFF, h0 & 0xFF,
          (h1 >> 24) & 0xFF, (h1 >> 16) & 0xFF, (h1 >> 8) & 0xFF, h1 & 0xFF,
          (h2 >> 24) & 0xFF, (h2 >> 16) & 0xFF, (h2 >> 8) & 0xFF, h2 & 0xFF,
          (h3 >> 24) & 0xFF, (h3 >> 16) & 0xFF, (h3 >> 8) & 0xFF, h3 & 0xFF,
          (h4 >> 24) & 0xFF, (h4 >> 16) & 0xFF, (h4 >> 8) & 0xFF, h4 & 0xFF,
          (h5 >> 24) & 0xFF, (h5 >> 16) & 0xFF, (h5 >> 8) & 0xFF, h5 & 0xFF,
          (h6 >> 24) & 0xFF, (h6 >> 16) & 0xFF, (h6 >> 8) & 0xFF, h6 & 0xFF
        ];
        if (!this.is224) {
          arr.push((h7 >> 24) & 0xFF, (h7 >> 16) & 0xFF, (h7 >> 8) & 0xFF, h7 & 0xFF);
        }
        return arr;
      };

      Sha256.prototype.array = Sha256.prototype.digest;

      Sha256.prototype.arrayBuffer = function () {
        this.finalize();

        var buffer = new ArrayBuffer(this.is224 ? 28 : 32);
        var dataView = new DataView(buffer);
        dataView.setUint32(0, this.h0);
        dataView.setUint32(4, this.h1);
        dataView.setUint32(8, this.h2);
        dataView.setUint32(12, this.h3);
        dataView.setUint32(16, this.h4);
        dataView.setUint32(20, this.h5);
        dataView.setUint32(24, this.h6);
        if (!this.is224) {
          dataView.setUint32(28, this.h7);
        }
        return buffer;
      };

      function HmacSha256(key, is224, sharedMemory) {
        var i, type = typeof key;
        if (type === 'string') {
          var bytes = [], length = key.length, index = 0, code;
          for (i = 0; i < length; ++i) {
            code = key.charCodeAt(i);
            if (code < 0x80) {
              bytes[index++] = code;
            } else if (code < 0x800) {
              bytes[index++] = (0xc0 | (code >> 6));
              bytes[index++] = (0x80 | (code & 0x3f));
            } else if (code < 0xd800 || code >= 0xe000) {
              bytes[index++] = (0xe0 | (code >> 12));
              bytes[index++] = (0x80 | ((code >> 6) & 0x3f));
              bytes[index++] = (0x80 | (code & 0x3f));
            } else {
              code = 0x10000 + (((code & 0x3ff) << 10) | (key.charCodeAt(++i) & 0x3ff));
              bytes[index++] = (0xf0 | (code >> 18));
              bytes[index++] = (0x80 | ((code >> 12) & 0x3f));
              bytes[index++] = (0x80 | ((code >> 6) & 0x3f));
              bytes[index++] = (0x80 | (code & 0x3f));
            }
          }
          key = bytes;
        } else {
          if (type === 'object') {
            if (key === null) {
              throw new Error(ERROR);
            } else if (ARRAY_BUFFER && key.constructor === ArrayBuffer) {
              key = new Uint8Array(key);
            } else if (!Array.isArray(key)) {
              if (!ARRAY_BUFFER || !ArrayBuffer.isView(key)) {
                throw new Error(ERROR);
              }
            }
          } else {
            throw new Error(ERROR);
          }
        }

        if (key.length > 64) {
          key = (new Sha256(is224, true)).update(key).array();
        }

        var oKeyPad = [], iKeyPad = [];
        for (i = 0; i < 64; ++i) {
          var b = key[i] || 0;
          oKeyPad[i] = 0x5c ^ b;
          iKeyPad[i] = 0x36 ^ b;
        }

        Sha256.call(this, is224, sharedMemory);

        this.update(iKeyPad);
        this.oKeyPad = oKeyPad;
        this.inner = true;
        this.sharedMemory = sharedMemory;
      }
      HmacSha256.prototype = new Sha256();

      HmacSha256.prototype.finalize = function () {
        Sha256.prototype.finalize.call(this);
        if (this.inner) {
          this.inner = false;
          var innerHash = this.array();
          Sha256.call(this, this.is224, this.sharedMemory);
          this.update(this.oKeyPad);
          this.update(innerHash);
          Sha256.prototype.finalize.call(this);
        }
      };

      var exports = createMethod();
      exports.sha256 = exports;
      exports.sha224 = createMethod(true);
      exports.sha256.hmac = createHmacMethod();
      exports.sha224.hmac = createHmacMethod(true);

      if (COMMON_JS) {
        module.exports = exports;
      } else {
        root.sha256 = exports.sha256;
        root.sha224 = exports.sha224;
        if (AMD) {
          define(function () {
            return exports;
          });
        }
      }
    })();

    </script>

<script type="text/javascript">
    /**
     * just namespace
     * @type {[type]}
     */
    var just = just || {};

    /**
     * Random string generator
     *
     * can be used on node.js or client side
     *
     * type can be numbers, uppercases, lowercases or combination
     * of those separated with _
     *
     * examples:
     * var rs = randomstring(); // returns "ElZOtlOSLn49GeKLev2O"
     * var rs = randomstring(20, 'numbers'); // returns "78394850802905961074"
     * var rs = randomstring(15, 'numbers_uppercases'); // returns "PXL3AE2USI7ZDQ2"
     *
     * @param  {int} len length of generated string
     * @param  {string} type type of charachters in string
     * @return {string}
     */
    just.randomstring = function (len, type) {

        len = len || 20;
        type = type || 'numbers_uppercases_lowercases';

        var strings = {
                numbers: '0123456789',
                uppercases: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
                lowercases: 'abcdefghiklmnopqrstuvwxyz'
            },
            choise = '',
            ret = '',
            types = type.split('_'),
            i;

        for (i = 0; i < types.length; i++) {
            if (strings[types[i]]) {
                choise += strings[types[i]];
            }
        }

        if (!choise) {
            choise = strings.numbers + strings.lowercases + strings.uppercases;
        }

        for (i = 0; i < len; i++) {
            ret +=  choise[Math.floor(Math.random() * choise.length)];
        }

        return ret;

    };

    /**
     * Return array of random strings
     *
     * first param is length of array, other params are the
     * same as for randomstring(len, type)
     *
     * @param  {int} arrayLen
     * @param  {int} len
     * @param  {string} type
     * @return {array}
     */
    just.randomstring.array = function (arrayLen, len, type) {

        arrayLen = arrayLen || 5;

        var ret = [],
            i;

        for (i = 0; i < arrayLen; i++) {
            ret.push(this(len, type));
        }

        return ret;

    };

    if (typeof module !== 'undefined' && module.exports) {
        module.exports = just.randomstring;
    }

</script>

<script type="text/javascript">

    var is_autoconnect_active = false;

    var autoconnect_details = {
        "host" : "127.0.0.1",
        "port" : 1111,
        "keys" : [
            "test"
        ]
    };

    var custom_key_count = 1;
    var metadata_keys = [];
    var base64_picture_string_to_send = "";
    var verification_message = "welcome";
    var socket_connected = false;
    var host = "";
    var port = 0;
    var socket;
    var local_username = "";
    var local_user_id = 0;
    var is_authenticated = false;
    var is_local_user_maintainer = false;
    var is_encryption_key_of_channel_obtained = false;
    var is_connection_check_thread_running = false;
    var current_channel_id = 1;
    var current_chat_context_id = "chat-context-channel-1";
    var chat_message_receiver_type = "channel";
    var chat_message_receiver_id = "main";
    var textarea_log;
    var my_rsa_key_object = null;
    var rsa_public_key_string = "";
    var is_rsa_key_generated = false;
    var is_client_list_retrieved = false;
    var is_channel_list_retrieved = false;
    var users = [];
    var loading_gif = "";
    var channel_list = [];
    var selected_channel_id;
    var current_channel_keys = null;

    function sleep(ms)
    {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    var chat_context_array = [{
        "type":"channel",
        "chat_context_id": "chat-context-channel-1",
        "last_known_message_sender_username" : ""
    }];

    function log(text)
    {
        textarea_log.value = textarea_log.value + text + "\n";
    }

      //function that runs in background. somehow

    async function check_connection(socket)
    {
        while(true)
        {
            var message_object = {"message" :
            {
                "type" : "client_connection_test",
            }};

            var message_json_string = JSON.stringify(message_object);
            var data = encrypt_all_message_data_and_convert_to_base64(message_json_string);
            if(socket.readyState === 1)
            {
                socket.send(data);
            }
            await sleep(30000);
        }
    }

    function get_chat_context_index_by_chat_context_id(id)
    {
        for(var i = 0; i < chat_context_array.length; i++)
        {
            if(chat_context_array[i].chat_context_id == id)
            {
                return i;
            }
        }
        return -1;
    }

    function get_user_index_by_username(username)
    {
        for(var i = 0; i < users.length; i++)
        {
            if(users[i].username == username)
            {
                return i;
            }
        }
        return -1;
    }

    function get_channels_by_channel_parent_id(channels, parent_channel_id)
    {
        let result = [];;
        for(var i = 0; i < channels.length; i++)
        {
            if(channels[i].parent_channel_id == parent_channel_id)
            {
                result.push(channels[i]);
            }
        }
        return result;
    }

    function get_channel_by_id(channel_list_a, channel_id)
    {
        let result = null;

        for(let x = 0; x < channel_list_a.length; x++)
        {
            if(channel_list_a[x].channel_id == channel_id)
            {
                result = channel_list_a[x];
                break;
            }
        }

        return result;
    }

    function get_channel_index_by_channel_id(channel_list_a, channel_id)
    {
        let result = -1;

        for(let x = 0; x < channel_list_a.length; x++)
        {
            if(channel_list_a[x].channel_id == channel_id)
            {
                result = x;
                break;
            }
        }

        return result;
    }

    function encrypt_with_aes_keys_and_convert_to_base64(keys, string_to_encrypt)
    {
        var byteArrayToSend = new Uint8Array(1024);
        if(string_to_encrypt.length > 1024)
        {
            byteArrayToSend = new Uint8Array(string_to_encrypt.length);
        }

        var textBytes = aesjs.utils.utf8.toBytes(string_to_encrypt);

        for(i = 0; i < textBytes.length; i++)
        {
            byteArrayToSend[i] = textBytes[i];
        }
        var base64EncryptedData = "";
        var encrypted_data_in_current_iteration = byteArrayToSend;

        for(var i = 0; i < keys.length; i++)
        {
            var aesCtrCustom = new aesjs.ModeOfOperation.ctr(keys[i].key_bytes, new aesjs.Counter(keys[i].iv_bytes));
            encrypted_data_in_current_iteration = aesCtrCustom.encrypt(encrypted_data_in_current_iteration);

            //log("direct message encryption: encrypting data with key : " + keys[i].key_bytes.toString());
            //log("direct message encryption: using initialization vector : " + keys[i].iv_bytes.toString());

            if(i + 1 == keys.length) //if end was reached, its time to convert encrypted bytes to string
            {
                base64EncryptedData = bytesToBase64String(encrypted_data_in_current_iteration);
            }
        }
        return base64EncryptedData;
    }

    function decrypt_with_aes_keys(keys, string_to_decrypt)
    {
        let encrypted_data_in_current_iteration = base64StringToBytes(string_to_decrypt);

        //decrypt by applying keys in reverse order
        for(let i = (keys.length - 1); i >= 0; i--)
        {
            let aesCtrCustom = new aesjs.ModeOfOperation.ctr(keys[i].key_bytes, new aesjs.Counter(keys[i].iv_bytes));
            encrypted_data_in_current_iteration = aesCtrCustom.decrypt(encrypted_data_in_current_iteration);
        }

        decryptedBytes = encrypted_data_in_current_iteration;

        let str1 = new TextDecoder().decode(decryptedBytes);
        let decrypted_metadata = substringByNullTerminator(str1);
        return decrypted_metadata;
    }

    function encrypt_all_message_data_and_convert_to_base64(string_to_encrypt)
    {
        let byteArrayToSend = new Uint8Array(1024);
        if(string_to_encrypt.length > 1024)
        {
            byteArrayToSend = new Uint8Array(string_to_encrypt.length);
        }

        let textBytes = aesjs.utils.utf8.toBytes(string_to_encrypt);

        for(i = 0; i < textBytes.length; i++)
        {
            byteArrayToSend[i] = textBytes[i];
        }

        let base64EncryptedData = "";
        let encrypted_data_in_current_iteration = byteArrayToSend;

        for(let i = 0; i < metadata_keys.length; i++)
        {
            let key_bytes = metadata_keys[i].key;
            let iv_bytes = metadata_keys[i].iv;

            let aesCtrCustom = new aesjs.ModeOfOperation.ctr(key_bytes, new aesjs.Counter(iv_bytes));
            encrypted_data_in_current_iteration = aesCtrCustom.encrypt(encrypted_data_in_current_iteration);

            //log("encrypting data with key : " + key_bytes.toString());
            //log("using initialization vector : " + iv_bytes.toString());

            if(i + 1 == metadata_keys.length) //if end was reached, its time to convert encrypted bytes to string
            {
                base64EncryptedData = bytesToBase64String(encrypted_data_in_current_iteration);
            }
        }
        return base64EncryptedData;
    }

    function decrypt_message_metadata(base64)
    {
        let encrypted_data_in_current_iteration = base64StringToBytes(base64);

        for(let i = (metadata_keys.length - 1); i >= 0; i--)
        {
            let key_bytes = metadata_keys[i].key;
            let iv_bytes = metadata_keys[i].iv;

            let aesCtrCustom = new aesjs.ModeOfOperation.ctr(key_bytes, new aesjs.Counter(iv_bytes));
            encrypted_data_in_current_iteration = aesCtrCustom.decrypt(encrypted_data_in_current_iteration);
        }

        decryptedBytes = encrypted_data_in_current_iteration;

        let str1 = new TextDecoder().decode(decryptedBytes);
        let decrypted_metadata = substringByNullTerminator(str1);
        return decrypted_metadata;
    }

    function sanitize_string(str)
    {
        var map = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;'
        };
        var new_string = str.replace(/[&<>"']/g, function(m) { return map[m]; });
        return new_string;
    }

    function get_indend_level(channel_id,channels)
    {
        let result = 0;
        let is_root_channel_found = false;
        let channel_id_currently_looking_for = channel_id;

        while(is_root_channel_found == false)
        {
            for(let i = 0; i < channels.length; i++)
            {
                if(channels[i].channel_id == channel_id_currently_looking_for)
                {
                    if(channels[i].parent_channel_id != -1)
                    {
                        result++;
                        channel_id_currently_looking_for = channels[i].parent_channel_id;
                        break;
                    }
                    else
                    {
                        is_root_channel_found = true;
                        break;
                    }
                }
            }
        }
        return result;
    }

    function send_channel_chat_message()
    {
        console.log("send_channel_chat_message()")
        let chat_message_to_send_value = document.getElementById('chat-input-container-text-input').value;
        document.getElementById('chat-input-container-text-input').value = "";

        if(base64_picture_string_to_send.length > 0 && chat_message_to_send_value.length > 0)
        {
            return;
        }

        let chat_context_index = get_chat_context_index_by_chat_context_id(current_chat_context_id);
        if(chat_context_index == -1)
        {
            log('could not find ' + current_chat_context_id.toString());
            return;
        }

        if(base64_picture_string_to_send.length > 0)
        {
            let element_count = document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer').length;

            for(let i = 0; i < element_count; i++)
            {
                document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer')[0].remove();
            }

            let html_to_append = "<div class=\"single-chat-message\">\n\
                                    <div class=\"single-message-content\">\n\
                                        <div class=\"single-chat-message-sender-local-username-container\">\n\
                                            <p>"+ local_username +"</p>\n\
                                        </div>\n\
                                        <div class=\"single-chat-message-sender-time\">\n\
                                            <p>"+ new Date().toLocaleTimeString() +"</p>\n\
                                        </div>\n\
                                        <div class=\"single-chat-message-content\">\n\
                                            <img src="+ base64_picture_string_to_send +" style=\"max-width: 500px;\"></img>\n\
                                        </div>\n\
                                    </div>\n\
                                </div>";

            document.getElementById(current_chat_context_id).innerHTML += html_to_append;
            document.getElementById(current_chat_context_id).innerHTML += '<div class=\"chat-spacer\"></div>';
            document.getElementById('chat-context-container').scrollTop = document.getElementById('chat-context-container').scrollHeight;

            let message_object = {"message" :
                {
                  "type" : "client_chat_picture",
                  "value" : "",
                  "receiver_type" : chat_message_receiver_type,
                  "receiver_id" : current_channel_id.toString()
                }
            };

            message_object.message.value = encrypt_with_aes_keys_and_convert_to_base64(current_channel_keys,base64_picture_string_to_send);


            let message_json_string = JSON.stringify(message_object);
            let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

            if(socket.readyState === 1)
            {
                socket.send(data);
            }

            base64_picture_string_to_send = "";
            document.getElementById("image-upload-preview").style.backgroundImage = "";
            chat_context_array[chat_context_index].last_known_message_sender_username = local_username;
        }
        else if(chat_message_to_send_value.length > 0)
        {
            if(chat_context_array[chat_context_index].last_known_message_sender_username == local_username)
            {
                let chat_message = "<p>" + sanitize_string(chat_message_to_send_value) + "</p>";
                let last_child_index = document.getElementById(current_chat_context_id).getElementsByClassName("single-chat-message").length - 1;
                document.getElementById(current_chat_context_id).getElementsByClassName("single-chat-message")[last_child_index].getElementsByClassName("single-chat-message-content")[0].innerHTML += chat_message;
            }
            else
            {

                let element_count = document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer').length;

                for(let i = 0; i < element_count; i++)
                {
                    document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer')[0].remove();
                }

                let html_to_append = "<div class=\"single-chat-message\">\n\
                                        <div class=\"single-message-content\">\n\
                                            <div class=\"single-chat-message-sender-local-username-container\">\n\
                                                <p>"+ local_username +"</p>\n\
                                            </div>\n\
                                            <div class=\"single-chat-message-sender-time\">\n\
                                                <p>"+ new Date().toLocaleTimeString() +"</p>\n\
                                            </div>\n\
                                            <div class=\"single-chat-message-content\">\n\
                                                <p>"+ sanitize_string(chat_message_to_send_value) +"</p>\n\
                                            </div>\n\
                                        </div>\n\
                                    </div>";

                document.getElementById(current_chat_context_id).innerHTML += html_to_append;
                document.getElementById(current_chat_context_id).innerHTML += '<div class=\"chat-spacer\"></div>';
            }

            document.getElementById("chat-context-container").scrollTop = document.getElementById("chat-context-container").scrollHeight;

            let message_object = {
                "message" : {
                  "type" : "client_chat_message",
                  "value" : "",
                  "receiver_type" : "channel",
                  "receiver_id" : current_channel_id.toString()
                }
            };

            message_object.message.value = encrypt_with_aes_keys_and_convert_to_base64(current_channel_keys,chat_message_to_send_value);

            console.log(message_object);
            let message_json_string = JSON.stringify(message_object);
            let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

            if(socket.readyState === 1)
            {
                socket.send(data);
            }

            chat_context_array[chat_context_index].last_known_message_sender_username = local_username;
        }
    }

    function send_direct_chat_message()
    {
        let chat_message_to_send_value = document.getElementById('chat-input-container-text-input').value;
        document.getElementById('chat-input-container-text-input').value = "";

        if(base64_picture_string_to_send.length > 0 && chat_message_to_send_value.length > 0)
        {
            return;
        }

        let chat_context_index = get_chat_context_index_by_chat_context_id(current_chat_context_id);

        if(chat_context_index == -1)
        {
            log("could not find " + current_chat_context_id.toString());
            return;
        }

        let receiver_public_key = get_public_key_by_user_id(chat_message_receiver_id);

        if(receiver_public_key == "")
        {
            log("public key not found ");
            return;
        }

        if(base64_picture_string_to_send.length > 0)
        {
            let message_keys = [];

            for(let i = 0; i < 4; i++)
            {
                let single_key = {
                    key_string : null,
                    key_bytes : null,
                    iv_bytes : null
                };

                single_key.key_string = just.randomstring(16);
                let hash = sha256.create();
                hash.update(single_key.key_string);
                hash.array();
                key_bytes = hash.array();
                single_key.key_bytes = key_bytes;
                let iv_string = just.randomstring(16);
                let hash1 = sha256.create();
                hash1.update(iv_string);
                hash1.array();
                iv_bytes = hash1.array();
                iv_bytes.splice(0,16);
                single_key.iv_bytes = iv_bytes;
                message_keys.push(single_key);
            }

            let single_message_aes_keys_string = JSON.stringify(message_keys);
            let encryption_result = cryptico.encrypt(single_message_aes_keys_string, receiver_public_key);

            let message_data = {
                message_keys : encryption_result.cipher,
                message_value : ""
            };

            message_data.message_value = encrypt_with_aes_keys_and_convert_to_base64(message_keys, base64_picture_string_to_send);
            let element_count = document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer').length;

            for(let i = 0; i < element_count; i++)
            {
                let element_count = document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer')[0].remove();
            }

            let html_to_append = "<div class=\"single-chat-message\">\n\
                                    <div class=\"single-message-content\">\n\
                                        <div class=\"single-chat-message-sender-local-username-container\">\n\
                                            <p>"+ local_username +"</p>\n\
                                        </div>\n\
                                        <div class=\"single-chat-message-sender-time\">\n\
                                            <p>"+ new Date().toLocaleTimeString() +"</p>\n\
                                            </div>\n\
                                            <div class=\"single-chat-message-content\">\n\
                                            <img src="+ base64_picture_string_to_send +" style=\"max-width: 500px;\"></img>\n\
                                            </div>\n\
                                        </div>\n\
                                    </div>";

            document.getElementById(current_chat_context_id).innerHTML += html_to_append;
            document.getElementById(current_chat_context_id).innerHTML += "<div class=\"chat-spacer\"></div>";
            document.getElementById("chat-context-container").scrollTop = document.getElementById("chat-context-container").scrollHeight;

            let message_object = {
                "message" : {
                  "type" : null,
                  "value" : null,
                  "receiver_type" : null,
                  "receiver_id" : null
                }
            };

            message_object.message.type = "client_chat_picture";
            message_object.message.value = JSON.stringify(message_data);
            message_object.message.receiver_type = "user";
            message_object.message.receiver_id = chat_message_receiver_id;
            let message_json_string = JSON.stringify(message_object);
            let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

            if(socket.readyState === 1)
            {
                socket.send(data);
            }

            base64_picture_string_to_send = "";
            document.getElementById('image-upload-preview').style.backgroundImage = "";
            chat_context_array[chat_context_index].last_known_message_sender_username = local_username;
        }
        else if(chat_message_to_send_value.length > 0)
        {
            let message_keys = [];

            for(let i = 0; i < 4; i++)
            {
                let single_key = {
                    key_string : null,
                    key_bytes : null,
                    iv_bytes : null
                };

                single_key.key_string = just.randomstring(16);
                let hash = sha256.create();
                hash.update(single_key.key_string);
                key_bytes = hash.array();
                single_key.key_bytes = key_bytes;
                let iv_string = just.randomstring(16);
                let hash1 = sha256.create();
                hash1.update(iv_string);
                iv_bytes = hash1.array();
                iv_bytes.splice(0,16);
                single_key.iv_bytes = iv_bytes;
                message_keys.push(single_key);
            }

            let single_message_aes_keys_string = JSON.stringify(message_keys);
            let encryption_result = cryptico.encrypt(single_message_aes_keys_string, receiver_public_key);

            let message_data = {
                message_keys : encryption_result.cipher,
                message_value : ""
            };

            let message_value_object = {
                type : "direct_chat_message",
                value : chat_message_to_send_value
            };

            message_data.message_value = encrypt_with_aes_keys_and_convert_to_base64(message_keys, JSON.stringify(message_value_object));

            if(chat_context_array[chat_context_index].last_known_message_sender_username == local_username)
            {
                let chat_message = "<p>" + sanitize_string(chat_message_to_send_value) + "</p>";
                let last_child_index = document.getElementById(current_chat_context_id).getElementsByClassName("single-chat-message").length - 1;
                document.getElementById(current_chat_context_id).getElementsByClassName("single-chat-message")[last_child_index].getElementsByClassName("single-chat-message-content")[0].innerHTML += chat_message;
            }
            else
            {
                let html_to_append = "<div class=\"single-chat-message\">\n\
                                        <div class=\"single-message-content\">\n\
                                            <div class=\"single-chat-message-sender-local-username-container\">\n\
                                                <p>"+ local_username +"</p>\n\
                                            </div>\n\
                                            <div class=\"single-chat-message-sender-time\">\n\
                                                <p>"+ new Date().toLocaleTimeString() +"</p>\n\
                                            </div>\n\
                                            <div class=\"single-chat-message-content\">\n\
                                                <p>"+ sanitize_string(chat_message_to_send_value) +"</p>\n\
                                            </div>\n\
                                        </div>\n\
                                    </div>";

                document.getElementById(current_chat_context_id).innerHTML += html_to_append;
                let element_count = document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer').length;

                for(let i = 0; i < element_count; i++)
                {
                    document.getElementById(current_chat_context_id).getElementsByClassName('chat-spacer')[0].remove();
                }

                html_to_append = "<div class=\"chat-spacer\"></div>";
                document.getElementById(current_chat_context_id).innerHTML += html_to_append;
            }

            document.getElementById("chat-context-container").scrollTop = document.getElementById("chat-context-container").scrollHeight;

            let message_object = {
                "message" : {
                  "type" : null,
                  "value" : null,
                  "receiver_type" : null,
                  "receiver_id" : null
                }
            };

            message_object.message.type = "client_chat_message";
            message_object.message.value = JSON.stringify(message_data);
            message_object.message.receiver_type = "user";
            message_object.message.receiver_id = chat_message_receiver_id;
            let message_json_string = JSON.stringify(message_object);
            var data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

            if(socket.readyState === 1)
            {
                socket.send(data);
            }

            chat_context_array[chat_context_index].last_known_message_sender_username = local_username;
        }
    }

    function send_chat_message(socket)
    {
        if(chat_message_receiver_type == "channel")
        {
            if(current_channel_keys == null)
            {
                console.log("cant sent, dont have channel keys");
                return;
            }
            send_channel_chat_message();
        }
        else if (chat_message_receiver_type == "user")
        {
            send_direct_chat_message();
        }
    }

    function connected_local_user_input_on_focusout()
    {
        console.log("on focus out");
        let new_username = this.value;

        if(new_username.length == 0)
        {
            return;
        }

        let message_object = {"message" :
            {
                "type" : "change_client_username",
                "new_username" : new_username
            }
        };

        console.log(message_object);

        let index = get_user_index_by_username(local_username);
        users[index].username = new_username;
        local_username = new_username;
        document.getElementById('connected-local-user-input').setAttribute('value',local_username);
        let message_json_string = JSON.stringify(message_object);
        let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

        if(socket.readyState === 1)
        {
            socket.send(data);
        }
    }

    function get_user_index_by_user_id(user_id)
    {
        let result = -1;
        for(let i = 0; i < users.length; i++)
        {
            if(users[i].user_id == user_id)
            {
                result = i;
                return result;
            }
        }
    }

    function get_username_by_user_id(user_id)
    {
        let result = "";
        for(let i = 0; i < users.length; i++)
        {
            if(users[i].user_id == user_id)
            {
                result = users[i].username;
                return result;
            }
        }
    }

    function get_public_key_by_user_id(user_id)
    {
        let result = "";
        for(let i = 0; i < users.length; i++)
        {
            if(users[i].user_id == user_id)
            {
                result = users[i].public_key;
                return result;
            }
        }
    }

    function onmessage_socket(s)
    {
        decrypted_metadata = decrypt_message_metadata(s.data);

        if(!is_authenticated)
        {
            if (decrypted_metadata == 'auth_ok')
            {
                if(!is_connection_check_thread_running)
                {
                    check_connection(socket);
                    is_connection_check_thread_running = true;
                }
                is_authenticated = true;
                document.getElementById('verification-system').style.display = "none";
                document.getElementById('communication-system-container').style.display = "block";
            }
            else
            {
                window.alert('authentication failed');
            }
        }
        else
        {
            if(decrypted_metadata == "test")
            {
                return;
            }
            let msg = JSON.parse(decrypted_metadata);

            //console.log(msg);

            log('msg.message.type : ' + msg.message.type + ' | size in bytes: ' + decrypted_metadata.length);
            if(msg.message.type == "client_list")
            {
                if(is_client_list_retrieved == true)
                {
                    log("client_list received more than once. Server is doing something weird");
                    return;
                }

                is_client_list_retrieved = true;

                for(let i = 0; i < msg.message.clients.length; i++)
                {
                    let username = sanitize_string(msg.message.clients[i].username);
                    let user_id = msg.message.clients[i].user_id;
                    let indend_level = get_indend_level(msg.message.clients[i].channel_id, channel_list) + 1;
                    var html_to_append = "";

                    if(username != sanitize_string(msg.message.local_username))
                    {
                        html_to_append = "<div class=\"connected-user\" data-connected-user-id=\""+user_id+"\">\n\
                                              <p style=\"padding-left: " + indend_level * 20 + "px;\"class=\"connected-user-p\">" + username + "</p>\n\
                                              <p class=\"connected-user-p-received-messages-number\">0</p>\n\
                                         </div>";
                    }
                    else
                    {
                        local_username = sanitize_string(msg.message.local_username);
                        local_user_id = msg.message.clients[i].user_id;
                        html_to_append = "<div class=\"connected-local-user\">\n\
                                              <input style=\"padding-left: " + indend_level * 20 + "px;\" maxlength=\"40\" id=\"connected-local-user-input\" value=\"" + username + "\">\n\
                                          </div>";
                    }

                    document.querySelector('[data-channel-id="'+msg.message.clients[i].channel_id+'"]').insertAdjacentHTML("afterend",html_to_append);

                    let single_user = {
                       user_id : null,
                       username : null,
                       public_key : null,
                       channel_id : null
                    };

                    single_user.user_id = parseInt(user_id);
                    single_user.username = username;
                    single_user.public_key = msg.message.clients[i].public_key;
                    single_user.channel_id = msg.message.clients[i].channel_id;

                    users.push(single_user);
                }

                for(let x = 0; x < chat_context_array.length; x++)
                {
                    if(chat_context_array[x].type == "user")
                    {
                        for(let y = 0; y < msg.message.clients.length; y++)
                        {
                            if(chat_context_array[x].chat_context_id == "chat-context-pm-"+msg.message.clients[y].id)
                            {
                                break;
                            }
                            else
                            {
                                if(y + 1 == msg.message.clients.length)
                                {
                                    log("chat context with id " + chat_context_array[x].chat_context_id.toString() + " NOT FOUND");
                                    document.getElementByid(chat_context_array[x].chat_context_id).remove();
                                }
                            }
                        }
                    }
                }

                let elements = document.getElementsByClassName('connected-user');
                for(let i = 0; i < elements.length; i++)
                {
                    elements[i].onclick = connected_user_onclick;
                    elements[i].style.backgroundColor = "";
                }
                document.getElementById('connected-local-user-input').addEventListener("focusout", connected_local_user_input_on_focusout);

            }
            else if(msg.message.type == "channel_list")
            {
                //console.log("received channel list");
                if(is_channel_list_retrieved == true)
                {
                    log("channel_list message received more than once. Server is doing something weird");
                    return;
                }

                is_channel_list_retrieved = true;
                document.getElementById("channel-list-container").innerHTML = "";
                var root_channels = get_channels_by_channel_parent_id(msg.message.channels, -1);

                let processed_channels = [];
                let current_parent_channel_id_to_find = -1;
                let previous_parent_channel_id_to_find = -1;

                while(processed_channels.length != msg.message.channels.length)
                {
                    if(current_parent_channel_id_to_find == previous_parent_channel_id_to_find)
                    {
                        current_parent_channel_id_to_find = -1;
                    }
                    previous_parent_channel_id_to_find = current_parent_channel_id_to_find;

                    var child_channels = get_channels_by_channel_parent_id(msg.message.channels,current_parent_channel_id_to_find);

                    for(let a = 0; a < child_channels.length; a++)
                    {
                        //
                        //first, check if current child channel is present in HTML. That is done by checking its presence in channel_list array.
                        //if not, add current channel to channel_list and append channel to HTML
                        //


                        let is_channel_added_to_html = get_channel_by_id(channel_list,child_channels[a].channel_id);

                        if(is_channel_added_to_html == null)
                        {
                            channel_list.push(child_channels[a]);

                            let intend_level = get_indend_level(child_channels[a].channel_id, msg.message.channels);

                            let html_to_append = "";

                            if(child_channels[a].is_using_password == true)
                            {
                                html_to_append = "<div class=\"single-channel\" data-channel-id=\""+child_channels[a].channel_id+"\" data-channel-parent-id=\""+child_channels[a].parent_channel_id+"\">\n\
                                                       <p data-channel-name-id=\""+child_channels[a].channel_id+"\" style=\"padding-left: "+intend_level * 20 +"px; background-position-x: "+(intend_level - 1) * 20 +"px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAgJJREFUWIXtlbFPFEEUxr/3ZoE1hBx4B7ESE0NhgY12dP4PkiNia6ExGiOxgVyIKLGwMAQKKwPEmCD/AJWdEToLExMLrwMvyCFCDt15zwL3uKi7N+fuZRPjV83uvPd9v5nMzgL/lbGo5Y7LavLnbJFhxwS4yEABwBdVbBCZ5cqmeYGn9L0tAIXJ2pDCvGTG+agaEbwF7Oj2jP8+VYDCZG0ITK8JnG9Wq5BtFR1xgWCn9JJ6ymY1DBeRA1WdIgrOVsjrMNacUdUpETkAAALnwWYF17SjmbXnkj9gbVEZw2G4R3Rp637nm3B+EygDmDlZ+rYmKq8YfIKB4f5TtlgBluK8nXZAyY6FYyKabQxv1OfpznUCzdb71I4383YCEMKFegPb53G1xtrl+kNDXyIABgbC8ad3fjmuduuB//E4v/mBdTuE4OOvZYVsfC2pm2dLAO1T5gCRF9FgSf19DR4T5ArAub+PkD1VXuxm7255mmq/zkbeA0fhuJ58k7iHCDf2NVAAN3+bjWo7Wnl6IsjVP72PWV6SbXf3y/wQJgJQ6J3cjvGhOpEJQO+Ot/Bhjg+7vnrzmQDs9ga3AOCwJ7idCQCIHv0cPMwGIAUlBugr6elMATwNYn/PbQdIqhgA2Us3SnZbAhDlZ6nmR/hFAvRVzYQo5qLInSVSheJJrmruJfL5Z/UDfaOsxxIePTcAAAAASUVORK5CYII=); background-repeat: no-repeat; background-size: 20px 18px; \">"+child_channels[a].name+"</p>\n\
                                                  </div>";
                            }
                            else
                            {
                                html_to_append = "<div class=\"single-channel\" data-channel-id=\""+child_channels[a].channel_id+"\" data-channel-parent-id=\""+child_channels[a].parent_channel_id+"\">\n\
                                                       <p data-channel-name-id=\""+child_channels[a].channel_id+"\" style=\"padding-left: "+intend_level * 20 +"px;\">"+child_channels[a].name+"</p>\n\
                                                  </div>";
                            }
                            document.getElementById("channel-list-container").innerHTML += html_to_append;
                        }

                        //console.log("child_channels[a].channel_id " + child_channels[a].channel_id);

                        //
                        //next, check if channel is already processed. If it is, check if for loop is at its end.
                        //If for loop is at its end, and current channel is processed, that means all child channels of a parent channel were processed and that they have no more inner child channels in them
                        //

                        let is_channel_already_processed = processed_channels.indexOf(child_channels[a].channel_id) != -1;

                        if(is_channel_already_processed == true)
                        {
                            //console.log("channel -> " + child_channels[a].name + " already processed");
                            if((a + 1) == child_channels.length)
                            {
                                if(current_parent_channel_id_to_find == -1)
                                {
                                    continue;
                                }
                                //console.log("added parent channel " + get_channel_by_id(msg.message.channels,current_parent_channel_id_to_find).name + " to  processed_channels" + processed_channels);

                                //
                                //all child channels in parent channel are processed.\
                                //add parent channel of child channels in this loop to processed_channels
                                //

                                processed_channels.push(current_parent_channel_id_to_find);
                            }
                        }
                        else
                        {
                            //
                            //if channel is not processed, find out if the current channel in loop has any children. If it has, change current_parent_channel_id_to_find
                            //if not, push channel to processed_channel list
                            //

                            var children_of_child_channel = get_channels_by_channel_parent_id(msg.message.channels, child_channels[a].channel_id);
                            if(children_of_child_channel.length > 0)
                            {
                                //console.log("channel -> " + child_channels[a].name + " has children");
                                current_parent_channel_id_to_find = child_channels[a].channel_id;
                                break;
                            }

                            processed_channels.push(child_channels[a].channel_id);
                            //console.log("added channel " + get_channel_by_id(msg.message.channels,child_channels[a].channel_id).name + " to processed_channels");
                        }
                    }
                }

                let elements = document.getElementsByClassName('single-channel');

                for(let i = 0; i < elements.length; i++)
                {
                    elements[i].addEventListener("mousedown", single_channel_onmousedown);
                }
            }
            else if(msg.message.type == "channel_join")
            {
                let username = get_username_by_user_id(msg.message.user_id);
                users[get_user_index_by_user_id(msg.message.user_id)].channel_id = msg.message.channel_id;

                if(msg.message.user_id == local_user_id)
                {
                    document.getElementsByClassName("connected-local-user")[0].remove();
                    let indend_level = get_indend_level(msg.message.channel_id, channel_list) + 1;

                    let html_to_append = "<div class=\"connected-local-user\">\n\
                                            <input style=\"padding-left: " + indend_level * 20 + "px;\" maxlength=\"40\" id=\"connected-local-user-input\" value=\"" + username + "\">\n\
                                          </div>";

                    document.querySelector('[data-channel-id="'+msg.message.channel_id+'"]').insertAdjacentHTML("afterend",html_to_append);
                    document.getElementById('connected-local-user-input').addEventListener("focusout", connected_local_user_input_on_focusout);

                    current_channel_id = msg.message.channel_id;
                    current_channel_keys = null;
                    console.log("local_user joined new channel, nulling out current_channel_keys");
                }
                else
                {
                    document.querySelector('[data-connected-user-id="'+msg.message.user_id+'"]').remove();
                    let indend_level = get_indend_level(msg.message.channel_id, channel_list) + 1;

                    let html_to_append = "<div class=\"connected-user\" data-connected-user-id=\""+msg.message.user_id+"\">\n\
                                            <p style=\"padding-left: " + indend_level * 20 + "px;\"class=\"connected-user-p\">" + username + "</p>\n\
                                            <p class=\"connected-user-p-received-messages-number\">0</p>\n\
                                          </div>";

                    document.querySelector('[data-channel-id="'+msg.message.channel_id+'"]').insertAdjacentHTML("afterend",html_to_append);

                    if(msg.message.channel_id == current_channel_id)
                    {
                        console.log("user '"+username+"' joined current_channel where local_user is. setting current_channel_keys to null");
                        current_channel_keys = null;
                        let channel_index = get_channel_index_by_channel_id(channel_list, current_channel_id);
                        if(channel_list[channel_index].maintainer_id == local_user_id)
                        {
                            console.log("local_user is the maintainer of current_channel. create_and_send_new_channel_keys()");
                            create_and_send_new_channel_keys();
                        }
                        else
                        {
                            console.log("local user is not maintainer of current channel. Waiting for new keys");
                        }
                    }
                }

                let elements = document.getElementsByClassName('connected-user');

                for(let i = 0; i < elements.length; i++)
                {
                    elements[i].onclick = connected_user_onclick;
                }
            }
            else if(msg.message.type == "client_rename")
            {
                let user_index = get_user_index_by_user_id(parseInt(msg.message.user_id));
                if(user_index == -1)
                {
                    return;
                }
                log(users[user_index].username + ' renamed to -> ' + msg.message.new_username);
                users[user_index].username = msg.message.new_username;
                document.querySelector('[data-connected-user-id="'+msg.message.user_id+'"]').getElementsByClassName("connected-user-p")[0].innerHTML = msg.message.new_username;
                let is_found = document.querySelector('[data-chat-context-selector-id="user-'+msg.message.user_id+'"]');
                if(is_found != null)
                {
                    document.querySelector('[data-chat-context-selector-id="user-'+msg.message.user_id+'"]').getElementsByClassName("p-container")[0].innerHTML = msg.message.new_username;
                }
            }
            else if(msg.message.type == "client_connect")
            {
                let username = sanitize_string(msg.message.username);
                let user_id = sanitize_string(msg.message.user_id);
                let indend_level = get_indend_level(msg.message.channel_id, channel_list) + 1;
                let html_to_append = "<div class=\"connected-user\" data-connected-user-id=\""+user_id+"\">\n\
                                          <p style=\"padding-left: " + indend_level * 20 + "px;\"class=\"connected-user-p\">" + username + "</p>\n\
                                          <p class=\"connected-user-p-received-messages-number\">0</p>\n\
                                     </div>";

                document.querySelector('[data-channel-id="'+ msg.message.channel_id +'"]').insertAdjacentHTML("afterend",html_to_append);

                let single_user = {
                   user_id : null,
                   username : null,
                   public_key : null,
                   channel_id : null
                };

                single_user.user_id = parseInt(user_id);
                single_user.username = username;
                single_user.public_key = msg.message.public_key;
                single_user.channel_id = msg.message.channel_id;

                users.push(single_user);

                let elements = document.getElementsByClassName('connected-user');

                for(let i = 0; i < elements.length; i++)
                {
                    elements[i].onclick = connected_user_onclick;
                    //elements[i].style.backgroundColor = "";
                }

                //
                //html got re-written, assign event handler to html element again
                //used addEventListener("focusout",function), object.onfocusout = function() did not work in chrome
                //

                document.getElementById('connected-local-user-input').addEventListener("focusout", connected_local_user_input_on_focusout);

                //
                //if local_user is maintainer of root channel, he will sent new keys for root channel
                //if not, client will wait for keys for root channel
                //current_channel_keys must be nulled if current channel id is 1 (root channel) where new users join
                //xxkasdasd

                if(current_channel_id == 1)
                {
                    current_channel_keys = null;
                    console.log("setting current keys to null")
                }

                let index = get_channel_index_by_channel_id(channel_list, current_channel_id);
                if(channel_list[index].maintainer_id == local_user_id)
                {
                    create_and_send_new_channel_keys();
                }
                else
                {
                    console.log("waiting for keys from maintainer");
                }
            }
            else if(msg.message.type == "client_disconnect")
            {
                if(document.querySelector('.connected-user[data-connected-user-id="'+msg.message.user_id+'"]') != null)
                {
                    document.querySelector('.connected-user[data-connected-user-id="'+msg.message.user_id+'"]').remove();
                }

                if(document.getElementById('chat-context-pm-'+msg.message.user_id) != null)
                {
                   document.getElementById('chat-context-pm-'+msg.message.user_id).remove();
                }

                let chat_context_index_to_remove = get_chat_context_index_by_chat_context_id("chat-context-pm-"+msg.message.user_id);

                if(chat_context_index_to_remove != -1)
                {
                    chat_context_array.splice(chat_context_index_to_remove, 1);
                }

                //if used chat context was deleted one, switch to current channel
                if(current_chat_context_id == "chat-context-pm-"+msg.message.user_id)
                {
                    console.log("switching to main channel? ");
                    current_chat_context_id = "chat-context-channel-" + current_channel_id;
                    document.getElementById("chat-context-channel-" + current_channel_id).style.display = "block";
                    chat_message_receiver_type = "channel";
                }

                let user_index_to_remove = get_user_index_by_user_id(parseInt(msg.message.user_id));
                users.splice(user_index_to_remove, 1);
            }
            else if(msg.message.type == "chat_picture_accepted")
            {
            }
            else if(msg.message.type == "channel_chat_message")
            {
                if(msg.message.sender_username == local_username)
                {
                    return;
                }

                let chat_message_username = sanitize_string(msg.message.sender_username);
                let receiving_chat_context_id = "chat-context-channel-" + msg.message.channel_id;
                let chat_context_index = get_chat_context_index_by_chat_context_id(receiving_chat_context_id);
                let decrypted_value = decrypt_with_aes_keys(current_channel_keys, msg.message.value);
                let sanitized_value = sanitize_string(decrypted_value);

                if(chat_context_array[chat_context_index].last_known_message_sender_username == chat_message_username)
                {
                    let chat_message = "<p>" + sanitized_value + "</p>";
                    let last_child_index = document.getElementById(receiving_chat_context_id).getElementsByClassName("single-chat-message").length - 1;
                    document.getElementById(receiving_chat_context_id).getElementsByClassName("single-chat-message")[last_child_index].getElementsByClassName("single-chat-message-content")[0].innerHTML += chat_message;
                }
                else
                {
                    let html_to_append = "<div class=\"single-chat-message\">\n\
                                            <div class=\"single-message-content\">\n\
                                                <div class=\"single-chat-message-sender-username-container\">\n\
                                                    <p>"+ chat_message_username +"</p>\n\
                                                </div>\n\
                                                <div class=\"single-chat-message-sender-time\">\n\
                                                    <p>"+ new Date().toLocaleTimeString() +"</p>\n\
                                                </div>\n\
                                                <div class=\"single-chat-message-content\">\n\
                                                    <p>"+ sanitized_value +"</p>\n\
                                                </div>\n\
                                            </div>\n\
                                        </div>";

                    let elements_count = document.getElementById(receiving_chat_context_id).getElementsByClassName("chat-spacer").length;

                    for(let i = 0; i < elements_count; i++)
                    {
                        document.getElementById(receiving_chat_context_id).getElementsByClassName("chat-spacer")[0].remove();
                    }

                    document.getElementById(receiving_chat_context_id).innerHTML += html_to_append;
                }

                document.getElementById("chat-context-container").scrollTop = document.getElementById("chat-context-container").scrollHeight;

                if(local_username == chat_message_username)
                {
                    document.getElementById("chat-input-container-text-input").value = "";
                }

                chat_context_array[chat_context_index].last_known_message_sender_username = chat_message_username;
            }
            else if(msg.message.type == "channel_chat_picture")
            {
                let decrypted_base64 = decrypt_with_aes_keys(current_channel_keys, msg.message.value);
                document.getElementById("chat-picture-img-"+msg.message.picture_id).src = decrypted_base64;

            }
            else if(msg.message.type == "server_info_broadcast")
            {
                let chat_context_index = get_chat_context_index_by_chat_context_id("chat-context-channel-1");
                chat_context_array[chat_context_index].last_known_message_sender_username = "";
                let html_to_append = "<div class=\"single-server-message\">" + sanitize_string(msg.message.value) + " " + new Date().toLocaleTimeString() + "</div>";
                document.getElementById("chat-context-channel-1").innerHTML += html_to_append;
                let elements_count = document.getElementsByClassName("chat-spacer").length;

                for(let i = 0; i < elements_count; i++)
                {
                    document.getElementsByClassName("chat-spacer")[0].remove();
                }

                let html_to_append1 = "<div class=\"chat-spacer\"></div>";
                document.getElementById("chat-context-channel-1").innerHTML += html_to_append1;
                document.getElementById("chat-context-container").scrollTop = document.getElementById("chat-context-container").scrollHeight;
            }
            else if(msg.message.type == "channel_chat_picture_metadata")
            {
                let username_message_sender = sanitize_string(msg.message.username);
                let chat_context_index = get_chat_context_index_by_chat_context_id("chat-context-channel-" + current_channel_id);

                chat_context_array[chat_context_index].last_known_message_sender_username = username_message_sender;

                let elements_count = document.getElementsByClassName('chat-spacer').length;

                for(let i = 0; i < elements_count; i++)
                {
                    document.getElementsByClassName('chat-spacer')[0].remove();
                }

                let html_to_append = "<div class=\"single-chat-message\">\n\
                                        <div class=\"single-message-content\">\n\
                                            <div class=\"single-chat-message-sender-username-container\">\n\
                                                <p>"+ username_message_sender +"</p>\n\
                                            </div>\n\
                                        <div class=\"single-chat-message-sender-time\">\n\
                                            <p>"+ new Date().toLocaleTimeString() +"</p>\n\
                                        </div>\n\
                                        <div class=\"single-chat-message-content\">\n\
                                            <img class=\"chat-picture-img\" id=\"chat-picture-img-"+msg.message.picture_id+"\" src=\""+ loading_gif + "\" style=\"max-width: 500px;\"></img>\n\
                                        </div>\n\
                                     </div>";

                document.getElementById("chat-context-channel-" + current_channel_id).innerHTML += html_to_append;
                document.getElementById("chat-context-channel-" + current_channel_id).innerHTML += "<div class=\"chat-spacer\"></div>";;
                document.getElementById("chat-context-container").scrollTop = document.getElementById("chat-context-container").scrollHeight;
            }
            else if(msg.message.type == "direct_chat_message")
            {
                let message_data = JSON.parse(msg.message.value);
                let decryption_result = cryptico.decrypt(message_data.message_keys, my_rsa_key_object);

                if(decryption_result.status == 'failure')
                {
                    log('failed to decrypt message');
                    return;
                }

                message_keys = JSON.parse(decryption_result.plaintext);
                let decrypted_text = decrypt_with_aes_keys(message_keys,message_data.message_value);
                let some_json = JSON.parse(decrypted_text);
                if(some_json.type == "direct_chat_message")
                {
                    decrypted_text = sanitize_string(some_json.value);
                    log(msg.message.sender_username + ' -> '+ decrypted_text);
                    let received_direct_message_chat_context_id = "chat-context-pm-"+msg.message.sender_id;
                    let is_found = document.getElementById("chat-context-pm-"+msg.message.sender_id);

                    if(is_found == null)
                    {
                        let html_to_append = "<div class=\"chat-context\" id=\""+received_direct_message_chat_context_id+"\">\n\
                                                <div class=\"single-server-message\">now talking to user:  " + msg.message.sender_username+"</div>\n\
                                                <div class=\"single-server-message\">your public key: "+rsa_public_key_string+"</div>\n\
                                                <div class=\"single-server-message\">his public key: "+get_public_key_by_user_id(msg.message.sender_id)+"</div>\n\
                                                <div class=\"single-server-message\">always verify if other users sees same keys. If noth, somebody else is listening. If they match, chat is E2EE </div>\n\
                                             </div>";

                        document.getElementById('chat-context-container').innerHTML += html_to_append;
                        document.getElementById(received_direct_message_chat_context_id).style.display = "none";

                        let single_chat_context = {
                            "type":"user",
                            "chat_context_id": received_direct_message_chat_context_id,
                            "last_known_message_sender_username" : ""
                        };

                        chat_context_array.push(single_chat_context);
                    }

                    let chat_context_index = get_chat_context_index_by_chat_context_id(received_direct_message_chat_context_id);

                    if(chat_context_array[chat_context_index].last_known_message_sender_username == msg.message.sender_username)
                    {
                        let chat_message = "<p>" + decrypted_text + "</p>";
                        let last_child_index = document.getElementById(received_direct_message_chat_context_id).getElementsByClassName("single-chat-message").length - 1;
                        let exists = document.getElementById(received_direct_message_chat_context_id).getElementsByClassName("single-chat-message") != "undefined";
                        document.getElementById(received_direct_message_chat_context_id).getElementsByClassName("single-chat-message")[last_child_index].getElementsByClassName("single-chat-message-content")[0].innerHTML += chat_message;
                        document.querySelector('[data-connected-user-id="'+msg.message.sender_id+'"]').getElementsByClassName("connected-user-p-received-messages-number")[0].style.display = "none";
                    }
                    else
                    {
                        let html_to_append = "<div class=\"single-chat-message\">\n\
                                                <div class=\"single-message-content\">\n\
                                                    <div class=\"single-chat-message-sender-username-container\">\n\
                                                        <p>"+ msg.message.sender_username +"</p>\n\
                                                    </div>\n\
                                                    <div class=\"single-chat-message-sender-time\">\n\
                                                        <p>"+  new Date().toLocaleTimeString() +"</p>\n\
                                                    </div>\n\
                                                    <div class=\"single-chat-message-content\"><p>"+ decrypted_text +"</p>\n\
                                                    </div>\n\
                                                </div>\n\
                                            </div>";

                        document.getElementById(received_direct_message_chat_context_id).innerHTML += html_to_append;
                        let elements_count = document.getElementsByClassName("chat-spacer").length;

                        for(let i = 0; i < elements_count; i++)
                        {
                            document.getElementsByClassName("chat-spacer")[0].remove();
                        }

                        let html_to_append1 = "<div class=\"chat-spacer\"></div>";
                        document.getElementById(received_direct_message_chat_context_id).innerHTML += html_to_append1;
                    }
                    if(current_chat_context_id != received_direct_message_chat_context_id)
                    {
                        document.querySelector('[data-connected-user-id="'+msg.message.sender_id+'"]').getElementsByClassName("connected-user-p-received-messages-number")[0].style.display = "inline-block";
                        let current_received_message_number_string = document.querySelector('[data-connected-user-id="'+msg.message.sender_id+'"]').getElementsByClassName("connected-user-p-received-messages-number")[0].innerHTML;
                        current_received_message_number = parseInt(current_received_message_number_string);
                        current_received_message_number += 1;
                        document.querySelector('[data-connected-user-id="'+msg.message.sender_id+'"]').getElementsByClassName("connected-user-p-received-messages-number")[0].innerHTML = current_received_message_number;
                    }
                    chat_context_array[chat_context_index].last_known_message_sender_username = msg.message.sender_username;
                }
                else if(some_json.type == "channel_keys_from_maintainer")
                {
                    let index = get_channel_index_by_channel_id(channel_list, current_channel_id);
                    if(channel_list[index].maintainer_id == msg.message.sender_id)
                    {
                        console.log("received keys for channel '" + channel_list[index].name + "' from user : '" + msg.message.sender_username + "'. Setting new value of current_channel_keys");
                        current_channel_keys = JSON.parse(some_json.value);
                        console.log("current_channel_keys -> ", current_channel_keys);
                    }
                    else
                    {
                        console.log("received keys for channel '" + channel_list[index].name + "' from user : '" + msg.message.sender_username + "' The user is not maintainer of current channel. Refusing to set keys");
                        console.log("channel_list[index].maintainer_id = " + channel_list[index].maintainer_id);
                        console.log("msg.message.sender_id = " + msg.message.sender_id);
                    }
                }
            }
            else if(msg.message.type == 'direct_chat_picture_metadata')
            {
                console.log("recevied message");
                let received_direct_message_chat_context_id = 'chat-context-pm-'+msg.message.sender_id;
                let is_found = document.getElementById(received_direct_message_chat_context_id);

                if(is_found == null)
                {
                    console.log("element not found");

                    let html_to_append = "<div class=\"chat-context\" id=\""+received_direct_message_chat_context_id+"\">\n\
                                            <div class=\"single-server-message\">now talking to user: " + msg.message.sender_username+"</div>\n\
                                                <div class=\"single-server-message\">your public key: "+rsa_public_key_string+"</div>\n\
                                                <div class=\"single-server-message\">his public key: "+get_public_key_by_user_id(msg.message.sender_id)+"</div>\n\
                                            <div class=\"single-server-message\">always verify if other users sees same keys. If they do not match, somebody else is listening. If they match, chat is E2EE </div>\n\
                                        </div>";

                    document.getElementById("chat-context-container").innerHTML += html_to_append;
                    document.getElementById(received_direct_message_chat_context_id).style.display = "none";

                    let single_chat_context = {
                        "type":"user",
                        "chat_context_id": received_direct_message_chat_context_id,
                        "last_known_message_sender_username" : ""
                    };

                    chat_context_array.push(single_chat_context);
                }

                let chat_context_index = get_chat_context_index_by_chat_context_id(received_direct_message_chat_context_id);
                let html_to_append = "<div class=\"single-chat-message\">\n\
                                        <div class=\"single-message-content\">\n\
                                            <div class=\"single-chat-message-sender-username-container\">\n\
                                                <p>"+ msg.message.sender_username +"</p>\n\
                                            </div>\n\
                                            <div class=\"single-chat-message-sender-time\"><p>"+ new Date().toLocaleTimeString() +"</p>\n\
                                            </div>\n\
                                            <div class=\"single-chat-message-content\">\n\
                                                <img class=\"chat-picture-img\" id=\"chat-picture-img-"+msg.message.picture_id+"\" src=\""+ loading_gif + "\" style=\"max-width: 500px;\"></img>\n\
                                            </div>\n\
                                        </div>\n\
                                     </div>";

                document.getElementById(received_direct_message_chat_context_id).innerHTML += html_to_append;
                let elements_count = document.getElementsByClassName("chat-spacer").length;

                for(let i = 0; i < elements_count; i++)
                {
                    document.getElementsByClassName("chat-spacer")[0].remove();
                }

                let html_to_append1 = "<div class=\"chat-spacer\"></div>";
                document.getElementById(received_direct_message_chat_context_id).innerHTML += html_to_append1;

                if(current_chat_context_id != received_direct_message_chat_context_id)
                {
                    document.querySelector('[data-connected-user-id="'+msg.message.sender_id+'"]').getElementsByClassName("connected-user-p-received-messages-number")[0].style.display = "inline-block";
                    let current_received_message_number_string = document.querySelector('[data-connected-user-id="'+msg.message.sender_id+'"]').getElementsByClassName("connected-user-p-received-messages-number")[0].innerHTML;
                    current_received_message_number = parseInt(current_received_message_number_string);
                    current_received_message_number += 1;
                    document.querySelector('[data-connected-user-id="'+msg.message.sender_id+'"]').getElementsByClassName("connected-user-p-received-messages-number")[0].innerHTML = current_received_message_number;
                }
                chat_context_array[chat_context_index].last_known_message_sender_username = msg.message.sender_username;
            }
            else if(msg.message.type == 'direct_chat_picture')
            {
                let message_data = JSON.parse(msg.message.value);
                let decryption_result = cryptico.decrypt(message_data.message_keys, my_rsa_key_object);

                if(decryption_result.status == 'failure')
                {
                    log('failed to decrypt direct_chat_picture with id' + msg.message.picture_id);
                    document.getElementById("chat-picture-img-"+msg.message.picture_id).src = "";
                    return;
                }

                message_keys = JSON.parse(decryption_result.plaintext);
                let decrypted_data = decrypt_with_aes_keys(message_keys,message_data.message_value);
                let picture_base64 = sanitize_string(decrypted_data);
                document.getElementById("chat-picture-img-"+msg.message.picture_id).src = picture_base64;
            }
            else if(msg.message.type == "channel_delete")
            {
                let channel_index = get_channel_index_by_channel_id(channel_list, msg.message.channel_id);
                if(channel_index != -1)
                {
                    channel_list.splice(channel_index, 1);
                    document.querySelector('[data-channel-id="'+msg.message.channel_id+'"]').remove();
                }
            }
            else if(msg.message.type == "channel_create")
            {
                let new_channel = {
                    "channel_id" : msg.message.channel_id,
                    "parent_channel_id" : msg.message.parent_channel_id,
                    "name" : msg.message.name,
                    "description" : msg.message.description,
                    "maintainer_id" : msg.message.maintainer_id
                };

                channel_list.push(new_channel);
                let intend_level = get_indend_level(new_channel.channel_id, channel_list);
                let html_to_append = "<div class=\"single-channel\" data-channel-id=\""+new_channel.channel_id+"\" data-channel-parent-id=\""+new_channel.parent_channel_id+"\">\n\
                                          <p data-channel-name-id=\""+new_channel.channel_id+"\" style=\"padding-left: "+intend_level * 20 +"px;\">"+new_channel.name+"</p>\n\
                                      </div>";

                document.querySelector("[data-channel-id='"+new_channel.parent_channel_id+"']").insertAdjacentHTML("afterend",html_to_append);
                let elements = document.getElementsByClassName('single-channel');

                for(let i = 0; i < elements.length; i++)
                {
                    elements[i].addEventListener("mousedown", single_channel_onmousedown);
                }
            }
            else if(msg.message.type == "channel_maintainer_id")
            {
                let index = get_channel_index_by_channel_id(channel_list, current_channel_id);
                channel_list[index].maintainer_id = msg.message.maintainer_id;
                if((local_user_id == msg.message.maintainer_id) && (current_channel_id == msg.message.channel_id))
                {
                    console.log("local user is maintainer of channel '" + channel_list[get_channel_index_by_channel_id(channel_list, msg.message.channel_id)].name + "'");
                    create_and_send_new_channel_keys();
                }
                else if((current_channel_id == msg.message.channel_id) && (local_user_id != msg.message.maintainer_id))
                {
                    console.log("channel_maintainer_id received: " + msg.message.maintainer_id);
                    console.log("local_user_id" + local_user_id);
                    console.log("msg.message.maintainer_id " + msg.message.maintainer_id);
                }
            }
        }
    }

    function create_and_send_new_channel_keys()
    {
        //lets create channel keys
        current_channel_keys = [];

        for(let i = 0; i < 4; i++)
        {
            let single_key = {
                key_string : null,
                key_bytes : null,
                iv_bytes : null
            };

            single_key.key_string = just.randomstring(16);
            let hash = sha256.create();
            hash.update(single_key.key_string);
            key_bytes = hash.array();
            single_key.key_bytes = key_bytes;
            let iv_string = just.randomstring(16);
            let hash1 = sha256.create();
            hash1.update(iv_string);
            iv_bytes = hash1.array();
            iv_bytes.splice(0,16);
            single_key.iv_bytes = iv_bytes;
            current_channel_keys.push(single_key);
        }


        console.log("current channel keys - > ", current_channel_keys);

        for(let i = 0; i < users.length; i++)
        {
            if(users[i].channel_id != current_channel_id)
            {
                continue;
            }
            if(users[i].user_id == local_user_id)
            {
                continue;
            }

            console.log(users[i]);

            let message_keys = [];

            for(let i = 0; i < 4; i++)
            {
                let single_key = {
                    key_string : null,
                    key_bytes : null,
                    iv_bytes : null
                };

                single_key.key_string = just.randomstring(16);
                let hash = sha256.create();
                hash.update(single_key.key_string);
                key_bytes = hash.array();
                single_key.key_bytes = key_bytes;
                let iv_string = just.randomstring(16);
                let hash1 = sha256.create();
                hash1.update(iv_string);
                iv_bytes = hash1.array();
                iv_bytes.splice(0,16);
                single_key.iv_bytes = iv_bytes;
                message_keys.push(single_key);
            }

            let single_message_aes_keys_string = JSON.stringify(message_keys);
            let encryption_result = cryptico.encrypt(single_message_aes_keys_string, users[i].public_key);

            let message_data = {
                message_keys : encryption_result.cipher,
                message_value : ""
            };

            let message_value_object = {
                type : "channel_keys_from_maintainer",
                value : JSON.stringify(current_channel_keys)
            };

            message_data.message_value = encrypt_with_aes_keys_and_convert_to_base64(message_keys, JSON.stringify(message_value_object));

            let message_object = {
                "message" : {
                  "type" : null,
                  "value" : null,
                  "receiver_type" : null,
                  "receiver_id" : null
                }
            };

            message_object.message.type = "client_chat_message";
            message_object.message.value = JSON.stringify(message_data);
            message_object.message.receiver_type = "user";
            message_object.message.receiver_id = users[i].user_id.toString();
            let message_json_string = JSON.stringify(message_object);
            var data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

            if(socket.readyState === 1)
            {
                console.log("sending key data to user -> " + users[i].username);
                socket.send(data);
            }
        }
    }

    function send_chat_input_on_click()
    {
        send_chat_message(socket);
    }

    function init_keys_object()
    {
        if(is_autoconnect_active == true)
        {
            for(let i = 0; i < autoconnect_details.keys.length; i++)
            {
                let key_string_value = autoconnect_details.keys[i];
                let hash = sha256.create();
                hash.update(key_string_value);
                hash.array();
                key_bytes = hash.array();

                let iv_bytes = [90,11,8,33,4,50,50,88,8,89,200,15,24,4,15,10];

                let single_key = {
                    info: "aes-ctr",
                    key_string: key_string_value,
                    key : key_bytes,
                    iv : iv_bytes
                };

                metadata_keys[i] = single_key;
            }
        }
        else
        {
            for(let i = 0; i < custom_key_count; i++)
            {
                let key_string_value = document.getElementById('input-key-'+i+'').value;
                let hash = sha256.create();
                hash.update(key_string_value);
                hash.array();
                key_bytes = hash.array();

                let iv_bytes = [90,11,8,33,4,50,50,88,8,89,200,15,24,4,15,10];

                let single_key = {
                    info: "aes-ctr",
                    key_string: key_string_value,
                    key : key_bytes,
                    iv : iv_bytes
                };

                metadata_keys[i] = single_key;
            }
        }
    }

    function connect_to_server()
    {
        if(is_rsa_key_generated == false)
        {
            log('rsa keypair not generated yet');
            return;
        }

        init_keys_object();

        if(socket_connected == false)
        {
            host = document.getElementById('input-ip-address').value;
            port = document.getElementById('input-port-number').value;

            if(is_autoconnect_active == true)
            {
                host = autoconnect_details.host;
                port = autoconnect_details.port;
            }

            try
            {
                socket = new WebSocket('ws://'+host+':'+port+'/');
            }
            catch(Exception)
            {
                log(Exception.toString());
                window.alert('connection failed');
                return;
            }
            socket.onmessage = onmessage_socket;

            let message_object = {
              "message" : {
                "type" : "public_key_info",
                "value" : rsa_public_key_string,
                "verification_string" : verification_message
              }
            };

            let message_json_string = JSON.stringify(message_object);
            let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);
            socket.onopen = () => socket.send(data);
        }
    }

    function add_key_button_on_click()
    {
        let generated_id_for_html_input = "input-key-";
        generated_id_for_html_input += custom_key_count;
        let html_to_append = '<div style="padding-top: 10px; padding-bottom: 10px;"><input type="text" disabled class="text-input-pretty" value="key '+custom_key_count+'"></div>';
        document.getElementById('connect-form-sub-container-1').innerHTML += html_to_append;
        let html_to_append2 = '<div style="padding-top: 10px; padding-bottom: 10px;"><input type="text" id="'+generated_id_for_html_input+'" data-id="'+custom_key_count+'" class="text-input-pretty" value=""></div>';
        document.getElementById('connect-form-sub-container-2').innerHTML += html_to_append2;
        document.getElementById("verification-system").scrollTop = document.getElementById("verification-system").scrollHeight;
        custom_key_count++;
     }

    function choose_image_input()
    {
        let fileInput = document.getElementById('choose_image_input');
        let files = fileInput.files;
        let allowedExtensions = ['png','jpg','jpeg','gif','jfif'];

        for (let x = 0; x < files.length; x++)
        {
            let file = files[x];
            let extension = file.name.split('.').pop().toLowerCase();
            let max_size = 2 * 1024 * 1024;

            if(file.size > max_size)
            {
                window.alert("image is too large. Max size: 2mb");
                return;
            }

            let index = allowedExtensions.indexOf(extension);

            if(index == -1)
            {
                window.alert('file extension : ' + extension + ' is not supported');
                return;
            }

            let reader = new FileReader();
            reader.onload = function (event)
            {
                document.getElementById('image-upload-preview').style.backgroundImage = 'url('+event.target.result+')';
                base64_picture_string_to_send = event.target.result;
            }
            reader.readAsDataURL(file); //invokes onload
        }
    }

    function chat_context_selector_onclick()
    {
        let id_to_find = "";
        let user_id = "";
        let channel_id = "";
        let selector_type = this.getAttribute("data-chat-context-selector-type");

        for(let i = 0; i < document.getElementsByClassName("chat-context-selector").length; i++)
        {
            document.getElementsByClassName("chat-context-selector")[i].style.backgroundColor = "";
        }

        this.style.backgroundColor = "#36393f";

        for(let i = 0; i < document.getElementsByClassName("chat-context").length; i++)
        {
            document.getElementsByClassName("chat-context")[i].style.display = "none";
        }

        if(selector_type == "user")
        {
            enable_inputs();
            id_to_find = "chat-context-pm-";
            user_id = this.getAttribute("data-chat-context-selector-id").split("user-")[1];
            id_to_find += user_id;

            document.getElementById(id_to_find).style.display = "block";
            document.querySelector('[data-connected-user-id="'+user_id+'"]').getElementsByClassName('connected-user-p-received-messages-number')[0].style.display = "none";
            document.querySelector('[data-connected-user-id="'+user_id+'"]').getElementsByClassName('connected-user-p-received-messages-number')[0].innerHTML = '0';

            current_chat_context_id = id_to_find;
            console.log("current_chat_context_id -> " , current_chat_context_id);

            chat_message_receiver_type = "user"; //from local user perspective
            chat_message_receiver_id = user_id; //from local user perspective

        }
        else if(selector_type == "channel")
        {
            id_to_find = "chat-context-channel-";
            channel_id = this.getAttribute("data-chat-context-selector-id").split("channel-")[1];
            id_to_find += channel_id;

            console.log("trying to find id - > ", id_to_find)
            chat_message_receiver_type = "channel"; //from local user perspective

            let is_found = document.getElementById(id_to_find);
            if(is_found)
            {
                document.getElementById(id_to_find).style.display = "block";
            }

            if(current_channel_id == channel_id)
            {
                enable_inputs();
                current_chat_context_id = id_to_find;
                console.log("changed current_chat_context_id to -> " + id_to_find);
            }
            else
            {
                disable_inputs();
            }
        }
    }

    function enable_inputs()
    {
        console.log("function disable_inputs()");
        document.getElementById("chat-input-container-text-input").disabled = false;
        document.getElementById("chat-input-container-send-chat-input").disabled = false;
        document.getElementById("choose_image_input").disabled = false;
    }

    function disable_inputs()
    {
        console.log("function enable_inputs()");
        document.getElementById("chat-input-container-text-input").disabled = true;
        document.getElementById("chat-input-container-send-chat-input").disabled = true;
        document.getElementById("choose_image_input").disabled = true;
    }

    function connected_user_onclick()
    {
        document.getElementById("current-channel-description").innerHTML = "";
        for(let i = 0; i < document.getElementsByClassName('connected-user').length; i++)
        {
            document.getElementsByClassName('connected-user')[i].style.backgroundColor = "";
        }

        for(let i = 0; i < document.getElementsByClassName("chat-context-selector").length; i++)
        {
            document.getElementsByClassName("chat-context-selector")[i].style.backgroundColor = "";
        }

        chat_message_receiver_type = "user";
        chat_message_receiver_id = this.getAttribute("data-connected-user-id");

        let user_id = this.getAttribute("data-connected-user-id");
        let data_username = get_username_by_user_id(chat_message_receiver_id);
        let id_to_find = "chat-context-pm-" + chat_message_receiver_id;
        current_chat_context_id = id_to_find;
        let is_found = document.getElementById(id_to_find);

        if(is_found == null)
        {
            //make all elements invisible
            for(let i = 0; i < document.getElementsByClassName("chat-context").length; i++)
            {
                document.getElementsByClassName("chat-context")[i].style.display = "none";
            }

            let html_to_append = "<div class=\"chat-context\" id=\""+id_to_find+"\">\n\
                                    <div class=\"single-server-message\">now talking to user: " +data_username+"</div>\n\
                                    <div class=\"single-server-message\">your public key: "+rsa_public_key_string+"</div>\n\
                                    <div class=\"single-server-message\">his public key: "+get_public_key_by_user_id(chat_message_receiver_id)+"</div>\n\
                                    <div class=\"single-server-message\">always verify if other users sees same keys.. If not, somebody else is listening. If they match, chat is E2EE </div>\n\
                                </div>";

            document.getElementById('chat-context-container').innerHTML += html_to_append;

            let single_chat_context = {
                "type":"user",
                "chat_context_id": current_chat_context_id,
                "last_known_message_sender_username" : ""
            };

            chat_context_array.push(single_chat_context);
        }
        else
        {
            for(let i = 0; i < document.getElementsByClassName("chat-context").length; i++)
            {
                document.getElementsByClassName("chat-context")[i].style.display = "none";
            }

            document.getElementById(id_to_find).style.display = "block";
            document.querySelector('[data-connected-user-id="'+user_id+'"]').getElementsByClassName('connected-user-p-received-messages-number')[0].style.display = "none";
            document.querySelector('[data-connected-user-id="'+user_id+'"]').getElementsByClassName('connected-user-p-received-messages-number')[0].innerHTML = '0';
        }
        is_found = document.querySelector('[data-chat-context-selector-id="user-'+user_id+'"]');

        if(is_found == null)
        {
            let to_append = "<div class=\"chat-context-selector\" data-chat-context-selector-type=\"user\" data-chat-context-selector-id=\"user-"+user_id+"\">\n\
                                <div class=\"p-container\">\n\
                                    <p>"+data_username+"</p>\n\
                                </div>\n\
                                <div class=\"remove-chat-context-selector\" data-chat-context-remove-selector-type=\"user\" data-chat-context-remove-selector-id=\"user-"+user_id+"\">\n\
                                </div>\n\
                            </div>";

            document.getElementById("chat-context-selectors-container").innerHTML += to_append;
        }

        for(let x = 0; x < document.getElementsByClassName("remove-chat-context-selector").length; x++)
        {
            document.getElementsByClassName("remove-chat-context-selector")[x].onclick = chat_context_remove_onclick;
        }

        for(let x = 0; x < document.getElementsByClassName("chat-context-selector").length; x++)
        {
            document.getElementsByClassName("chat-context-selector")[x].onclick = chat_context_selector_onclick;
        }

        document.querySelector('[data-chat-context-selector-id="user-'+user_id+'"]').style.backgroundColor = "#36393f";

    }

    function chat_context_remove_onclick(event)
    {
        event.stopPropagation();

        let selector_type = event.srcElement.getAttribute("data-chat-context-remove-selector-type");

        if(selector_type == "user")
        {
            let selector_id = this.getAttribute("data-chat-context-remove-selector-id");
            let user_id = selector_id.split("user-")[1];
            document.querySelector('[data-chat-context-selector-id="'+selector_id+'"]').remove();
            document.getElementById("chat-context-pm-"+user_id).remove();

            let chat_context_index_to_remove = get_chat_context_index_by_chat_context_id("chat-context-pm-"+user_id);

            if(chat_context_index_to_remove != -1)
            {
                chat_context_array.splice(chat_context_index_to_remove, 1);
            }

            document.getElementById("chat-context-channel-"+current_channel_id).style.display = "block";
            current_chat_context_id = "chat-context-channel-"+current_channel_id;
            chat_message_receiver_type = "channel";

            for(let i = 0; i < document.getElementsByClassName("chat-context-selector").length; i++)
            {
                document.getElementsByClassName("chat-context-selector")[i].style.backgroundColor = "";
            }

            document.querySelector('[data-chat-context-selector-id="channel-'+current_channel_id+'"]').style.backgroundColor = "#36393f";


        }
        else if(selector_type == "channel")
        {
            //cannot remove current channel

            let selector_id = this.getAttribute("data-chat-context-remove-selector-id");
            let channel_id = selector_id.split("channel-")[1];

            if(current_channel_id == channel_id)
            {
                window.alert("current channel, can't remove");
                return;
            }

            document.querySelector('[data-chat-context-selector-id="'+selector_id+'"]').remove();
            document.getElementById("chat-context-channel-"+channel_id).remove();

            let chat_context_index_to_remove = get_chat_context_index_by_chat_context_id("chat-context-channel-"+channel_id);

            if(chat_context_index_to_remove != -1)
            {
                chat_context_array.splice(chat_context_index_to_remove, 1);
            }

            document.getElementById("chat-context-channel-"+current_channel_id).style.display = "block";
            current_chat_context_id = "chat-context-channel-"+current_channel_id;
            document.querySelector('[data-chat-context-selector-id="channel-'+current_channel_id+'"]').style.backgroundColor = "#36393f";
        }
    }

    function chat_input_on_keyup()
    {
        if(event.key == "Enter" || event.keyCode == 13)
        {
            send_chat_message(socket);
        }
    }

    function channel_on_click()
    {
        for(let i = 0; i < document.getElementsByClassName("chat-context").length; i++)
        {
            document.getElementsByClassName("chat-context")[i].style.display = "none";
        }

        for(let i = 0; i < document.getElementsByClassName("connected-user").length; i++)
        {
            document.getElementsByClassName("connected-user")[i].style.backgroundColor = "";
        }

        console.log("is this active ? should not be");
        document.getElementById("chat-context-channel-1").style.display = "block";
        chat_message_receiver_type = "channel";
        chat_message_receiver_id = "main";
        current_chat_context_id = "chat-context-channel-1";
    }

    function show_hide_log_on_click()
    {
        if(textarea_log.style.display == "none")
        {
            textarea_log.style.display = "block";
        }
        else if(textarea_log.style.display == "block")
        {
            textarea_log.style.display = "none";
        }
    }

    function contextmenuitem_onclick(event)
    {
        event.stopPropagation();
        let data_action = event.srcElement.getAttribute("data-action");

        if(data_action == 0)
        {
            console.log("trying to create channel");

            document.getElementsByClassName("channel-list-context-menu")[0].remove();
            document.getElementById("background-container").style.display = "block";
            document.getElementById("channel-properties-container").style.display = "block";
            document.getElementById("create-channel-hidden-parent-id").value = selected_channel_id;
        }

        else if(data_action == 1)
        {
            let message_object = {"message" :
                {
                    "type" : "delete_channel_request",
                    "channel_id" : selected_channel_id.toString()
                }
            };

            console.log(message_object);

            let message_json_string = JSON.stringify(message_object);
            let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

            if(socket.readyState === 1)
            {
                socket.send(data);
            }
            document.getElementsByClassName("channel-list-context-menu")[0].remove();
            document.getElementById("current-channel-description").innerHTML = "";

        }
        else if(data_action == 3)
        {
            if(selected_channel_id == current_channel_id)
            {
                console.log("cannot join current channel"); // checked also at server side
                return;
            }
            let message_object = {"message" :
                {
                    "type" : "join_channel_request",
                    "channel_id" : selected_channel_id.toString()
                }
            };

            let message_json_string = JSON.stringify(message_object);
            let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

            if(socket.readyState === 1)
            {
                socket.send(data);
            }

            document.getElementsByClassName("channel-list-context-menu")[0].remove();
            let is_found = document.querySelector('[data-chat-context-selector-id="channel-'+selected_channel_id.toString()+'"]');

            if(is_found == null)
            {
                let channel_name = document.querySelector('[data-channel-name-id="'+selected_channel_id.toString()+'"]').innerHTML;
                let to_append = "<div class=\"chat-context-selector\" data-chat-context-selector-type=\"channel\" data-chat-context-selector-id=\"channel-"+selected_channel_id.toString()+"\">\n\
                                    <div class=\"p-container\">\n\
                                        <p>"+channel_name+"</p>\n\
                                    </div>\n\
                                    <div class=\"remove-chat-context-selector\" data-chat-context-remove-selector-type=\"channel\" data-chat-context-remove-selector-id=\"channel-"+selected_channel_id.toString()+"\">\n\
                                    </div>\n\
                                </div>";

                document.getElementById("chat-context-selectors-container").innerHTML += to_append;

                for(let x = 0; x < document.getElementsByClassName("remove-chat-context-selector").length; x++)
                {
                    document.getElementsByClassName("remove-chat-context-selector")[x].onclick = chat_context_remove_onclick;
                }

                for(let x = 0; x < document.getElementsByClassName("chat-context-selector").length; x++)
                {
                    document.getElementsByClassName("chat-context-selector")[x].onclick = chat_context_selector_onclick;
                }
            }

            for(let i = 0; i < document.getElementsByClassName("chat-context-selector").length; i++)
            {
                document.getElementsByClassName("chat-context-selector")[i].style.backgroundColor = "";
            }

            document.querySelector('[data-chat-context-selector-id="channel-'+selected_channel_id+'"]').style.backgroundColor = "#36393f";

            is_found = document.getElementById("chat-context-channel-" + selected_channel_id);
            if(is_found == null)
            {
                console.log("adding channel");
                let channel_name = document.querySelector('[data-channel-name-id="'+selected_channel_id.toString()+'"]').innerHTML;

                let html_to_append3 = '<div class="chat-context" id="chat-context-channel-'+selected_channel_id+'" style="display: none;">\n\
                                        <div class="single-server-message">now talking channel: ' + channel_name + '</div>\n\
                                            <div class="single-server-message">! group chat / chat in channel is E2EE</div>\n\
                                                <div class="single-server-message">[i] connected : anon2 8:05:53 AM</div><div class="chat-spacer"></div>\n\
                                            </div>\n\
                                        </div>\n\
                                      </div>';

                let count = document.getElementsByClassName("chat-context").length;
                document.getElementsByClassName("chat-context")[count - 1].insertAdjacentHTML("afterend",html_to_append3);

                let single_chat_context = {
                    "type":"channel",
                    "chat_context_id": "chat-context-channel-"+selected_channel_id,
                    "last_known_message_sender_username" : ""
                };

                chat_context_array.push(single_chat_context);
            }

            let count1 = document.getElementsByClassName("chat-context").length;

            for(let i = 0; i < count1; i++)
            {
                document.getElementsByClassName("chat-context")[i].style.display = "none";
            }

            document.getElementById("chat-context-channel-" + selected_channel_id).style.display = "block";

            current_chat_context_id = "chat-context-channel-"+selected_channel_id;
            chat_message_receiver_type = "channel";
            console.log("joined new channel, nulling out current_channel_keys");
            current_channel_keys = null;

            enable_inputs();
        }
    }

    function single_channel_onmousedown(event)
    {
        if(event.which == 1)
        {
            event.stopPropagation();
            let channel_id = parseInt(this.getAttribute("data-channel-id"));
            let index = get_channel_index_by_channel_id(channel_list, channel_id);

            document.getElementById("current-channel-description").innerHTML = sanitize_string(channel_list[index].description);
        }
        if(event.which == 3)
        {
            event.stopPropagation();
            let elements = document.getElementsByClassName('single-channel');

            for(let i = 0; i < elements.length; i++)
            {
                elements[i].style.backgroundColor = "";
            }

            this.style.backgroundColor = "#333030";
            selected_channel_id = parseInt(this.getAttribute("data-channel-id"));
            let elements_count = document.getElementsByClassName("channel-list-context-menu").length;

            for(let i = 0; i < elements_count; i++)
            {
                document.getElementsByClassName("channel-list-context-menu")[0].remove();
            }

            let contextmenu_html = "<div class=\"channel-list-context-menu\" style=\"top: "+ event.clientY.toString() + "px; left:" + event.clientX.toString() + "px; \">\n\
                                        <div class='channel-list-context-menu-background'>\n\
                                        </div>\n\
                                        <div class='channel-list-context-menu-items'>\n\
                                            <p class='context-menu-item' data-action='0'>create</p>\n\
                                            <p class='context-menu-item' data-action='1'>delete</p>\n\
                                            <p class='context-menu-item' data-action='2'>edit</p>\n\
                                            <p class='context-menu-item' data-action='3'>join</p>\n\
                                        </div>\n\
                                    </div>";

            document.getElementById("contextmenus-container").innerHTML += contextmenu_html;
            document.getElementById("contextmenus-container").getElementsByClassName("channel-list-context-menu")[0].style.top = event.clientY.toString();
            document.getElementById("contextmenus-container").getElementsByClassName("channel-list-context-menu")[0].style.left = event.clientX.toString();

            let contextmenu_item_count = document.getElementsByClassName("context-menu-item").length;

            for(let i = 0; i < contextmenu_item_count; i++)
            {
                document.getElementsByClassName("context-menu-item")[i].addEventListener("click", contextmenuitem_onclick);
            }

            let channel_id = parseInt(this.getAttribute("data-channel-id"));
            let index = get_channel_index_by_channel_id(channel_list, channel_id);

            document.getElementById("current-channel-description").innerHTML = sanitize_string(channel_list[index].description);
        }
    }

    function channel_properties_closebutton_onclick()
    {
        document.getElementById("channel-properties-container").style.display = "none";
        document.getElementById("background-container").style.display = "none";
    }

    function create_channel_button_onclick()
    {
        let parent_channel_id = document.getElementById("create-channel-hidden-parent-id").value;
        let channel_name = document.getElementById("channel-properties-input-channel-name").value;
        let channel_description = document.getElementById("channel-properties-input-channel-description").value;
        let channel_password = document.getElementById("channel-properties-input-channel-password").value;

        let message_object = {"message" :
            {
                "type" : "create_channel_request",
                "channel_name" : channel_name,
                "channel_description" : channel_description,
                "channel_password" : channel_password,
                "parent_channel_id" : parent_channel_id.toString()
            }
        };

        console.log(message_object);

        let message_json_string = JSON.stringify(message_object);
        let data = encrypt_all_message_data_and_convert_to_base64(message_json_string);

        if(socket.readyState === 1)
        {
            socket.send(data);
        }

        document.getElementById("channel-properties-container").style.display = "none";
        document.getElementById("background-container").style.display = "none";
    }

    function channel_list_onmousedown(event)
    {
        event.stopPropagation();

        switch(event.which)
        {
            case 3:
            case 1:
                let elements_count1 = document.getElementsByClassName("channel-list-context-menu").length;
                for(let i = 0; i < elements_count1; i++)
                {
                    document.getElementsByClassName("channel-list-context-menu")[0].remove();
                    console.log("channel_list_onmousedown() contextmenu removed");
                    let elements = document.getElementsByClassName('single-channel');
                    for(let i = 0; i < elements.length; i++)
                    {
                        elements[i].style.backgroundColor = "";
                    }
                }
            break;
        }
    }

    async function generate_rsa_keypair()
    {
        log("generating random public/private key pair");
        let passphrase = just.randomstring(50);
        my_rsa_key_object = cryptico.generateRSAKey(passphrase, 1024);
        rsa_public_key_string = cryptico.publicKeyString(my_rsa_key_object);
        is_rsa_key_generated = true;
        log("public key");
        log(rsa_public_key_string);
    }

    function document_onmousedown(event)
    {
        return;
        //remove context menu, if any
        let elements_count = document.getElementsByClassName("channel-list-context-menu").length;

        for(let i = 0; i < elements_count; i++)
        {
            document.getElementsByClassName("channel-list-context-menu")[0].remove();
        }
    }

    function window_onload()
    {
        document.getElementById("chat-input-container-send-chat-input").onclick = send_chat_input_on_click;
        document.getElementById("connect-button").onclick = connect_to_server;
        document.getElementById("chat-input-container-text-input").onkeyup = chat_input_on_keyup;
        document.getElementById("choose_image_input").onchange = choose_image_input;
        document.getElementById("add-key-button").onclick = add_key_button_on_click;
        textarea_log = document.getElementById("textarea-log");
        document.getElementById("show-hide-log-button").onclick = show_hide_log_on_click;
        generate_rsa_keypair();

        document.addEventListener("contextmenu", e => {e.preventDefault();});
        document.addEventListener("mousedown", document_onmousedown);
        document.getElementById("channel-list-container").addEventListener("mousedown", channel_list_onmousedown);
        document.querySelector("[data-chat-context-remove-selector-id='channel-1']").onclick = chat_context_remove_onclick;
        document.getElementById("close-button").onclick = channel_properties_closebutton_onclick;
        document.getElementById("create-channel-button").onclick = create_channel_button_onclick;

        if(is_autoconnect_active == true)
        {
            connect_to_server();
        }
    }

    window.onload = window_onload;

</script>
</head>
<body>

    <textarea id="textarea-log" style="display: none;"></textarea>

    <div id="body-container">
        <div id="verification-system">
            <div style="height: 25vmin;"></div>
                <div id="container-2" style="min-width: 330px;">
                    <div id="connect-form-sub-container-1">
                        <div class="connect-form-input-container">
                            <input type="text" disabled class="text-input-pretty" value="address">
                        </div>
                        <div class="connect-form-input-container">
                            <input type="text" disabled class="text-input-pretty" value="port">
                        </div>
                        <div class="connect-form-input-container">
                            <input type="text" disabled class="text-input-pretty" value="key 0">
                        </div>
                    </div>
                    <div id="connect-form-sub-container-2">
                        <div class="connect-form-input-container">
                            <input type="text" id="input-ip-address" class="text-input-pretty" value="127.0.0.1">
                        </div>
                        <div class="connect-form-input-container">
                            <input type="text" id="input-port-number" class="text-input-pretty" value="1111">
                        </div>
                        <div class="connect-form-input-container">
                            <input type="text" id="input-key-0" data-id="0" class="text-input-pretty" value="test">
                        </div>
                    </div>
                    <div>
                    </div>
                    <div style="display: inline-block;text-align: left;vertical-align: top;width: 63px;">
                        <input type="button" class="button-1" id="add-key-button" value="add">
                    </div>
                    <div style="display: inline-block;text-align: left; width: 214px;">
                        <input type="button" class="button-1" id="connect-button" value="connect">
                    </div>
                </div>
                <div style="height: 25vmin;"></div>
            </div>
            <div id="communication-system-container">
                <div id="communication-system-head-menu">
                </div>
                <div id="space-devider1">
                    <div id="channel-list-container">
                    </div>
                </div>
                <div id="space-devider2">
                    <div id="chat-context-selectors-container">
                        <div class="chat-context-selector" data-chat-context-selector-type="channel" data-chat-context-selector-id="channel-1" style="background-color: rgb(54, 57, 63);">
                            <div class="p-container">
                                <p id="current-channel-name">root</p>
                            </div>
                            <div class="remove-chat-context-selector" data-chat-context-remove-selector-type="channel" data-chat-context-remove-selector-id="channel-1">
                            </div>
                        </div>
                    </div>
                    <div id="chat-context-container">
                        <div class="chat-context" id="chat-context-channel-1">
                            <div class="single-server-message">now talking channel: main</div>
                        </div>
                    </div>
                </div>
                <div id="space-devider-42">
                    <div id="current-channel-description">
                    </div>
                </div>
                <div></div>
                <div id="space-devider3">
                </div>
                <div id="chat-input-container">
                    <div style="height: 10px;"></div>
                    <div id="chat-input-file-input-container">
                        <textarea id="chat-input-container-text-input" maxlength="900"></textarea>
                    </div>
                    <div id="image-upload-preview"></div>
                    <div style="display: inline-block; vertical-align: top; float: right; ">
                        <div id='upload-image-container'>
                            <div>
                                <label class="custom-file-upload-button" id="choose-file">
                                    <input id="choose_image_input" type="file" style="display: none">
                                </label>
                            </div>
                        </div>
                        <input type="button" id="chat-input-container-send-chat-input" value="send">
                    </div>
                </div>
            </div>
        </div>
        <input type="button" value="log" id="show-hide-log-button">
    </body>

    <div id="contextmenus-container">
    </div>
    <div id="background-container">
    </div>

    <div id="channel-properties-container">
        <div id="channel-properties-edit">
            <div id="menu-bar-container">
                <div id="close-button">
                </div>
            </div>
            <div id="channel-properties-input-container">
                <div style="display: inline-block;">
                    <div class="connect-form-input-container">
                        <input type="text" disabled="" class="text-input-2" value="name">
                    </div>
                    <div class="connect-form-input-container">
                        <input type="text" disabled="" class="text-input-2" value="description">
                    </div>
                    <div class="connect-form-input-container">
                        <input type="text" disabled="" class="text-input-2" value="password">
                    </div>
                </div>
                <div style="display: inline-block;">
                    <div class="connect-form-input-container">
                        <input class="text-input-2" id="channel-properties-input-channel-description" type="text" value="">
                    </div>
                    <div class="connect-form-input-container">
                        <input class="text-input-2" id="channel-properties-input-channel-name" type="text" value="new_channel">
                    </div>
                    <div class="connect-form-input-container">
                        <input class="text-input-2" id="channel-properties-input-channel-password" type="text" value="">
                    </div>
                </div>
                <input type="hidden" id="create-channel-hidden-parent-id" value="">
                <div style="text-align: right;">
                    <input type="button" id="create-channel-button" class="button-1" value="create" style="right: 20px;">
                </div>
            </div>
        </div>
</html>
